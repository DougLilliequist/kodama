/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={498:function(t){t.exports=function(){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i}var r={inputs:[],monitors:[]};var o="tp";function s(t){return function(e,n){return[o,"-",t,"v",e?"_"+e:"",n?"-"+n:""].join("")}}var a=s("lbl");var h=function(t,e){if(this.label=e.label,this.element=t.createElement("div"),this.element.classList.add(a()),void 0!==this.label){var n=t.createElement("div");n.classList.add(a("l")),n.appendChild(function(t,e){var n=t.createDocumentFragment();return e.split("\n").map((function(e){return t.createTextNode(e)})).forEach((function(e,i){i>0&&n.appendChild(t.createElement("br")),n.appendChild(e)})),n}(t,this.label)),this.element.appendChild(n)}else this.element.classList.add(a(void 0,"nol"));var i=t.createElement("div");i.classList.add(a("v")),this.element.appendChild(i),this.valueElement=i};var l=s("");function u(t,e){var n=t.element;e.emitter.on("change",(function(t){if("hidden"===t.propertyName){var i=l(void 0,"hidden");e.hidden?n.classList.add(i):n.classList.remove(i)}else"positions"===t.propertyName&&(["first","last"].forEach((function(t){n.classList.remove(l(void 0,t))})),e.positions.forEach((function(t){n.classList.add(l(void 0,t))})))})),e.emitter.on("dispose",(function(){t.onDispose&&t.onDispose(),function(t){t&&t.parentElement&&t.parentElement.removeChild(t)}(n)}))}var p=function(t,e){this.binding=e.binding,this.controller=e.controller,this.view=new h(t,{label:e.label}),this.view.valueElement.appendChild(this.controller.view.element),this.blade=e.blade,u(this.view,this.blade)},c=function(t,e){var n=this;this.binding=e.binding,this.controller=e.controller,this.view=new h(t,{label:e.label}),this.view.valueElement.appendChild(this.controller.view.element),this.blade=e.blade,this.blade.emitter.on("dispose",(function(){n.binding.dispose()})),u(this.view,this.blade)};function d(t){return null==t}var v=function(){function t(){this.observers_={}}return t.prototype.on=function(t,e){var n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e}),this},t.prototype.off=function(t,e){var n=this.observers_[t];return n&&(this.observers_[t]=n.filter((function(t){return t.handler!==e}))),this},t.prototype.emit=function(t,e){var n=this.observers_[t];n&&n.forEach((function(t){t.handler(e)}))},t}(),f=function(){function t(t){this.emitter=new v,this.title=t}return t.prototype.click=function(){this.emitter.emit("click",{sender:this})},t}(),m=s("btn"),g=function(t,e){this.button=e.button,this.element=t.createElement("div"),this.element.classList.add(m());var n=t.createElement("button");n.classList.add(m("b")),n.textContent=this.button.title,this.element.appendChild(n),this.buttonElement=n},b=function(){function t(t,e){this.onButtonClick_=this.onButtonClick_.bind(this),this.button=new f(e.title),this.view=new g(t,{button:this.button}),this.view.buttonElement.addEventListener("click",this.onButtonClick_)}return t.prototype.onButtonClick_=function(){this.button.click()},t}(),x=function(){function t(){this.emitter=new v,this.disposed_=!1}return Object.defineProperty(t.prototype,"disposed",{get:function(){return this.disposed_},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){return!this.disposed_&&(this.disposed_=!0,this.emitter.emit("dispose",{sender:this}),!0)},t}(),_=function(){function t(){this.onDispose_=this.onDispose_.bind(this),this.emitter=new v,this.positions_=[],this.hidden_=!1,this.disposable_=new x,this.disposable_.emitter.on("dispose",this.onDispose_)}return Object.defineProperty(t.prototype,"hidden",{get:function(){return this.hidden_},set:function(t){this.hidden_!==t&&(this.hidden_=t,this.emitter.emit("change",{propertyName:"hidden",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this.positions_},set:function(t){(function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0})(t,this.positions_)||(this.positions_=t,this.emitter.emit("change",{propertyName:"positions",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposed",{get:function(){return this.disposable_.disposed},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.disposable_.dispose()},t.prototype.onDispose_=function(){this.emitter.emit("dispose",{sender:this})},t}(),w="http://www.w3.org/2000/svg";function y(t){t.offsetHeight}function E(t){return void 0!==t.ontouchstart}function C(){return new Function("return this")()}function P(t){return"document"in C()?t.getContext("2d"):null}var M={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function k(t,e){var n=t.createElementNS(w,"svg");return n.innerHTML=M[e],n}function S(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}var A=function(){function t(){this.emitter=new v,this.items_=[]}return Object.defineProperty(t.prototype,"items",{get:function(){return this.items_},enumerable:!1,configurable:!0}),t.prototype.add=function(t,e){var n=void 0!==e?e:this.items_.length;this.items_.splice(n,0,t),this.emitter.emit("add",{index:n,item:t,sender:this})},t.prototype.remove=function(t){var e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),this.emitter.emit("remove",{sender:this}))},t}();var z=function(){function t(){this.onItemFolderFold_=this.onItemFolderFold_.bind(this),this.onListItemLayout_=this.onListItemLayout_.bind(this),this.onSubitemLayout_=this.onSubitemLayout_.bind(this),this.onSubitemFolderFold_=this.onSubitemFolderFold_.bind(this),this.onSubitemInputChange_=this.onSubitemInputChange_.bind(this),this.onSubitemMonitorUpdate_=this.onSubitemMonitorUpdate_.bind(this),this.onItemInputChange_=this.onItemInputChange_.bind(this),this.onListAdd_=this.onListAdd_.bind(this),this.onListItemDispose_=this.onListItemDispose_.bind(this),this.onListRemove_=this.onListRemove_.bind(this),this.onItemMonitorUpdate_=this.onItemMonitorUpdate_.bind(this),this.bcList_=new A,this.emitter=new v,this.bcList_.emitter.on("add",this.onListAdd_),this.bcList_.emitter.on("remove",this.onListRemove_)}return Object.defineProperty(t.prototype,"items",{get:function(){return this.bcList_.items},enumerable:!1,configurable:!0}),t.prototype.add=function(t,e){this.bcList_.add(t,e)},t.prototype.find=function(t){return this.items.reduce((function(e,n){return n instanceof T&&e.push.apply(e,n.bladeRack.find(t)),n instanceof t&&e.push(n),e}),[])},t.prototype.onListAdd_=function(t){var e=t.item;if(this.emitter.emit("add",{bladeController:e,index:t.index,sender:this}),e.blade.emitter.on("dispose",this.onListItemDispose_),e.blade.emitter.on("change",this.onListItemLayout_),e instanceof p)e.binding.emitter.on("change",this.onItemInputChange_);else if(e instanceof c)e.binding.emitter.on("update",this.onItemMonitorUpdate_);else if(e instanceof T){e.folder.emitter.on("change",this.onItemFolderFold_);var n=e.bladeRack.emitter;n.on("itemfold",this.onSubitemFolderFold_),n.on("itemlayout",this.onSubitemLayout_),n.on("inputchange",this.onSubitemInputChange_),n.on("monitorupdate",this.onSubitemMonitorUpdate_)}},t.prototype.onListRemove_=function(t){this.emitter.emit("remove",{sender:this})},t.prototype.onListItemLayout_=function(t){"hidden"!==t.propertyName&&"positions"!==t.propertyName||this.emitter.emit("itemlayout",{sender:this})},t.prototype.onListItemDispose_=function(t){var e=this;this.bcList_.items.filter((function(t){return t.blade.disposed})).forEach((function(t){e.bcList_.remove(t)}))},t.prototype.onItemInputChange_=function(t){var e=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i instanceof p&&i.binding===e)return i}return null}(this.find(p),t.sender);e&&this.emitter.emit("inputchange",{bindingController:e,sender:this})},t.prototype.onItemMonitorUpdate_=function(t){var e=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i instanceof c&&i.binding===e)return i}return null}(this.find(c),t.sender);e&&this.emitter.emit("monitorupdate",{bindingController:e,sender:this})},t.prototype.onItemFolderFold_=function(t){if("expanded"===t.propertyName){var e=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i instanceof T&&i.folder===e)return i}return null}(this.find(T),t.sender);e&&this.emitter.emit("itemfold",{folderController:e,sender:this})}},t.prototype.onSubitemLayout_=function(t){this.emitter.emit("itemlayout",{sender:this})},t.prototype.onSubitemInputChange_=function(t){this.emitter.emit("inputchange",{bindingController:t.bindingController,sender:this})},t.prototype.onSubitemMonitorUpdate_=function(t){this.emitter.emit("monitorupdate",{bindingController:t.bindingController,sender:this})},t.prototype.onSubitemFolderFold_=function(t){this.emitter.emit("itemfold",{folderController:t.folderController,sender:this})},t}(),V=function(){function t(t,e){this.emitter=new v,this.expanded_=e,this.expandedHeight_=null,this.temporaryExpanded_=null,this.shouldFixHeight_=!1,this.title=t}return Object.defineProperty(t.prototype,"expanded",{get:function(){return this.expanded_},set:function(t){this.expanded_!==t&&(this.emitter.emit("beforechange",{propertyName:"expanded",sender:this}),this.expanded_=t,this.emitter.emit("change",{propertyName:"expanded",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"temporaryExpanded",{get:function(){return this.temporaryExpanded_},set:function(t){this.temporaryExpanded_!==t&&(this.emitter.emit("beforechange",{propertyName:"temporaryExpanded",sender:this}),this.temporaryExpanded_=t,this.emitter.emit("change",{propertyName:"temporaryExpanded",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expandedHeight",{get:function(){return this.expandedHeight_},set:function(t){this.expandedHeight_!==t&&(this.emitter.emit("beforechange",{propertyName:"expandedHeight",sender:this}),this.expandedHeight_=t,this.emitter.emit("change",{propertyName:"expandedHeight",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shouldFixHeight",{get:function(){return this.shouldFixHeight_},set:function(t){this.shouldFixHeight_!==t&&(this.emitter.emit("beforechange",{propertyName:"shouldFixHeight",sender:this}),this.shouldFixHeight_=t,this.emitter.emit("change",{propertyName:"shouldFixHeight",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styleExpanded",{get:function(){var t;return null!==(t=this.temporaryExpanded)&&void 0!==t?t:this.expanded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styleHeight",{get:function(){return this.styleExpanded?this.shouldFixHeight&&!d(this.expandedHeight)?this.expandedHeight+"px":"auto":"0"},enumerable:!1,configurable:!0}),t}(),F=function(){function t(t,e){this.onFolderChange_=this.onFolderChange_.bind(this),this.folder_=e.folder,this.folder_.emitter.on("change",this.onFolderChange_),this.className_=s(e.viewName||"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_());var n=t.createElement("button");n.classList.add(this.className_("t")),n.textContent=this.folder_.title,e.hidesTitle&&(n.style.display="none"),this.element.appendChild(n),this.titleElement=n;var i=t.createElement("div");i.classList.add(this.className_("m")),this.titleElement.appendChild(i);var r=t.createElement("div");r.classList.add(this.className_("c")),this.element.appendChild(r),this.containerElement=r,this.applyModel_()}return t.prototype.applyModel_=function(){var t=this.folder_.styleExpanded,e=this.className_(void 0,"expanded");t?this.element.classList.add(e):this.element.classList.remove(e),this.containerElement.style.height=this.folder_.styleHeight},t.prototype.onFolderChange_=function(){this.applyModel_()},t}(),T=function(){function t(t,e){var n;this.onContainerTransitionEnd_=this.onContainerTransitionEnd_.bind(this),this.onFolderBeforeChange_=this.onFolderBeforeChange_.bind(this),this.onTitleClick_=this.onTitleClick_.bind(this),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackItemLayout_=this.onRackItemLayout_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.blade=e.blade,this.folder=new V(e.title,null===(n=e.expanded)||void 0===n||n),this.folder.emitter.on("beforechange",this.onFolderBeforeChange_);var i=new z;i.emitter.on("add",this.onRackAdd_),i.emitter.on("itemlayout",this.onRackItemLayout_),i.emitter.on("remove",this.onRackRemove_),this.bladeRack=i,this.doc_=t,this.view=new F(this.doc_,{folder:this.folder,hidesTitle:e.hidesTitle,viewName:e.viewName}),this.view.titleElement.addEventListener("click",this.onTitleClick_),this.view.containerElement.addEventListener("transitionend",this.onContainerTransitionEnd_),u(this.view,this.blade)}return Object.defineProperty(t.prototype,"document",{get:function(){return this.doc_},enumerable:!1,configurable:!0}),t.prototype.onFolderBeforeChange_=function(t){var e,n,i,r,o,s;"expanded"===t.propertyName&&(d(this.folder.expandedHeight)&&(this.folder.expandedHeight=(e=this.folder,n=this.view.containerElement,s=0,r=function(){e.expandedHeight=null,e.temporaryExpanded=!0,y(n),s=n.clientHeight,e.temporaryExpanded=null,y(n)},o=(i=n).style.transition,i.style.transition="none",r(),i.style.transition=o,s)),this.folder.shouldFixHeight=!0,y(this.view.containerElement))},t.prototype.onTitleClick_=function(){this.folder.expanded=!this.folder.expanded},t.prototype.applyRackChange_=function(){var t,e,n,i;t=this.bladeRack,e=t.items.filter((function(t){return!t.blade.hidden})),n=e[0],i=e[e.length-1],t.items.forEach((function(t){var e=[];t===n&&e.push("first"),t===i&&e.push("last"),t.blade.positions=e}))},t.prototype.onRackAdd_=function(t){var e,n,i;e=this.view.containerElement,n=t.bladeController.view.element,i=t.index,e.insertBefore(n,e.children[i]),this.applyRackChange_()},t.prototype.onRackRemove_=function(t){this.applyRackChange_()},t.prototype.onRackItemLayout_=function(t){this.applyRackChange_()},t.prototype.onContainerTransitionEnd_=function(t){"height"===t.propertyName&&(this.folder.shouldFixHeight=!1,this.folder.expandedHeight=null)},t}(),L=function(t,e){this.blade=e.blade,this.valueController=e.valueController,this.view=new h(t,{label:e.label}),this.view.valueElement.appendChild(this.valueController.view.element),u(this.view,this.blade)},D=s("spt"),R=function(t){this.element=t.createElement("div"),this.element.classList.add(D());var e=t.createElement("hr");e.classList.add(D("r")),this.element.appendChild(e)},I=function(t,e){this.blade=e.blade,this.view=new R(t),u(this.view,this.blade)},N=function(){function t(t){this.controller=t}return Object.defineProperty(t.prototype,"hidden",{get:function(){return this.controller.blade.hidden},set:function(t){this.controller.blade.hidden=t},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.controller.blade.dispose()},t.prototype.on=function(t,e){return this.controller.valueController.button.emitter.on(t,e.bind(this)),this},t}(),B=function(t){this.target=t},O=function(t){function n(e,n,i){var r=t.call(this,e)||this;return r.value=n,r.presetKey=i,r}return e(n,t),n}(B),U=function(t){function n(e,n,i){var r=t.call(this,e)||this;return r.value=n,r.presetKey=i,r}return e(n,t),n}(B),j=function(t){function n(e,n){var i=t.call(this,e)||this;return i.expanded=n,i}return e(n,t),n}(B),H=function(){function t(t){this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new v,this.controller=t,this.controller.binding.emitter.on("change",this.onBindingChange_)}return Object.defineProperty(t.prototype,"hidden",{get:function(){return this.controller.blade.hidden},set:function(t){this.controller.blade.hidden=t},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.controller.blade.dispose()},t.prototype.on=function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this},t.prototype.refresh=function(){this.controller.binding.read()},t.prototype.onBindingChange_=function(t){var e=t.sender.target.read();this.emitter_.emit("change",{event:new O(this,e,this.controller.binding.target.presetKey)})},t}(),G={alreadydisposed:function(){return"View has been already disposed"},invalidparams:function(t){return"Invalid parameters for '"+t.name+"'"},nomatchingcontroller:function(t){return"No matching controller for '"+t.key+"'"},notbindable:function(){return"Value is not bindable"},propertynotfound:function(t){return"Property '"+t.name+"' not found"},shouldneverhappen:function(){return"This error should never happen"}},W=function(){function t(t){var e;this.message=null!==(e=G[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}return t.alreadyDisposed=function(){return new t({type:"alreadydisposed"})},t.notBindable=function(){return new t({type:"notbindable"})},t.propertyNotFound=function(e){return new t({type:"propertynotfound",context:{name:e}})},t.shouldNeverHappen=function(){return new t({type:"shouldneverhappen"})},t}();W.prototype=Object.create(Error.prototype),W.prototype.constructor=W;var Y=function(){function t(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new v,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}return t.prototype.read=function(){var t=this.target.read();void 0!==t&&(this.value.rawValue=this.reader(t))},t.prototype.write_=function(t){this.writer(this.target,t)},t.prototype.onValueChange_=function(t){this.write_(t.rawValue),this.emitter.emit("change",{rawValue:t.rawValue,sender:this})},t}(),X=function(){function t(t,e){var n;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(n=null==e?void 0:e.equals)&&void 0!==n?n:function(t,e){return t===e},this.emitter=new v,this.rawValue_=t}return Object.defineProperty(t.prototype,"constraint",{get:function(){return this.constraint_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rawValue",{get:function(){return this.rawValue_},set:function(t){var e=this.constraint_?this.constraint_.constrain(t):t;!this.equals_(this.rawValue_,e)&&(this.rawValue_=e,this.emitter.emit("change",{rawValue:e,sender:this}))},enumerable:!1,configurable:!0}),t}();function q(t,e,n){if(d(e.read()))throw new W({context:{key:e.key},type:"nomatchingcontroller"});var i=r.inputs.reduce((function(i,r){return i||function(t,e){var n=t.accept(e.target.read(),e.params);if(null===n)return null;var i={target:e.target,initialValue:n,params:e.params},r=t.binding.reader(i),o=t.binding.constraint?t.binding.constraint(i):void 0,s=new X(r(n),{constraint:o,equals:t.binding.equals}),a=new Y({reader:r,target:e.target,value:s,writer:t.binding.writer(i)}),h=t.controller({document:e.document,initialValue:n,params:e.params,value:a.value});return new p(e.document,{binding:a,controller:h,label:e.params.label||e.target.key,blade:new _})}(r,{document:t,target:e,params:n})}),null);if(i)return i;throw new W({context:{key:e.key},type:"nomatchingcontroller"})}var K=function(){function t(t){this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new v,this.controller=t,this.controller.binding.emitter.on("update",this.onBindingUpdate_)}return Object.defineProperty(t.prototype,"hidden",{get:function(){return this.controller.blade.hidden},set:function(t){this.controller.blade.hidden=t},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.controller.blade.dispose()},t.prototype.on=function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this},t.prototype.refresh=function(){this.controller.binding.read()},t.prototype.onBindingUpdate_=function(t){var e=t.sender.target.read();this.emitter_.emit("update",{event:new U(this,e,this.controller.binding.target.presetKey)})},t}(),Z={defaultInterval:200,defaultLineCount:3};function $(t,e){for(;t.length<e;)t.push(void 0)}function Q(t){var e=[];return $(e,t),new X(e)}var J=function(){function t(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new v,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}return t.prototype.dispose=function(){this.ticker.disposable.dispose()},t.prototype.read=function(){var t=this.target.read();if(void 0!==t){var e=this.value.rawValue,n=this.reader_(t);this.value.rawValue=function(t,e){var n=i(function(t){var e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}(t),[e]);return n.length>t.length?n.splice(0,n.length-t.length):$(n,t.length),n}(e,n),this.emitter.emit("update",{rawValue:n,sender:this})}},t.prototype.onTick_=function(t){this.read()},t}(),tt=function(){function t(t,e){var n=this;if(this.id_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new v,e<=0)this.id_=null;else{var i=this.doc_.defaultView;i&&(this.id_=i.setInterval(this.onTick_,e))}this.disposable=new x,this.disposable.emitter.on("dispose",(function(){if(null!==n.id_){var t=n.doc_.defaultView;t&&t.clearInterval(n.id_)}n.id_=null}))}return t.prototype.onTick_=function(){this.emitter.emit("tick",{sender:this})},t}(),et=function(){function t(){this.disposable=new x,this.emitter=new v}return t.prototype.tick=function(){this.emitter.emit("tick",{sender:this})},t}();function nt(t,e){return 0===e?new et:new tt(t,null!=e?e:Z.defaultInterval)}function it(t,e,n){var i=r.monitors.reduce((function(i,r){return i||function(t,e){var n,i,r=t.accept(e.target.read(),e.params);if(null===r)return null;var o={target:e.target,initialValue:r,params:e.params},s=t.binding.reader(o),a=null!==(i=null!==(n=e.params.bufferSize)&&void 0!==n?n:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(e.params))&&void 0!==i?i:1,h=new J({reader:s,target:e.target,ticker:nt(e.document,e.params.interval),value:Q(a)});return new c(e.document,{binding:h,controller:t.controller({document:e.document,params:e.params,value:h.value}),label:e.params.label||e.target.key,blade:new _})}(r,{document:t,params:n,target:e})}),null);if(i)return i;throw new W({context:{key:e.key},type:"nomatchingcontroller"})}var rt=function(){function t(t){this.controller=t}return Object.defineProperty(t.prototype,"hidden",{get:function(){return this.controller.blade.hidden},set:function(t){this.controller.blade.hidden=t},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.controller.blade.dispose()},t}(),ot=function(){function t(t,e,n){this.obj_=t,this.key_=e,this.presetKey_=null!=n?n:e}return t.isBindable=function(t){return null!==t&&"object"==typeof t},Object.defineProperty(t.prototype,"key",{get:function(){return this.key_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presetKey",{get:function(){return this.presetKey_},enumerable:!1,configurable:!0}),t.prototype.read=function(){return this.obj_[this.key_]},t.prototype.write=function(t){this.obj_[this.key_]=t},t.prototype.writeProperty=function(e,n){var i=this.read();if(!t.isBindable(i))throw W.notBindable();if(!(e in i))throw W.propertyNotFound(e);i[e]=n},t}();function st(t,e,n){if(!ot.isBindable(t))throw W.notBindable();return new ot(t,e,n)}var at=function(t){function n(e){return t.call(this,e)||this}return e(n,t),n.registerPlugin=function(t){"input"===t.type?r.inputs.unshift(t.plugin):"monitor"===t.type&&r.monitors.unshift(t.plugin)},Object.defineProperty(n.prototype,"element",{get:function(){return this.controller.view.element},enumerable:!1,configurable:!0}),n.prototype.importPreset=function(t){(function(t,e){t.forEach((function(t){var n=e[t.presetKey];void 0!==n&&t.write(n)}))})(this.controller.bladeRack.find(p).map((function(t){return t.binding.target})),t),this.refresh()},n.prototype.exportPreset=function(){return this.controller.bladeRack.find(p).map((function(t){return t.binding.target})).reduce((function(t,e){var n;return Object.assign(t,((n={})[e.presetKey]=e.read(),n))}),{})},n.prototype.refresh=function(){this.controller.bladeRack.find(p).forEach((function(t){t.binding.read()})),this.controller.bladeRack.find(c).forEach((function(t){t.binding.read()}))},n}(function(){function t(t){this.onFolderChange_=this.onFolderChange_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackItemFold_=this.onRackItemFold_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.controller=t,this.emitter_=new v,this.controller.folder.emitter.on("change",this.onFolderChange_);var e=this.controller.bladeRack;e.emitter.on("inputchange",this.onRackInputChange_),e.emitter.on("monitorupdate",this.onRackMonitorUpdate_),e.emitter.on("itemfold",this.onRackItemFold_)}return Object.defineProperty(t.prototype,"expanded",{get:function(){return this.controller.folder.expanded},set:function(t){this.controller.folder.expanded=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{get:function(){return this.controller.blade.hidden},set:function(t){this.controller.blade.hidden=t},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.controller.blade.dispose()},t.prototype.addInput=function(t,e,n){var i=n||{},r=q(this.controller.document,st(t,e,i.presetKey),i);return this.controller.bladeRack.add(r,i.index),new H(r)},t.prototype.addMonitor=function(t,e,n){var i=n||{},r=it(this.controller.document,st(t,e),i);return this.controller.bladeRack.add(r,i.index),new K(r)},t.prototype.addFolder=function(e){var i=new T(this.controller.document,n(n({},e),{blade:new _}));return this.controller.bladeRack.add(i,e.index),new t(i)},t.prototype.addButton=function(t){var e=this.controller.document,n=new L(e,{blade:new _,label:t.label,valueController:new b(e,t)});return this.controller.bladeRack.add(n,t.index),new N(n)},t.prototype.addSeparator=function(t){var e=t||{},n=new I(this.controller.document,{blade:new _});return this.controller.bladeRack.add(n,e.index),new rt(n)},t.prototype.on=function(t,e){var n=e.bind(this);return this.emitter_.on(t,(function(t){n(t.event)})),this},t.prototype.onRackInputChange_=function(t){var e=new H(t.bindingController),n=t.bindingController.binding;this.emitter_.emit("change",{event:new O(e,n.target.read(),n.target.presetKey)})},t.prototype.onRackMonitorUpdate_=function(t){var e=new K(t.bindingController),n=t.bindingController.binding;this.emitter_.emit("update",{event:new U(e,n.target.read(),n.target.presetKey)})},t.prototype.onRackItemFold_=function(e){var n=new t(e.folderController);this.emitter_.emit("fold",{event:new j(n,e.folderController.folder.expanded)})},t.prototype.onFolderChange_=function(t){"expanded"===t.propertyName&&this.emitter_.emit("fold",{event:new j(this,t.sender.expanded)})},t}()),ht=function(){function t(t){var e=t.split(".");this.major=parseInt(e[0],10),this.minor=parseInt(e[1],10),this.patch=parseInt(e[2],10)}return t.prototype.toString=function(){return[this.major,this.minor,this.patch].join(".")},t}(),lt=function(t){function n(e,n){return t.call(this,e,{expanded:n.expanded,title:n.title||"",blade:n.blade,hidesTitle:void 0===n.title,viewName:"rot"})||this}return e(n,t),n}(T),ut=function(){function t(t){this.constraints=t}return t.prototype.constrain=function(t){return this.constraints.reduce((function(t,e){return e.constrain(t)}),t)},t}();function pt(t,e){if(t instanceof e)return t;if(t instanceof ut){var n=t.constraints.reduce((function(t,n){return t||(n instanceof e?n:null)}),null);if(n)return n}return null}var ct=function(){function t(t){this.options=t}return t.prototype.constrain=function(t){var e=this.options;return 0===e.length||e.filter((function(e){return e.value===t})).length>0?t:e[0].value},t}();function dt(t){return String(t)}function vt(t){return"false"!==t&&!!t}function ft(t){return dt(t)}function mt(t,e){return t===e}function gt(t,e){t.write(e)}var bt=function(){function t(t){this.step=t}return t.prototype.constrain=function(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step},t}();function xt(t,e,n,i,r){return i+(t-e)/(n-e)*(r-i)}function _t(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function wt(t,e,n){return Math.min(Math.max(t,e),n)}function yt(t,e){return(t%e+e)%e}function Et(t,e){return"options"in t&&void 0!==t.options?new ct(function(t,e){if(Array.isArray(t))return t.map((function(t){return{text:t.text,value:e(t.value)}}));var n=t;return Object.keys(n).reduce((function(t,i){return t.concat({text:i,value:e(n[i])})}),[])}(t.options,e)):null}function Ct(t){var e=t?pt(t,ct):null;return e?e.options:null}function Pt(t,e){var n=t&&pt(t,bt);return n?_t(n.step):Math.max(_t(e),2)}function Mt(t){var e=function(t){var e=t?pt(t,bt):null;return e?e.step:null}(t);return null!=e?e:1}function kt(t,e){var n,i=t&&pt(t,bt),r=Math.abs(null!==(n=null==i?void 0:i.step)&&void 0!==n?n:e);return 0===r?.1:Math.pow(10,Math.floor(Math.log10(r))-1)}var St=s("lst"),At=function(){function t(t,e){var n=this;this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(St()),this.stringifyValue_=e.stringifyValue;var i=t.createElement("select");i.classList.add(St("s")),e.options.forEach((function(e,r){var o=t.createElement("option");o.dataset.index=String(r),o.textContent=e.text,o.value=n.stringifyValue_(e.value),i.appendChild(o)})),this.element.appendChild(i),this.selectElement=i;var r=t.createElement("div");r.classList.add(St("m")),r.appendChild(k(t,"dropdown")),this.element.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update()}return t.prototype.update=function(){this.selectElement.value=this.stringifyValue_(this.value.rawValue)},t.prototype.onValueChange_=function(){this.update()},t}(),zt=function(){function t(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.value=e.value,this.listItems_=e.listItems,this.view=new At(t,{options:this.listItems_,stringifyValue:e.stringifyValue,value:this.value}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}return t.prototype.onSelectChange_=function(t){var e=t.currentTarget.selectedOptions.item(0);if(e){var n=Number(e.dataset.index);this.value.rawValue=this.listItems_[n].value,this.view.update()}},t}(),Vt=s("ckb"),Ft=function(){function t(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Vt());var n=t.createElement("label");n.classList.add(Vt("l")),this.element.appendChild(n);var i=t.createElement("input");i.classList.add(Vt("i")),i.type="checkbox",n.appendChild(i),this.inputElement=i;var r=t.createElement("div");r.classList.add(Vt("w")),n.appendChild(r);var o=k(t,"check");r.appendChild(o),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update()}return t.prototype.update=function(){this.inputElement.checked=this.value.rawValue},t.prototype.onValueChange_=function(){this.update()},t}(),Tt=function(){function t(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.view=new Ft(t,{value:this.value}),this.view.inputElement.addEventListener("change",this.onInputChange_)}return t.prototype.onInputChange_=function(t){var e=t.currentTarget;this.value.rawValue=e.checked,this.view.update()},t}();var Lt={id:"input-bool",accept:function(t){return"boolean"==typeof t?t:null},binding:{reader:function(t){return vt},constraint:function(t){return e=t.params,n=[],(i=Et(e,vt))&&n.push(i),new ut(n);var e,n,i},equals:mt,writer:function(t){return gt}},controller:function(t){return e=t.document,n=t.value,(r=n.constraint)&&pt(r,ct)?new zt(e,{listItems:null!==(i=Ct(r))&&void 0!==i?i:[],stringifyValue:dt,value:n}):new Tt(e,{value:n});var e,n,i,r}},Dt=s("txt"),Rt=function(){function t(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.formatter=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Dt()),e.arrayPosition&&this.element.classList.add(Dt(void 0,e.arrayPosition));var n=t.createElement("input");n.classList.add(Dt("i")),n.type="text",this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update()}return t.prototype.update=function(){this.inputElement.value=this.formatter(this.value.rawValue)},t.prototype.onValueChange_=function(){this.update()},t}(),It=function(){function t(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.value=e.value,this.view=new Rt(t,{formatter:e.formatter,value:this.value}),this.view.inputElement.addEventListener("change",this.onInputChange_)}return t.prototype.onInputChange_=function(t){var e=t.currentTarget.value,n=this.parser_(e);d(n)||(this.value.rawValue=n),this.view.update()},t}(),Nt=s("clswtxt"),Bt=function(){function t(t,e){this.element=t.createElement("div"),this.element.classList.add(Nt());var n=t.createElement("div");n.classList.add(Nt("s")),this.swatchView_=e.swatchView,n.appendChild(this.swatchView_.element),this.element.appendChild(n);var i=t.createElement("div");i.classList.add(Nt("t")),this.textView=e.textView,i.appendChild(this.textView.element),this.element.appendChild(i)}return Object.defineProperty(t.prototype,"value",{get:function(){return this.textView.value},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.swatchView_.update(),this.textView.update()},t}(),Ot=function(){function t(t){this.onValueChange_=this.onValueChange_.bind(this),this.mode_=t.rawValue.mode,this.value=t,this.value.emitter.on("change",this.onValueChange_),this.emitter=new v}return Object.defineProperty(t.prototype,"mode",{get:function(){return this.mode_},set:function(t){this.mode_!==t&&(this.mode_=t,this.emitter.emit("change",{propertyName:"mode",sender:this}))},enumerable:!1,configurable:!0}),t.prototype.onValueChange_=function(){this.emitter.emit("change",{propertyName:"value",sender:this})},t}(),Ut=function(){function t(t){this.text=t}return t.prototype.evaluate=function(){return Number(this.text)},t.prototype.toString=function(){return this.text},t}(),jt={"**":function(t,e){return Math.pow(t,e)},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"&":function(t,e){return t&e},"^":function(t,e){return t^e},"|":function(t,e){return t|e}},Ht=function(){function t(t,e,n){this.left=e,this.operator=t,this.right=n}return t.prototype.evaluate=function(){var t=jt[this.operator];if(!t)throw new Error("unexpected binary operator: '"+this.operator);return t(this.left.evaluate(),this.right.evaluate())},t.prototype.toString=function(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")},t}(),Gt={"+":function(t){return t},"-":function(t){return-t},"~":function(t){return~t}},Wt=function(){function t(t,e){this.operator=t,this.expression=e}return t.prototype.evaluate=function(){var t=Gt[this.operator];if(!t)throw new Error("unexpected unary operator: '"+this.operator);return t(this.expression.evaluate())},t.prototype.toString=function(){return["u(",this.operator,this.expression.toString(),")"].join(" ")},t}();function Yt(t){return function(e,n){for(var i=0;i<t.length;i++){var r=t[i](e,n);if(""!==r)return r}return""}}function Xt(t,e){var n,i=t.substr(e).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function qt(t,e){var n,i=t.substr(e).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Kt(t,e){var n=t.substr(e,1);if(e+=1,"e"!==n.toLowerCase())return"";var i=function(t,e){var n=qt(t,e);if(""!==n)return n;var i=t.substr(e,1);if("-"!==i&&"+"!==i)return"";var r=qt(t,e+=1);return""===r?"":i+r}(t,e);return""===i?"":n+i}function Zt(t,e){var n=t.substr(e,1);if("0"===n)return n;var i=function(t,e){var n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}(t,e);return e+=i.length,""===i?"":i+qt(t,e)}var $t=Yt([function(t,e){var n=Zt(t,e);if(e+=n.length,""===n)return"";var i=t.substr(e,1);if(e+=i.length,"."!==i)return"";var r=qt(t,e);return n+i+r+Kt(t,e+=r.length)},function(t,e){var n=t.substr(e,1);if(e+=n.length,"."!==n)return"";var i=qt(t,e);return e+=i.length,""===i?"":n+i+Kt(t,e)},function(t,e){var n=Zt(t,e);return e+=n.length,""===n?"":n+Kt(t,e)}]);var Qt=Yt([function(t,e){var n=t.substr(e,2);if(e+=n.length,"0b"!==n.toLowerCase())return"";var i=function(t,e){var n,i=t.substr(e).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(t,e);return""===i?"":n+i},function(t,e){var n=t.substr(e,2);if(e+=n.length,"0o"!==n.toLowerCase())return"";var i=function(t,e){var n,i=t.substr(e).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(t,e);return""===i?"":n+i},function(t,e){var n=t.substr(e,2);if(e+=n.length,"0x"!==n.toLowerCase())return"";var i=function(t,e){var n,i=t.substr(e).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}(t,e);return""===i?"":n+i}]),Jt=Yt([Qt,$t]);function te(t,e){return function(t,e){var n=Jt(t,e);return e+=n.length,""===n?null:{evaluable:new Ut(n),cursor:e}}(t,e)||function(t,e){var n=t.substr(e,1);if(e+=n.length,"("!==n)return null;var i=ie(t,e);if(!i)return null;e=i.cursor,e+=Xt(t,e).length;var r=t.substr(e,1);return e+=r.length,")"!==r?null:{evaluable:i.evaluable,cursor:e}}(t,e)}function ee(t,e,n){n+=Xt(e,n).length;var i=t.filter((function(t){return e.startsWith(t,n)}))[0];return i?(n+=i.length,{cursor:n+=Xt(e,n).length,operator:i}):null}var ne=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((function(t,e){return function(t,e){return function(n,i){var r=t(n,i);if(!r)return null;i=r.cursor;for(var o=r.evaluable;;){var s=ee(e,n,i);if(!s)break;i=s.cursor;var a=t(n,i);if(!a)return null;i=a.cursor,o=new Ht(s.operator,o,a.evaluable)}return o?{cursor:i,evaluable:o}:null}}(t,e)}),(function t(e,n){var i=te(e,n);if(i)return i;var r=e.substr(n,1);if(n+=r.length,"+"!==r&&"-"!==r&&"~"!==r)return null;var o=t(e,n);return o?{cursor:n=o.cursor,evaluable:new Wt(r,o.evaluable)}:null}));function ie(t,e){return e+=Xt(t,e).length,ne(t,e)}function re(t){var e,n=function(t){var e=ie(t,0);return e?e.cursor+Xt(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==n?void 0:n.evaluate())&&void 0!==e?e:null}function oe(t){if("number"==typeof t)return t;if("string"==typeof t){var e=re(t);if(!d(e))return e}return 0}function se(t){return String(t)}function ae(t){return function(e){return e.toFixed(Math.max(Math.min(t,20),0))}}var he=ae(0);function le(t){return he(t)+"%"}function ue(t,e,n){var i=wt(t/255,0,1),r=wt(e/255,0,1),o=wt(n/255,0,1),s=Math.max(i,r,o),a=Math.min(i,r,o),h=s-a,l=0,u=0,p=(a+s)/2;return 0!==h&&(u=p>.5?h/(2-a-s):h/(s+a),l=(l=i===s?(r-o)/h:r===s?2+(o-i)/h:4+(i-r)/h)/6+(l<0?1:0)),[360*l,100*u,100*p]}function pe(t,e,n){var i,r,o,s,a,h,l,u,p,c=(t%360+360)%360,d=wt(e/100,0,1),v=wt(n/100,0,1),f=(1-Math.abs(2*v-1))*d,m=f*(1-Math.abs(c/60%2-1)),g=v-f/2;return c>=0&&c<60?(l=(i=[f,m,0])[0],u=i[1],p=i[2]):c>=60&&c<120?(l=(r=[m,f,0])[0],u=r[1],p=r[2]):c>=120&&c<180?(l=(o=[0,f,m])[0],u=o[1],p=o[2]):c>=180&&c<240?(l=(s=[0,m,f])[0],u=s[1],p=s[2]):c>=240&&c<300?(l=(a=[m,0,f])[0],u=a[1],p=a[2]):(l=(h=[f,0,m])[0],u=h[1],p=h[2]),[255*(l+g),255*(u+g),255*(p+g)]}function ce(t,e,n){var i=wt(t/255,0,1),r=wt(e/255,0,1),o=wt(n/255,0,1),s=Math.max(i,r,o),a=s-Math.min(i,r,o);return[0===a?0:s===i?((r-o)/a%6+6)%6*60:s===r?60*((o-i)/a+2):60*((i-r)/a+4),100*(0===s?0:a/s),100*s]}function de(t,e,n){var i,r,o,s,a,h,l,u,p,c=yt(t,360),d=wt(e/100,0,1),v=wt(n/100,0,1),f=v*d,m=f*(1-Math.abs(c/60%2-1)),g=v-f;return c>=0&&c<60?(l=(i=[f,m,0])[0],u=i[1],p=i[2]):c>=60&&c<120?(l=(r=[m,f,0])[0],u=r[1],p=r[2]):c>=120&&c<180?(l=(o=[0,f,m])[0],u=o[1],p=o[2]):c>=180&&c<240?(l=(s=[0,m,f])[0],u=s[1],p=s[2]):c>=240&&c<300?(l=(a=[m,0,f])[0],u=a[1],p=a[2]):(l=(h=[f,0,m])[0],u=h[1],p=h[2]),[255*(l+g),255*(u+g),255*(p+g)]}function ve(t){return[t[0],t[1],t[2]]}function fe(t,e){return[t[0],t[1],t[2],e]}var me={hsl:{hsl:function(t,e,n){return[t,e,n]},hsv:function(t,e,n){var i=pe(t,e,n);return ce(i[0],i[1],i[2])},rgb:pe},hsv:{hsl:function(t,e,n){var i=de(t,e,n);return ue(i[0],i[1],i[2])},hsv:function(t,e,n){return[t,e,n]},rgb:de},rgb:{hsl:ue,hsv:ce,rgb:function(t,e,n){return[t,e,n]}}};function ge(t,e,n){var i;return(i=me[e])[n].apply(i,t)}var be={hsl:function(t){var e;return[yt(t[0],360),wt(t[1],0,100),wt(t[2],0,100),wt(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},hsv:function(t){var e;return[yt(t[0],360),wt(t[1],0,100),wt(t[2],0,100),wt(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},rgb:function(t){var e;return[wt(t[0],0,255),wt(t[1],0,255),wt(t[2],0,255),wt(null!==(e=t[3])&&void 0!==e?e:1,0,1)]}};function xe(t,e){return"object"==typeof t&&!d(t)&&e in t&&"number"==typeof t[e]}var _e=function(){function t(t,e){this.mode_=e,this.comps_=be[e](t)}return t.black=function(){return new t([0,0,0],"rgb")},t.fromObject=function(e){return new t("a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b],"rgb")},t.toRgbaObject=function(t){return t.toRgbaObject()},t.isRgbColorObject=function(t){return xe(t,"r")&&xe(t,"g")&&xe(t,"b")},t.isRgbaColorObject=function(t){return this.isRgbColorObject(t)&&xe(t,"a")},t.isColorObject=function(t){return this.isRgbColorObject(t)},t.equals=function(t,e){if(t.mode_!==e.mode_)return!1;for(var n=t.comps_,i=e.comps_,r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0},Object.defineProperty(t.prototype,"mode",{get:function(){return this.mode_},enumerable:!1,configurable:!0}),t.prototype.getComponents=function(t){return fe(ge(ve(this.comps_),this.mode_,t||this.mode_),this.comps_[3])},t.prototype.toRgbaObject=function(){var t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}},t}();function we(t,e){var n=t.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*e,e):Math.min(parseFloat(t),e)}var ye={deg:function(t){return t},grad:function(t){return 360*t/400},rad:function(t){return 360*t/(2*Math.PI)},turn:function(t){return 360*t}};function Ee(t){var e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);var n=parseFloat(e[1]),i=e[2];return ye[i](n)}var Ce={"func.rgb":function(t){var e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[we(e[1],255),we(e[2],255),we(e[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new _e(n,"rgb")},"func.rgba":function(t){var e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[we(e[1],255),we(e[2],255),we(e[3],255),we(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new _e(n,"rgb")},"func.hsl":function(t){var e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[Ee(e[1]),we(e[2],100),we(e[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new _e(n,"hsl")},"func.hsla":function(t){var e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;var n=[Ee(e[1]),we(e[2],100),we(e[3],100),we(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new _e(n,"hsl")},"hex.rgb":function(t){var e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new _e([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)],"rgb");var n=t.match(/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new _e([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],"rgb"):null},"hex.rgba":function(t){var e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new _e([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),xt(parseInt(e[4]+e[4],16),0,255,0,1)],"rgb");var n=t.match(/^#?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new _e([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),xt(parseInt(n[4],16),0,255,0,1)],"rgb"):null}};function Pe(t){return Object.keys(Ce).reduce((function(e,n){return e||((0,Ce[n])(t)?n:null)}),null)}var Me=function(t){var e=Pe(t);return e?Ce[e](t):null};function ke(t){return"func.hsla"===t||"func.rgba"===t||"hex.rgba"===t}function Se(t){if("string"==typeof t){var e=Me(t);if(e)return e}return _e.black()}function Ae(t){var e=wt(Math.floor(t),0,255).toString(16);return 1===e.length?"0"+e:e}function ze(t){return"#"+ve(t.getComponents("rgb")).map(Ae).join("")}function Ve(t){var e=t.getComponents("rgb");return"#"+[e[0],e[1],e[2],255*e[3]].map(Ae).join("")}function Fe(t){var e=ae(0);return"rgb("+ve(t.getComponents("rgb")).map((function(t){return e(t)})).join(", ")+")"}function Te(t){var e=ae(2),n=ae(0);return"rgba("+t.getComponents("rgb").map((function(t,i){return(3===i?e:n)(t)})).join(", ")+")"}var Le={"func.hsl":function(t){var e=[ae(0),le,le];return"hsl("+ve(t.getComponents("hsl")).map((function(t,n){return e[n](t)})).join(", ")+")"},"func.hsla":function(t){var e=[ae(0),le,le,ae(2)];return"hsla("+t.getComponents("hsl").map((function(t,n){return e[n](t)})).join(", ")+")"},"func.rgb":Fe,"func.rgba":Te,"hex.rgb":ze,"hex.rgba":Ve};function De(t){return Le[t]}var Re=s("clsw"),Ie=function(){function t(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Re());var n=t.createElement("div");n.classList.add(Re("sw")),this.element.appendChild(n),this.swatchElem_=n;var i=t.createElement("button");i.classList.add(Re("b")),this.element.appendChild(i),this.buttonElement=i;var r=t.createElement("div");r.classList.add(Re("p")),this.pickerView_=e.pickerView,r.appendChild(this.pickerView_.element),this.element.appendChild(r),this.update()}return t.prototype.update=function(){var t=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ve(t)},t.prototype.onValueChange_=function(){this.update()},t}(),Ne=function(){function t(t){this.maxValue=t.max,this.minValue=t.min}return t.prototype.constrain=function(t){var e=t;return d(this.minValue)||(e=Math.max(e,this.minValue)),d(this.maxValue)||(e=Math.min(e,this.maxValue)),e},t}(),Be=function(){function t(){this.emitter=new v,this.expanded_=!1}return Object.defineProperty(t.prototype,"expanded",{get:function(){return this.expanded_},set:function(t){this.expanded_!==t&&(this.expanded_=t,this.emitter.emit("change",{sender:this}))},enumerable:!1,configurable:!0}),t}();function Oe(t){var e=t.primary,n=t.secondary,i=t.forward,r=t.backward,o=!1;function s(t){o||(o=!0,t(),o=!1)}e.emitter.on("change",(function(){s((function(){n.rawValue=i(e,n)}))})),n.emitter.on("change",(function(){s((function(){e.rawValue=r(e,n)}))})),s((function(){n.rawValue=i(e,n)}))}function Ue(t,e){var n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function je(t){return{altKey:t.altKey,downKey:40===t.keyCode,shiftKey:t.shiftKey,upKey:38===t.keyCode}}function He(t){return{altKey:t.altKey,downKey:37===t.keyCode,shiftKey:t.shiftKey,upKey:39===t.keyCode}}function Ge(t){return function(t){return 38===t||40===t}(t)||37===t||39===t}function We(t,e){var n=e.ownerDocument.defaultView,i=e.getBoundingClientRect();return{x:t.pageX-((n&&n.scrollX||0)+i.left),y:t.pageY-((n&&n.scrollY||0)+i.top)}}var Ye=function(){function t(t){this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.element=t,this.emitter=new v,this.pressed_=!1;var e=this.element.ownerDocument;E(e)?(t.addEventListener("touchstart",this.onTouchStart_),t.addEventListener("touchmove",this.onTouchMove_),t.addEventListener("touchend",this.onTouchEnd_)):(t.addEventListener("mousedown",this.onMouseDown_),e.addEventListener("mousemove",this.onDocumentMouseMove_),e.addEventListener("mouseup",this.onDocumentMouseUp_))}return t.prototype.computePosition_=function(t){var e=this.element.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}},t.prototype.onMouseDown_=function(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus(),this.pressed_=!0,this.emitter.emit("down",{data:this.computePosition_(We(t,this.element)),sender:this})},t.prototype.onDocumentMouseMove_=function(t){this.pressed_&&this.emitter.emit("move",{data:this.computePosition_(We(t,this.element)),sender:this})},t.prototype.onDocumentMouseUp_=function(t){this.pressed_&&(this.pressed_=!1,this.emitter.emit("up",{data:this.computePosition_(We(t,this.element)),sender:this}))},t.prototype.onTouchStart_=function(t){t.preventDefault();var e=t.targetTouches.item(0),n=this.element.getBoundingClientRect();this.emitter.emit("down",{data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this})},t.prototype.onTouchMove_=function(t){var e=t.targetTouches.item(0),n=this.element.getBoundingClientRect();this.emitter.emit("move",{data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this})},t.prototype.onTouchEnd_=function(t){var e=t.targetTouches.item(0),n=this.element.getBoundingClientRect();this.emitter.emit("up",{data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this})},t}(),Xe=s("txt"),qe=function(t){function n(e,n){var i=t.call(this,e,n)||this;i.element.classList.add(Xe(void 0,"num")),i.onDraggingChange_=i.onDraggingChange_.bind(i),i.dragging_=n.dragging,i.draggingScale_=n.draggingScale,i.dragging_.emitter.on("change",i.onDraggingChange_),i.element.classList.add(Xe()),i.inputElement.classList.add(Xe("i"));var r=e.createElement("div");r.classList.add(Xe("k")),i.element.appendChild(r),i.knobElement=r;var o=e.createElementNS(w,"svg");o.classList.add(Xe("g")),i.knobElement.appendChild(o);var a=e.createElementNS(w,"path");a.classList.add(Xe("gb")),o.appendChild(a),i.guideBodyElem_=a;var h=e.createElementNS(w,"path");h.classList.add(Xe("gh")),o.appendChild(h),i.guideHeadElem_=h;var l=e.createElement("div");return l.classList.add(s("tt")()),i.knobElement.appendChild(l),i.tooltipElem_=l,i}return e(n,t),n.prototype.onDraggingChange_=function(t){if(null!==t.rawValue){this.element.classList.add(Xe(void 0,"drg"));var e=t.rawValue/this.draggingScale_,n=e+(e>0?-1:e<0?1:0),i=wt(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",["M "+(n+i)+",0 L"+n+",4 L"+(n+i)+",8","M "+e+",-1 L"+e+",9"].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d","M 0,4 L"+e+",4"),this.tooltipElem_.textContent=this.formatter(this.value.rawValue),this.tooltipElem_.style.left=e+"px"}else this.element.classList.remove(Xe(void 0,"drg"))},n}(Rt),Ke=function(){function t(t,e){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.value=e.value,this.baseStep_=e.baseStep,this.draggingScale_=e.draggingScale,this.dragging_=new X(null),this.view=new qe(t,{arrayPosition:e.arrayPosition,formatter:e.formatter,dragging:this.dragging_,draggingScale:this.draggingScale_,value:this.value}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_);var n=new Ye(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}return t.prototype.onInputChange_=function(t){var e=t.currentTarget.value,n=this.parser_(e);d(n)||(this.value.rawValue=n),this.view.update()},t.prototype.onInputKeyDown_=function(t){var e=Ue(this.baseStep_,je(t));0!==e&&(this.value.rawValue+=e,this.view.update())},t.prototype.onPointerDown_=function(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0},t.prototype.onPointerMove_=function(t){if(t.data.point){var e=t.data.point.x-t.data.bounds.width/2;this.value.rawValue=this.originRawValue_+e*this.draggingScale_,this.dragging_.rawValue=this.value.rawValue-this.originRawValue_}},t.prototype.onPointerUp_=function(){this.dragging_.rawValue=null},t}(),Ze=s("clp"),$e=function(){function t(t,e){this.alphaViews_=null,this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.pickedColor=e.pickedColor,this.pickedColor.value.emitter.on("change",this.onValueChange_),this.foldable=e.foldable,this.foldable.emitter.on("change",this.onFoldableChange_),this.element=t.createElement("div"),this.element.classList.add(Ze());var n=t.createElement("div");n.classList.add(Ze("hsv"));var i=t.createElement("div");i.classList.add(Ze("sv")),this.svPaletteView_=e.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);var r=t.createElement("div");r.classList.add(Ze("h")),this.hPaletteView_=e.hPaletteView,r.appendChild(this.hPaletteView_.element),n.appendChild(r),this.element.appendChild(n);var o=t.createElement("div");if(o.classList.add(Ze("rgb")),this.textView_=e.textView,o.appendChild(this.textView_.element),this.element.appendChild(o),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};var s=t.createElement("div");s.classList.add(Ze("a"));var a=t.createElement("div");a.classList.add(Ze("ap")),a.appendChild(this.alphaViews_.palette.element),s.appendChild(a);var h=t.createElement("div");h.classList.add(Ze("at")),h.appendChild(this.alphaViews_.text.element),s.appendChild(h),this.element.appendChild(s)}this.update()}return Object.defineProperty(t.prototype,"allFocusableElements",{get:function(){var t=i([this.svPaletteView_.element,this.hPaletteView_.element],this.textView_.textViews.map((function(t){return t.inputElement})));return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.pickedColor.value},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.foldable.expanded?this.element.classList.add(Ze(void 0,"expanded")):this.element.classList.remove(Ze(void 0,"expanded"))},t.prototype.onValueChange_=function(){this.update()},t.prototype.onFoldableChange_=function(){this.update()},t}();function Qe(t){return t?.1:1}var Je=s("apl"),tn=function(){function t(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Je()),this.element.tabIndex=0;var n=t.createElement("div");n.classList.add(Je("b")),this.element.appendChild(n);var i=t.createElement("div");i.classList.add(Je("c")),n.appendChild(i),this.colorElem_=i;var r=t.createElement("div");r.classList.add(Je("m")),this.element.appendChild(r),this.markerElem_=r;var o=t.createElement("div");o.classList.add(Je("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update()}return t.prototype.update=function(){var t=this.value.rawValue,e=t.getComponents("rgb"),n=new _e([e[0],e[1],e[2],0],"rgb"),i=new _e([e[0],e[1],e[2],255],"rgb"),r=["to right",Te(n),Te(i)];this.colorElem_.style.background="linear-gradient("+r.join(",")+")",this.previewElem_.style.backgroundColor=Te(t);var o=xt(e[3],0,1,0,100);this.markerElem_.style.left=o+"%"},t.prototype.onValueChange_=function(){this.update()},t}(),en=function(){function t(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.view=new tn(t,{value:this.value}),this.ptHandler_=new Ye(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_)}return t.prototype.handlePointerEvent_=function(t){if(t.point){var e=t.point.x/t.bounds.width,n=this.value.rawValue.getComponents("hsv"),i=n[0],r=n[1],o=n[2];this.value.rawValue=new _e([i,r,o,e],"hsv"),this.view.update()}},t.prototype.onPointerDown_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerMove_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerUp_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onKeyDown_=function(t){var e=Ue(Qe(!0),He(t)),n=this.value.rawValue.getComponents("hsv"),i=n[0],r=n[1],o=n[2],s=n[3];this.value.rawValue=new _e([i,r,o,s+e],"hsv")},t}(),nn=s("cltxt");var rn=function(){function t(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(nn());var n=t.createElement("div");n.classList.add(nn("m")),this.modeElem_=function(t){var e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((function(e,n){var i=t.createElement("option");return i.textContent=n.text,i.value=n.value,e.appendChild(i),e}),t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(nn("ms")),n.appendChild(this.modeSelectElement);var i=t.createElement("div");i.classList.add(nn("mm")),i.appendChild(k(t,"dropdown")),n.appendChild(i),this.element.appendChild(n);var r=t.createElement("div");r.classList.add(nn("w")),this.element.appendChild(r),this.textsElem_=r,this.textViews_=e.textViews,this.applyTextViews_(),this.pickedColor=e.pickedColor,this.pickedColor.emitter.on("change",this.onValueChange_),this.update()}return Object.defineProperty(t.prototype,"modeSelectElement",{get:function(){return this.modeElem_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textViews",{get:function(){return this.textViews_},set:function(t){this.textViews_=t,this.applyTextViews_()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.pickedColor.value},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.modeElem_.value=this.pickedColor.mode},t.prototype.applyTextViews_=function(){for(var t=this;this.textsElem_.children.length>0;)this.textsElem_.removeChild(this.textsElem_.children[0]);var e=this.element.ownerDocument;this.textViews_.forEach((function(n){var i=e.createElement("div");i.classList.add(nn("c")),i.appendChild(n.element),t.textsElem_.appendChild(i)}))},t.prototype.onValueChange_=function(){this.update()},t}(),on=ae(0),sn={rgb:function(){return new Ne({min:0,max:255})},hsl:function(t){return new Ne(0===t?{min:0,max:360}:{min:0,max:100})},hsv:function(t){return new Ne(0===t?{min:0,max:360}:{min:0,max:100})}};function an(t,e,n){return new Ke(t,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:Qe(!1),draggingScale:1,formatter:on,parser:e.parser,value:new X(0,{constraint:sn[e.colorMode](n)})})}var hn=function(){function t(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=e.parser,this.pickedColor=e.pickedColor,this.ccs_=this.createComponentControllers_(t),this.view=new rn(t,{pickedColor:this.pickedColor,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}return Object.defineProperty(t.prototype,"value",{get:function(){return this.pickedColor.value},enumerable:!1,configurable:!0}),t.prototype.createComponentControllers_=function(t){var e=this,n={colorMode:this.pickedColor.mode,parser:this.parser_},i=[an(t,n,0),an(t,n,1),an(t,n,2)];return i.forEach((function(t,n){Oe({primary:e.value,secondary:t.value,forward:function(t){return t.rawValue.getComponents(e.pickedColor.mode)[n]},backward:function(t,i){var r=t.rawValue.mode,o=e.pickedColor.mode,s=t.rawValue.getComponents(o);s[n]=i.rawValue;var a=ge(ve(s),o,r);return new _e(fe(a,s[3]),r)}})})),i},t.prototype.onModeSelectChange_=function(t){var e=t.currentTarget;this.pickedColor.mode=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]},t}(),ln=s("hpl"),un=function(){function t(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(ln()),this.element.tabIndex=0;var n=t.createElement("div");n.classList.add(ln("c")),this.element.appendChild(n);var i=t.createElement("div");i.classList.add(ln("m")),this.element.appendChild(i),this.markerElem_=i,this.update()}return t.prototype.update=function(){var t=this.value.rawValue.getComponents("hsv")[0];this.markerElem_.style.backgroundColor=Fe(new _e([t,100,100],"hsv"));var e=xt(t,0,360,0,100);this.markerElem_.style.left=e+"%"},t.prototype.onValueChange_=function(){this.update()},t}(),pn=function(){function t(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.view=new un(t,{value:this.value}),this.ptHandler_=new Ye(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_)}return t.prototype.handlePointerEvent_=function(t){if(t.point){var e=xt(t.point.x,0,t.bounds.width,0,360),n=this.value.rawValue.getComponents("hsv"),i=n[1],r=n[2],o=n[3];this.value.rawValue=new _e([e,i,r,o],"hsv"),this.view.update()}},t.prototype.onPointerDown_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerMove_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerUp_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onKeyDown_=function(t){var e=Ue(Qe(!1),He(t)),n=this.value.rawValue.getComponents("hsv"),i=n[0],r=n[1],o=n[2],s=n[3];this.value.rawValue=new _e([i+e,r,o,s],"hsv")},t}(),cn=s("svp"),dn=function(){function t(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(cn()),this.element.tabIndex=0;var n=t.createElement("canvas");n.height=64,n.width=64,n.classList.add(cn("c")),this.element.appendChild(n),this.canvasElement=n;var i=t.createElement("div");i.classList.add(cn("m")),this.element.appendChild(i),this.markerElem_=i,this.update()}return t.prototype.update=function(){var t=P(this.canvasElement);if(t){for(var e=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,i=this.canvasElement.height,r=t.getImageData(0,0,n,i),o=r.data,s=0;s<i;s++)for(var a=0;a<n;a++){var h=xt(a,0,n,0,100),l=xt(s,0,i,100,0),u=de(e[0],h,l),p=4*(s*n+a);o[p]=u[0],o[p+1]=u[1],o[p+2]=u[2],o[p+3]=255}t.putImageData(r,0,0);var c=xt(e[1],0,100,0,100);this.markerElem_.style.left=c+"%";var d=xt(e[2],0,100,100,0);this.markerElem_.style.top=d+"%"}},t.prototype.onValueChange_=function(){this.update()},t}(),vn=function(){function t(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.view=new dn(t,{value:this.value}),this.ptHandler_=new Ye(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_)}return t.prototype.handlePointerEvent_=function(t){if(t.point){var e=xt(t.point.x,0,t.bounds.width,0,100),n=xt(t.point.y,0,t.bounds.height,100,0),i=this.value.rawValue.getComponents("hsv"),r=i[0],o=i[3];this.value.rawValue=new _e([r,e,n,o],"hsv"),this.view.update()}},t.prototype.onPointerDown_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerMove_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerUp_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onKeyDown_=function(t){Ge(t.keyCode)&&t.preventDefault();var e=this.value.rawValue.getComponents("hsv"),n=e[0],i=e[1],r=e[2],o=e[3],s=Qe(!1);this.value.rawValue=new _e([n,i+Ue(s,He(t)),r+Ue(s,je(t)),o],"hsv")},t}(),fn=function(){function t(t,e){var n=this;this.triggerElement=null,this.onFocusableElementBlur_=this.onFocusableElementBlur_.bind(this),this.onKeyDown_=this.onKeyDown_.bind(this),this.pickedColor=e.pickedColor,this.foldable=new Be,this.hPaletteIc_=new pn(t,{value:this.pickedColor.value}),this.svPaletteIc_=new vn(t,{value:this.pickedColor.value}),this.alphaIcs_=e.supportsAlpha?{palette:new en(t,{value:this.pickedColor.value}),text:new Ke(t,{draggingScale:.01,formatter:ae(2),parser:re,baseStep:.1,value:new X(0,{constraint:new Ne({min:0,max:1})})})}:null,this.alphaIcs_&&Oe({primary:this.pickedColor.value,secondary:this.alphaIcs_.text.value,forward:function(t){return t.rawValue.getComponents()[3]},backward:function(t,e){var n=t.rawValue.getComponents();return n[3]=e.rawValue,new _e(n,t.rawValue.mode)}}),this.textIc_=new hn(t,{parser:re,pickedColor:this.pickedColor}),this.view=new $e(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,foldable:this.foldable,hPaletteView:this.hPaletteIc_.view,pickedColor:this.pickedColor,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteIc_.view,textView:this.textIc_.view}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.allFocusableElements.forEach((function(t){t.addEventListener("blur",n.onFocusableElementBlur_)}))}return Object.defineProperty(t.prototype,"value",{get:function(){return this.pickedColor.value},enumerable:!1,configurable:!0}),t.prototype.onFocusableElementBlur_=function(t){var e=this.view.element,n=S(t);n&&e.contains(n)||n&&n===this.triggerElement&&!E(e.ownerDocument)||(this.foldable.expanded=!1)},t.prototype.onKeyDown_=function(t){27===t.keyCode&&(this.foldable.expanded=!1)},t}(),mn=function(){function t(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.value=e.value,this.pickerIc_=new fn(t,{pickedColor:new Ot(this.value),supportsAlpha:e.supportsAlpha}),this.view=new Ie(t,{pickerView:this.pickerIc_.view,value:this.value}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.pickerIc_.triggerElement=this.view.buttonElement}return t.prototype.onButtonBlur_=function(t){var e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.pickerIc_.foldable.expanded=!1)},t.prototype.onButtonClick_=function(){this.pickerIc_.foldable.expanded=!this.pickerIc_.foldable.expanded,this.pickerIc_.foldable.expanded&&this.pickerIc_.view.allFocusableElements[0].focus()},t}(),gn=function(t,e){this.value=e.value,this.swatchIc_=new mn(t,{supportsAlpha:e.supportsAlpha,value:this.value}),this.textIc_=new It(t,{formatter:e.formatter,parser:e.parser,value:this.value}),this.view=new Bt(t,{swatchView:this.swatchIc_.view,textView:this.textIc_.view})};function bn(t){return _e.isColorObject(t)?_e.fromObject(t):_e.black()}function xn(t){return ve(t.getComponents("rgb")).reduce((function(t,e){return t<<8|255&Math.floor(e)}),0)}function _n(t){return t.getComponents("rgb").reduce((function(t,e,n){return t<<8|255&Math.floor(3===n?255*e:e)}),0)>>>0}function wn(t){return"number"!=typeof t?_e.black():new _e([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function yn(t){return"number"!=typeof t?_e.black():new _e([(e=t)>>24&255,e>>16&255,e>>8&255,xt(255&e,0,255,0,1)],"rgb");var e}function En(t,e){var n=e.toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b),t.writeProperty("a",n.a)}function Cn(t,e){var n=e.toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b)}function Pn(t){return"input"in t&&"color.rgba"===t.input}var Mn={id:"input-color-number",accept:function(t,e){return"number"!=typeof t?null:"input"in e?"color"!==e.input&&"color.rgb"!==e.input&&"color.rgba"!==e.input?null:t:null},binding:{reader:function(t){return Pn(t.params)?yn:wn},equals:_e.equals,writer:function(t){return e=Pn(t.params),n=e?_n:xn,function(t,e){gt(t,n(e))};var e,n}},controller:function(t){var e=Pn(t.params),n=e?Ve:ze;return new gn(t.document,{formatter:n,parser:Me,supportsAlpha:e,value:t.value})}};var kn={id:"input-color-object",accept:function(t,e){return _e.isColorObject(t)?t:null},binding:{reader:function(t){return bn},equals:_e.equals,writer:function(t){return e=t.initialValue,_e.isRgbaColorObject(e)?En:Cn;var e}},controller:function(t){var e=_e.isRgbaColorObject(t.initialValue),n=e?Ve:ze;return new gn(t.document,{formatter:n,parser:Me,supportsAlpha:e,value:t.value})}},Sn={id:"input-color-string",accept:function(t,e){return"string"!=typeof t||"input"in e&&"string"===e.input?null:Pe(t)?t:null},binding:{reader:function(t){return Se},equals:_e.equals,writer:function(t){var e=Pe(t.initialValue);if(!e)throw W.shouldNeverHappen();return function(t){var e=De(t);return function(t,n){gt(t,e(n))}}(e)}},controller:function(t){var e=Pe(t.initialValue);if(!e)throw W.shouldNeverHappen();var n=De(e);return new gn(t.document,{formatter:n,parser:Me,supportsAlpha:ke(e),value:t.value})}},An=s("sldtxt"),zn=function(){function t(t,e){this.element=t.createElement("div"),this.element.classList.add(An());var n=t.createElement("div");n.classList.add(An("s")),this.sliderView_=e.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);var i=t.createElement("div");i.classList.add(An("t")),this.textView_=e.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}return Object.defineProperty(t.prototype,"value",{get:function(){return this.sliderView_.value},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.sliderView_.update(),this.textView_.update()},t}(),Vn=s("sld"),Fn=function(){function t(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.minValue_=e.minValue,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Vn());var n=t.createElement("div");n.classList.add(Vn("t")),n.tabIndex=0,this.element.appendChild(n),this.trackElement=n;var i=t.createElement("div");i.classList.add(Vn("k")),this.trackElement.appendChild(i),this.knobElement=i,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update()}return t.prototype.update=function(){var t=wt(xt(this.value.rawValue,this.minValue_,this.maxValue_,0,100),0,100);this.knobElement.style.width=t+"%"},t.prototype.onValueChange_=function(){this.update()},t}();function Tn(t){var e=function(t){var e=t.constraint?pt(t.constraint,Ne):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}(t),n=e[0],i=e[1];return[null!=n?n:0,null!=i?i:100]}var Ln=function(){function t(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.baseStep_=e.baseStep;var n=Tn(this.value),i=n[0],r=n[1];this.minValue_=i,this.maxValue_=r,this.view=new Fn(t,{maxValue:this.maxValue_,minValue:this.minValue_,value:this.value}),this.ptHandler_=new Ye(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_)}return t.prototype.handlePointerEvent_=function(t){t.point&&(this.value.rawValue=xt(t.point.x,0,t.bounds.width,this.minValue_,this.maxValue_))},t.prototype.onPointerDown_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerMove_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerUp_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onKeyDown_=function(t){this.value.rawValue+=Ue(this.baseStep_,He(t))},t}(),Dn=function(t,e){this.value=e.value,this.sliderIc_=new Ln(t,{baseStep:e.baseStep,value:e.value}),this.textIc_=new Ke(t,{baseStep:e.baseStep,draggingScale:e.draggingScale,formatter:e.formatter,parser:e.parser,value:e.value}),this.view=new zn(t,{sliderView:this.sliderIc_.view,textView:this.textIc_.view})};function Rn(t){var e=[],n=function(t){return"step"in t&&!d(t.step)?new bt(t.step):null}(t);n&&e.push(n);var i=function(t){return"max"in t&&!d(t.max)||"min"in t&&!d(t.min)?new Ne({max:t.max,min:t.min}):null}(t);i&&e.push(i);var r=Et(t,oe);return r&&e.push(r),new ut(e)}var In={id:"input-number",accept:function(t){return"number"==typeof t?t:null},binding:{reader:function(t){return oe},constraint:function(t){return Rn(t.params)},equals:mt,writer:function(t){return gt}},controller:function(t){return e=t.document,n=t.value,(r=n.constraint)&&pt(r,ct)?new zt(e,{listItems:null!==(i=Ct(r))&&void 0!==i?i:[],stringifyValue:se,value:n}):r&&pt(r,Ne)?new Dn(e,{baseStep:Mt(r),draggingScale:kt(n.constraint,n.rawValue),formatter:ae(Pt(n.constraint,n.rawValue)),parser:re,value:n}):new Ke(e,{baseStep:Mt(r),draggingScale:kt(n.constraint,n.rawValue),formatter:ae(Pt(n.constraint,n.rawValue)),parser:re,value:n});var e,n,i,r}},Nn=function(){function t(t){this.components=t.components,this.asm_=t.assembly}return t.prototype.constrain=function(t){var e=this,n=this.asm_.toComponents(t).map((function(t,n){var i,r;return null!==(r=null===(i=e.components[n])||void 0===i?void 0:i.constrain(t))&&void 0!==r?r:t}));return this.asm_.fromComponents(n)},t}(),Bn=s("p2dtxt"),On=function(){function t(t,e){var n=this;this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(Bn()),this.textViews.forEach((function(e){var i=t.createElement("div");i.classList.add(Bn("a")),i.appendChild(e.element),n.element.appendChild(i)})),this.value=e.value}return t.prototype.update=function(){},t}();function Un(t,e){var n=t.value.constraint;if(n instanceof Nn)return n.components[e]}var jn=function(t,e){var n=this;this.value=e.value,this.acs_=e.axes.map((function(n,i){return function(t,e,n){return new Ke(t,{arrayPosition:0===n?"fst":n===e.axes.length-1?"lst":"mid",baseStep:e.axes[n].baseStep,formatter:e.axes[n].formatter,draggingScale:e.axes[n].draggingScale,parser:e.parser,value:new X(0,{constraint:Un(e,n)})})}(t,e,i)})),this.acs_.forEach((function(t,i){Oe({primary:n.value,secondary:t.value,forward:function(t){return e.assembly.toComponents(t.rawValue)[i]},backward:function(t,n){var r=e.assembly.toComponents(t.rawValue);return r[i]=n.rawValue,e.assembly.fromComponents(r)}})})),this.view=new On(t,{textViews:this.acs_.map((function(t){return t.view})),value:this.value})},Hn=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.getComponents=function(){return[this.x,this.y]},t.isObject=function(t){if(d(t))return!1;var e=t.x,n=t.y;return"number"==typeof e&&"number"==typeof n},t.equals=function(t,e){return t.x===e.x&&t.y===e.y},t.prototype.toObject=function(){return{x:this.x,y:this.y}},t}(),Gn={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return new(Hn.bind.apply(Hn,i([void 0],t)))}},Wn=s("p2dpadtxt"),Yn=function(){function t(t,e){this.element=t.createElement("div"),this.element.classList.add(Wn());var n=t.createElement("div");n.classList.add(Wn("w")),this.element.appendChild(n);var i=t.createElement("button");i.classList.add(Wn("b")),i.appendChild(k(t,"p2dpad")),n.appendChild(i),this.padButtonElem_=i;var r=t.createElement("div");r.classList.add(Wn("p")),n.appendChild(r),this.padView_=e.padView,r.appendChild(this.padView_.element);var o=t.createElement("div");o.classList.add(Wn("t")),this.textView_=e.textView,o.appendChild(this.textView_.element),this.element.appendChild(o)}return Object.defineProperty(t.prototype,"value",{get:function(){return this.textView_.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padButtonElement",{get:function(){return this.padButtonElem_},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.padView_.update(),this.textView_.update()},t}(),Xn=s("p2dpad"),qn=function(){function t(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.foldable=e.foldable,this.foldable.emitter.on("change",this.onFoldableChange_),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Xn());var n=t.createElement("div");n.tabIndex=0,n.classList.add(Xn("p")),this.element.appendChild(n),this.padElement=n;var i=t.createElementNS(w,"svg");i.classList.add(Xn("g")),this.padElement.appendChild(i),this.svgElem_=i;var r=t.createElementNS(w,"line");r.classList.add(Xn("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);var o=t.createElementNS(w,"line");o.classList.add(Xn("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);var s=t.createElementNS(w,"line");s.classList.add(Xn("l")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(s),this.lineElem_=s;var a=t.createElementNS(w,"circle");a.classList.add(Xn("m")),a.setAttributeNS(null,"r","2px"),this.svgElem_.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update()}return Object.defineProperty(t.prototype,"allFocusableElements",{get:function(){return[this.padElement]},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.foldable.expanded?this.element.classList.add(Xn(void 0,"expanded")):this.element.classList.remove(Xn(void 0,"expanded"));var t=this.value.rawValue.getComponents(),e=t[0],n=t[1],i=this.maxValue_,r=xt(e,-i,+i,0,100),o=xt(n,-i,+i,0,100),s=this.invertsY_?100-o:o;this.lineElem_.setAttributeNS(null,"x2",r+"%"),this.lineElem_.setAttributeNS(null,"y2",s+"%"),this.markerElem_.setAttributeNS(null,"cx",r+"%"),this.markerElem_.setAttributeNS(null,"cy",s+"%")},t.prototype.onValueChange_=function(){this.update()},t.prototype.onFoldableChange_=function(){this.update()},t}(),Kn=function(){function t(t,e){var n=this;this.triggerElement=null,this.onFocusableElementBlur_=this.onFocusableElementBlur_.bind(this),this.onKeyDown_=this.onKeyDown_.bind(this),this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.foldable=new Be,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new qn(t,{foldable:this.foldable,invertsY:this.invertsY_,maxValue:this.maxValue_,value:this.value}),this.ptHandler_=new Ye(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.allFocusableElements.forEach((function(t){t.addEventListener("blur",n.onFocusableElementBlur_)}))}return t.prototype.handlePointerEvent_=function(t){if(t.point){var e=this.maxValue_,n=xt(t.point.x,0,t.bounds.width,-e,+e),i=xt(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-e,+e);this.value.rawValue=new Hn(n,i),this.view.update()}},t.prototype.onPointerDown_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerMove_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPointerUp_=function(t){this.handlePointerEvent_(t.data)},t.prototype.onPadKeyDown_=function(t){Ge(t.keyCode)&&t.preventDefault(),this.value.rawValue=new Hn(this.value.rawValue.x+Ue(this.baseSteps_[0],He(t)),this.value.rawValue.y+Ue(this.baseSteps_[1],je(t))*(this.invertsY_?1:-1))},t.prototype.onFocusableElementBlur_=function(t){var e=this.view.element,n=S(t);n&&e.contains(n)||n&&n===this.triggerElement&&!E(e.ownerDocument)||(this.foldable.expanded=!1)},t.prototype.onKeyDown_=function(t){27===t.keyCode&&(this.foldable.expanded=!1)},t}(),Zn=function(){function t(t,e){this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.padIc_=new Kn(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,maxValue:e.maxValue,value:this.value}),this.textIc_=new jn(t,{assembly:Gn,axes:e.axes,parser:e.parser,value:this.value}),this.view=new Yn(t,{padView:this.padIc_.view,textView:this.textIc_.view}),this.view.padButtonElement.addEventListener("blur",this.onPadButtonBlur_),this.view.padButtonElement.addEventListener("click",this.onPadButtonClick_),this.padIc_.triggerElement=this.view.padButtonElement}return t.prototype.onPadButtonBlur_=function(t){var e=this.view.element,n=t.relatedTarget;n&&e.contains(n)||(this.padIc_.foldable.expanded=!1)},t.prototype.onPadButtonClick_=function(){this.padIc_.foldable.expanded=!this.padIc_.foldable.expanded,this.padIc_.foldable.expanded&&this.padIc_.view.allFocusableElements[0].focus()},t}();function $n(t){return Hn.isObject(t)?new Hn(t.x,t.y):new Hn}function Qn(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Jn(t){if(t){var e=[];return d(t.step)||e.push(new bt(t.step)),d(t.max)&&d(t.min)||e.push(new Ne({max:t.max,min:t.min})),new ut(e)}}function ti(t,e){var n=t&&pt(t,Ne);if(n)return Math.max(Math.abs(n.minValue||0),Math.abs(n.maxValue||0));var i=Mt(t);return Math.max(10*Math.abs(i),10*Math.abs(e))}function ei(t,e){return{baseStep:Mt(e),draggingScale:kt(e,t),formatter:ae(Pt(e,t))}}var ni={id:"input-point2d",accept:function(t,e){return Hn.isObject(t)?t:null},binding:{reader:function(t){return $n},constraint:function(t){return e=t.params,new Nn({assembly:Gn,components:[Jn("x"in e?e.x:void 0),Jn("y"in e?e.y:void 0)]});var e},equals:Hn.equals,writer:function(t){return Qn}},controller:function(t){return function(t,e,n){var i,r,o,s,a,h,l=e.constraint;if(!(l instanceof Nn))throw W.shouldNeverHappen();return new Zn(t,{axes:[ei(e.rawValue.x,l.components[0]),ei(e.rawValue.y,l.components[1])],invertsY:n,maxValue:(i=e.rawValue,r=e.constraint,o=r instanceof Nn?r.components[0]:void 0,s=r instanceof Nn?r.components[1]:void 0,a=ti(o,i.x),h=ti(s,i.y),Math.max(a,h)),parser:re,value:e})}(t.document,t.value,function(t){if(!("y"in t))return!1;var e=t.y;return!!e&&"inverted"in e&&!!e.inverted}(t.params))}},ii=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t.prototype.getComponents=function(){return[this.x,this.y,this.z]},t.isObject=function(t){if(d(t))return!1;var e=t.x,n=t.y,i=t.z;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i},t.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},t.prototype.toObject=function(){return{x:this.x,y:this.y,z:this.z}},t}(),ri={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return new(ii.bind.apply(ii,i([void 0],t)))}};function oi(t){return ii.isObject(t)?new ii(t.x,t.y,t.z):new ii}function si(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}function ai(t){if(t){var e=[];return d(t.step)||e.push(new bt(t.step)),d(t.max)&&d(t.min)||e.push(new Ne({max:t.max,min:t.min})),new ut(e)}}function hi(t,e){return{baseStep:Mt(e),draggingScale:kt(e,t),formatter:ae(Pt(e,t))}}var li={id:"input-point3d",accept:function(t,e){return ii.isObject(t)?t:null},binding:{reader:function(t){return oi},constraint:function(t){return e=t.params,new Nn({assembly:ri,components:[ai("x"in e?e.x:void 0),ai("y"in e?e.y:void 0),ai("z"in e?e.z:void 0)]});var e},equals:ii.equals,writer:function(t){return si}},controller:function(t){return function(t,e){var n=e.constraint;if(!(n instanceof Nn))throw W.shouldNeverHappen();return new jn(t,{assembly:ri,axes:[hi(e.rawValue.x,n.components[0]),hi(e.rawValue.y,n.components[1]),hi(e.rawValue.z,n.components[2])],parser:re,value:e})}(t.document,t.value)}},ui=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=n,this.w=i}return t.prototype.getComponents=function(){return[this.x,this.y,this.z,this.w]},t.isObject=function(t){if(d(t))return!1;var e=t.x,n=t.y,i=t.z,r=t.w;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i&&"number"==typeof r},t.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},t.prototype.toObject=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},t}(),pi={toComponents:function(t){return t.getComponents()},fromComponents:function(t){return new(ui.bind.apply(ui,i([void 0],t)))}};function ci(t){return ui.isObject(t)?new ui(t.x,t.y,t.z,t.w):new ui}function di(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}function vi(t){if(t){var e=[];return d(t.step)||e.push(new bt(t.step)),d(t.max)&&d(t.min)||e.push(new Ne({max:t.max,min:t.min})),new ut(e)}}function fi(t,e){var n=e.constraint;if(!(n instanceof Nn))throw W.shouldNeverHappen();return new jn(t,{assembly:pi,axes:e.rawValue.getComponents().map((function(t,e){return i=t,{baseStep:Mt(r=n.components[e]),draggingScale:kt(r,i),formatter:ae(Pt(r,i))};var i,r})),parser:re,value:e})}var mi={id:"input-point4d",accept:function(t,e){return ui.isObject(t)?t:null},binding:{reader:function(t){return ci},constraint:function(t){return e=t.params,new Nn({assembly:pi,components:[vi("x"in e?e.x:void 0),vi("y"in e?e.y:void 0),vi("z"in e?e.z:void 0),vi("w"in e?e.w:void 0)]});var e},equals:ui.equals,writer:function(t){return di}},controller:function(t){return fi(t.document,t.value)}};function gi(t){return String(t)}function bi(t){return t}var xi={id:"input-string",accept:function(t,e){return"string"==typeof t?t:null},binding:{reader:function(t){return gi},constraint:function(t){return e=t.params,n=[],(i=Et(e,gi))&&n.push(i),new ut(n);var e,n,i},equals:mt,writer:function(t){return gt}},controller:function(t){return e=t.document,n=t.value,(r=n.constraint)&&pt(r,ct)?new zt(e,{listItems:null!==(i=Ct(r))&&void 0!==i?i:[],stringifyValue:function(t){return t},value:n}):new It(e,{formatter:bi,parser:function(t){return t},value:n});var e,n,i,r}},_i=s("mll"),wi=function(){function t(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(_i());var n=t.createElement("textarea");n.classList.add(_i("i")),n.style.height="calc(var(--unit-size) * "+e.lineCount+")",n.readOnly=!0,this.element.appendChild(n),this.textareaElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update()}return t.prototype.update=function(){var t=this,e=this.textareaElem_,n=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach((function(e){void 0!==e&&i.push(t.formatter_(e))})),e.textContent=i.join("\n"),n&&(e.scrollTop=e.scrollHeight)},t.prototype.onValueUpdate_=function(){this.update()},t}(),yi=function(t,e){this.value=e.value,this.view=new wi(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value})},Ei=s("sgl"),Ci=function(){function t(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Ei());var n=t.createElement("input");n.classList.add(Ei("i")),n.readOnly=!0,n.type="text",this.element.appendChild(n),this.inputElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update()}return t.prototype.update=function(){var t=this.value.rawValue,e=t[t.length-1];this.inputElem_.value=void 0!==e?this.formatter_(e):""},t.prototype.onValueUpdate_=function(){this.update()},t}(),Pi=function(t,e){this.value=e.value,this.view=new Ci(t,{formatter:e.formatter,value:this.value})},Mi={id:"monitor-bool",accept:function(t,e){return"boolean"==typeof t?t:null},binding:{reader:function(t){return vt}},controller:function(t){var e;return 1===t.value.rawValue.length?new Pi(t.document,{formatter:ft,value:t.value}):new yi(t.document,{formatter:ft,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:Z.defaultLineCount,value:t.value})}},ki=function(){function t(){this.emitter=new v,this.index_=-1}return Object.defineProperty(t.prototype,"index",{get:function(){return this.index_},set:function(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))},enumerable:!1,configurable:!0}),t}(),Si=s("grl"),Ai=function(){function t(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Si()),this.formatter_=e.formatter,this.minValue_=e.minValue,this.maxValue_=e.maxValue,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);var n=t.createElementNS(w,"svg");n.classList.add(Si("g")),n.style.height="calc(var(--unit-size) * "+e.lineCount+")",this.element.appendChild(n),this.svgElem_=n;var i=t.createElementNS(w,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;var r=t.createElement("div");r.classList.add(Si("t"),s("tt")()),this.element.appendChild(r),this.tooltipElem_=r,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update()}return Object.defineProperty(t.prototype,"graphElement",{get:function(){return this.svgElem_},enumerable:!1,configurable:!0}),t.prototype.update=function(){var t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,n=this.minValue_,i=this.maxValue_,r=[];this.value.rawValue.forEach((function(o,s){if(void 0!==o){var a=xt(s,0,e,0,t.width),h=xt(o,n,i,t.height,0);r.push([a,h].join(","))}})),this.lineElem_.setAttributeNS(null,"points",r.join(" "));var o=this.tooltipElem_,s=this.value.rawValue[this.cursor_.index];if(void 0!==s){var a=xt(this.cursor_.index,0,e,0,t.width),h=xt(s,n,i,t.height,0);o.style.left=a+"px",o.style.top=h+"px",o.textContent=""+this.formatter_(s),o.classList.contains(Si("t","a"))||(o.classList.add(Si("t","a"),Si("t","in")),y(o),o.classList.remove(Si("t","in")))}else o.classList.remove(Si("t","a"))},t.prototype.onValueUpdate_=function(){this.update()},t.prototype.onCursorChange_=function(){this.update()},t}(),zi=function(){function t(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=e.value,this.cursor_=new ki,this.view=new Ai(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value}),E(t)){var n=new Ye(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}return t.prototype.onGraphMouseLeave_=function(){this.cursor_.index=-1},t.prototype.onGraphMouseMove_=function(t){var e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(xt(t.offsetX,0,e.width,0,this.value.rawValue.length))},t.prototype.onGraphPointerDown_=function(t){this.onGraphPointerMove_(t)},t.prototype.onGraphPointerMove_=function(t){t.data.point?this.cursor_.index=Math.floor(xt(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1},t.prototype.onGraphPointerUp_=function(){this.cursor_.index=-1},t}();function Vi(){return ae(2)}function Fi(t){return"view"in t&&"graph"===t.view}var Ti={id:"monitor-number",accept:function(t,e){return"number"==typeof t?t:null},binding:{defaultBufferSize:function(t){return Fi(t)?64:1},reader:function(t){return oe}},controller:function(t){return Fi(t.params)?function(t){var e,n,i,r=t.document,o=t.params,s=t.value;return new zi(r,{formatter:Vi(),lineCount:null!==(e=o.lineCount)&&void 0!==e?e:Z.defaultLineCount,maxValue:null!==(n="max"in o?o.max:null)&&void 0!==n?n:100,minValue:null!==(i="min"in o?o.min:null)&&void 0!==i?i:0,value:s})}(t):function(t){var e,n=t.document,i=t.params,r=t.value;return 1===r.rawValue.length?new Pi(n,{formatter:Vi(),value:r}):new yi(n,{formatter:Vi(),lineCount:null!==(e=i.lineCount)&&void 0!==e?e:Z.defaultLineCount,value:r})}(t)}},Li={id:"monitor-string",accept:function(t,e){return"string"==typeof t?t:null},binding:{reader:function(t){return gi}},controller:function(t){var e,n=t.value;return n.rawValue.length>1||"multiline"in t.params&&t.params.multiline?new yi(t.document,{formatter:bi,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:Z.defaultLineCount,value:n}):new Pi(t.document,{formatter:bi,value:n})}};function Di(t,e,n){if(!t.querySelector("style[data-tp-style="+e+"]")){var i=t.createElement("style");i.dataset.tpStyle=e,i.textContent=n,t.head.appendChild(i)}}function Ri(t){Di(t,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dpadtxtv_b,.tp-fldv_t,.tp-rotv_t,.tp-clswv_sw,.tp-p2dpadv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-ckbv_i,.tp-cltxtv_ms{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dpadtxtv_b{background-color:var(--button-background-color);border-radius:2px;color:var(--button-foreground-color);cursor:pointer;display:block;font-weight:bold;height:var(--unit-size);line-height:var(--unit-size);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dpadtxtv_b:hover{background-color:var(--button-background-color-hover)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dpadtxtv_b:focus{background-color:var(--button-background-color-focus)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dpadtxtv_b:active{background-color:var(--button-background-color-active)}.tp-fldv_t,.tp-rotv_t{background-color:var(--folder-background-color);color:var(--folder-foreground-color);cursor:pointer;display:block;height:calc(var(--unit-size) + 4px);line-height:calc(var(--unit-size) + 4px);overflow:hidden;padding-left:28px;position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_t:hover,.tp-rotv_t:hover{background-color:var(--folder-background-color-hover)}.tp-fldv_t:focus,.tp-rotv_t:focus{background-color:var(--folder-background-color-focus)}.tp-fldv_t:active,.tp-rotv_t:active{background-color:var(--folder-background-color-active)}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--folder-foreground-color), var(--folder-foreground-color) 2px, transparent 2px, transparent 4px, var(--folder-foreground-color) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;left:13px;margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_t>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv_c>.tp-fldv.tp-v-first,.tp-rotv_c>.tp-fldv.tp-v-first{margin-top:-4px}.tp-fldv_c>.tp-fldv.tp-v-last,.tp-rotv_c>.tp-fldv.tp-v-last{margin-bottom:-4px}.tp-fldv_c>*:not(.tp-v-first),.tp-rotv_c>*:not(.tp-v-first){margin-top:4px}.tp-fldv_c>.tp-fldv:not(.tp-v-hidden)+.tp-fldv,.tp-rotv_c>.tp-fldv:not(.tp-v-hidden)+.tp-fldv{margin-top:0}.tp-fldv_c>.tp-sptv:not(.tp-v-hidden)+.tp-sptv,.tp-rotv_c>.tp-sptv:not(.tp-v-hidden)+.tp-sptv{margin-top:0}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:4px;padding-top:4px;transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-clswv_sw,.tp-p2dpadv_p,.tp-txtv_i{background-color:var(--input-background-color);border-radius:2px;box-sizing:border-box;color:var(--input-foreground-color);font-family:inherit;height:var(--unit-size);line-height:var(--unit-size);min-width:0;width:100%}.tp-clswv_sw:hover,.tp-p2dpadv_p:hover,.tp-txtv_i:hover{background-color:var(--input-background-color-hover)}.tp-clswv_sw:focus,.tp-p2dpadv_p:focus,.tp-txtv_i:focus{background-color:var(--input-background-color-focus)}.tp-clswv_sw:active,.tp-p2dpadv_p:active,.tp-txtv_i:active{background-color:var(--input-background-color-active)}.tp-cltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-cltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-cltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-cltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--monitor-background-color);border-radius:2px;box-sizing:border-box;color:var(--monitor-foreground-color);height:var(--unit-size);width:100%}.tp-clpv,.tp-p2dpadv{background-color:var(--base-background-color);border-radius:6px;box-shadow:0 2px 4px var(--base-shadow-color);display:none;max-width:168px;padding:4px;position:relative;visibility:hidden;z-index:1000}.tp-clpv.tp-clpv-expanded,.tp-p2dpadv.tp-p2dpadv-expanded{display:block;visibility:visible}.tp-cltxtv_w,.tp-p2dtxtv,.tp-p3dtxtv{display:flex}.tp-cltxtv_c,.tp-p2dtxtv_a,.tp-p3dtxtv_a{width:100%}.tp-cltxtv_c+.tp-cltxtv_c,.tp-p2dtxtv_a+.tp-cltxtv_c,.tp-p3dtxtv_a+.tp-cltxtv_c,.tp-cltxtv_c+.tp-p2dtxtv_a,.tp-p2dtxtv_a+.tp-p2dtxtv_a,.tp-p3dtxtv_a+.tp-p2dtxtv_a,.tp-cltxtv_c+.tp-p3dtxtv_a,.tp-p2dtxtv_a+.tp-p3dtxtv_a,.tp-p3dtxtv_a+.tp-p3dtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--input-background-color);border-radius:2px;cursor:pointer;display:block;height:var(--unit-size);position:relative;width:var(--unit-size)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--input-foreground-color);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--input-background-color-hover)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--input-background-color-focus)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--input-background-color-active)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-clpv_h,.tp-clpv_ap{margin-left:6px;margin-right:6px}.tp-clpv_h{margin-top:4px}.tp-clpv_rgb{display:flex;margin-top:4px;width:100%}.tp-clpv_a{display:flex;margin-top:4px;padding-top:8px;position:relative}.tp-clpv_a:before{background-color:var(--separator-color);content:'';height:4px;left:-4px;position:absolute;right:-4px;top:0}.tp-clpv_ap{align-items:center;display:flex;flex:3}.tp-clpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:2px;outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:80px;width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--unit-size);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:2px;border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--unit-size);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:2px;box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:2px;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-clswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:2px}.tp-clswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--unit-size);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--unit-size)}.tp-clswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:2px;bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-clswv_p{left:-4px;position:absolute;right:-4px;top:var(--unit-size)}.tp-clswtxtv{display:flex;position:relative}.tp-clswtxtv_s{flex-grow:0;flex-shrink:0;width:var(--unit-size)}.tp-clswtxtv_t{flex:1;margin-left:4px}.tp-cltxtv{display:flex;width:100%}.tp-cltxtv_m{margin-right:4px}.tp-cltxtv_ms{border-radius:2px;color:var(--label-foreground-color);cursor:pointer;height:var(--unit-size);line-height:var(--unit-size);padding:0 18px 0 4px}.tp-cltxtv_ms:hover{background-color:var(--input-background-color-hover)}.tp-cltxtv_ms:focus{background-color:var(--input-background-color-focus)}.tp-cltxtv_ms:active{background-color:var(--input-background-color-active)}.tp-cltxtv_mm{color:var(--label-foreground-color)}.tp-cltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-expanded .tp-fldv_t{transition:border-radius 0s}.tp-fldv_c{border-left:var(--folder-background-color) solid 4px}.tp-fldv_t:hover+.tp-fldv_c{border-left-color:var(--folder-background-color-hover)}.tp-fldv_t:focus+.tp-fldv_c{border-left-color:var(--folder-background-color-focus)}.tp-fldv_t:active+.tp-fldv_c{border-left-color:var(--folder-background-color-active)}.tp-fldv_c>.tp-fldv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_t{border-top-left-radius:2px;border-bottom-left-radius:2px}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_t{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:2px}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--unit-size) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--monitor-foreground-color);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv .tp-ttv{background-color:var(--monitor-foreground-color)}.tp-grlv .tp-ttv::before{border-top-color:var(--monitor-foreground-color)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:4px;padding-right:4px}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--label-foreground-color);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--value-width)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--button-foreground-color)}.tp-sglv_i{padding:0 4px}.tp-mllv_i{display:block;height:calc(var(--unit-size) * 3);line-height:var(--unit-size);padding:0 4px;resize:none;white-space:pre}.tp-p2dpadv{padding-left:calc(4px * 2 + var(--unit-size))}.tp-p2dpadv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpadv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpadv_ax{stroke:var(--input-guide-color)}.tp-p2dpadv_l{stroke:var(--input-foreground-color);stroke-dasharray:2px 2px}.tp-p2dpadv_m{fill:var(--input-foreground-color)}.tp-p2dpadtxtv{display:flex;position:relative}.tp-p2dpadtxtv_b{height:var(--unit-size);position:relative;width:var(--unit-size)}.tp-p2dpadtxtv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dpadtxtv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dpadtxtv_b svg circle{fill:currentColor}.tp-p2dpadtxtv_p{left:-4px;position:absolute;right:-4px;top:var(--unit-size)}.tp-p2dpadtxtv_t{margin-left:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--unit-size: var(--tp-unit-size, 20px);--value-width: var(--tp-value-width, 160px);--base-background-color: var(--tp-base-background-color, #2f3137);--base-shadow-color: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--button-background-color: var(--tp-button-background-color, #adafb8);--button-background-color-active: var(--tp-button-background-color-active, #d6d7db);--button-background-color-focus: var(--tp-button-background-color-focus, #c8cad0);--button-background-color-hover: var(--tp-button-background-color-hover, #bbbcc4);--button-foreground-color: var(--tp-button-foreground-color, #2f3137);--folder-background-color: var(--tp-folder-background-color, rgba(200,202,208,0.1));--folder-background-color-active: var(--tp-folder-background-color-active, rgba(200,202,208,0.25));--folder-background-color-focus: var(--tp-folder-background-color-focus, rgba(200,202,208,0.2));--folder-background-color-hover: var(--tp-folder-background-color-hover, rgba(200,202,208,0.15));--folder-foreground-color: var(--tp-folder-foreground-color, #c8cad0);--input-background-color: var(--tp-input-background-color, rgba(200,202,208,0.1));--input-background-color-active: var(--tp-input-background-color-active, rgba(200,202,208,0.25));--input-background-color-focus: var(--tp-input-background-color-focus, rgba(200,202,208,0.2));--input-background-color-hover: var(--tp-input-background-color-hover, rgba(200,202,208,0.15));--input-foreground-color: var(--tp-input-foreground-color, #c8cad0);--input-guide-color: var(--tp-input-guide-color, rgba(0,0,0,0.2));--label-foreground-color: var(--tp-label-foreground-color, rgba(200,202,208,0.7));--monitor-background-color: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--monitor-foreground-color: var(--tp-monitor-foreground-color, rgba(200,202,208,0.7));--separator-color: var(--tp-separator-color, rgba(0,0,0,0.2))}.tp-rotv{background-color:var(--base-background-color);border-radius:6px;box-shadow:0 2px 4px var(--base-shadow-color);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_t{border-bottom-left-radius:6px;border-bottom-right-radius:6px;border-top-left-radius:6px;border-top-right-radius:6px;padding-right:28px;text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_t{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv_m{transition:none}.tp-rotv_c>.tp-fldv:last-child>.tp-fldv_c{border-bottom-left-radius:6px;border-bottom-right-radius:6px}.tp-rotv_c>.tp-fldv:last-child:not(.tp-fldv-expanded)>.tp-fldv_t{border-bottom-left-radius:6px;border-bottom-right-radius:6px}.tp-rotv_c>.tp-fldv:first-child>.tp-fldv_t{border-top-left-radius:6px;border-top-right-radius:6px}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sptv_r{background-color:var(--separator-color);border-width:0;display:block;height:4px;margin:0;width:100%}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--unit-size);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--input-background-color);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--input-foreground-color);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--button-background-color);border-radius:2px;bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--button-background-color-hover)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--button-background-color-focus)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--button-background-color-active)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-4px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--input-foreground-color);border-radius:2px 0 0 2px;bottom:0;content:'';height:var(--unit-size);left:50%;margin-bottom:auto;margin-left:-2px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:height 0.1s;width:4px}.tp-txtv.tp-txtv-mid .tp-txtv_k::before,.tp-txtv.tp-txtv-lst .tp-txtv_k::before{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:2px;height:4px}.tp-txtv.tp-txtv-drg.tp-txtv-mid .tp-txtv_k::before,.tp-txtv.tp-txtv-drg.tp-txtv-list .tp-txtv_k::before{border-bottom-left-radius:2px;border-top-left-radius:2px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--input-foreground-color);stroke-dasharray:2px 2px}.tp-txtv_gh{fill:none;stroke:var(--input-foreground-color)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--input-foreground-color);border-radius:2px;color:var(--base-background-color);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--input-foreground-color) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}"),i(r.inputs,r.monitors).forEach((function(e){e.css&&Di(t,"plugin-"+e.id,e.css)}))}var Ii=function(t){function n(e){var n,i=this,r=e||{},o=null!==(n=r.document)&&void 0!==n?n:C().document,a=new lt(o,{expanded:r.expanded,blade:new _,title:r.title});return(i=t.call(this,a)||this).containerElem_=r.container||function(t){var e=t.createElement("div");return e.classList.add(s("dfw")()),t.body&&t.body.appendChild(e),e}(o),i.containerElem_.appendChild(i.element),i.doc_=o,i.usesDefaultWrapper_=!r.container,Ri(i.document),i}return e(n,t),Object.defineProperty(n.prototype,"document",{get:function(){if(!this.doc_)throw W.alreadyDisposed();return this.doc_},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){var e=this.containerElem_;if(!e)throw W.alreadyDisposed();if(this.usesDefaultWrapper_){var n=e.parentElement;n&&n.removeChild(e)}this.containerElem_=null,this.doc_=null,t.prototype.dispose.call(this)},n.version=new ht("2.1.1"),n}(at);return[ni,li,mi,xi,In,Sn,kn,Mn,Lt].forEach((function(t){at.registerPlugin({type:"input",plugin:t})})),[Mi,Li,Ti].forEach((function(t){at.registerPlugin({type:"monitor",plugin:t})})),Ii}()},725:t=>{t.exports="precision highp float;\r\n\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    float light = dot(normalize(vNormal), vec3(0.0, 1.0, 0.0))*0.35 + (1.0 - 0.35);\r\n\r\n    gl_FragColor = vec4(vec3(light), 1.0);\r\n\r\n}"},359:t=>{t.exports="precision highp float;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\n\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n    vNormal = normal;\r\n\r\n}"},5:t=>{t.exports="precision highp float;\r\n\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    gl_FragColor = vec4((vNormal) * 0.5 + 0.5, 1.0);\r\n\r\n}"},612:t=>{t.exports="precision highp float;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\n\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = vec4(position, 1.0);\r\n\r\n    vNormal = normal;\r\n\r\n}"},415:t=>{t.exports="precision highp float;\r\n\r\nuniform sampler2D _Normal;\r\nuniform sampler2D tShadow;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat3 normalMatrix;\r\n\r\nuniform float _ShadowMapTexelSize;\r\n\r\nvarying vec3 vWorldPos;\r\nvarying vec3 vLocalPos;\r\nvarying vec2 vUv;\r\nvarying float vShadow;\r\nvarying float vScale;\r\n\r\n#define LIGHT vec3(0.0, 10.0, 0.0)\r\n\r\nvec3 hash33(vec3 p3)\r\n{\r\n\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yxz+33.33);\r\n    return fract((p3.xxy + p3.yxx)*p3.zyx);\r\n\r\n}\r\n\r\nvec2 hash23(vec3 p3)\r\n{\r\n\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yzx+33.33);\r\n    return fract((p3.xx+p3.yz)*p3.zy);\r\n}\r\n\r\nvoid main() {\r\n\r\n    vec3 n = texture2D(_Normal, vUv).xyz;\r\n    if(dot(n,n) < 0.2) discard;\r\n    n = n * 2.0 - 1.0;\r\n\r\n    vec3 viewNormal = (vec4(n, 0.0)*viewMatrix).xyz;\r\n\r\n    float light = dot(normalize(LIGHT), normalize(viewNormal)) * 0.35 + (1.0 - 0.35);\r\n    // float light = dot(normalize(LIGHT), viewNormal) * 0.5 + 0.5;\r\n    vec3 col = mix(vec3(0.543, 0.9342, 0.84), vec3(0.343, 0.7342, 0.413), vScale);\r\n    float shadow = mix(0.3, 1.0, vShadow);\r\n    col *= light;\r\n\r\n    gl_FragColor = vec4(col * shadow, 1.0);\r\n\r\n}"},865:t=>{t.exports="precision highp float;\r\n\r\nattribute vec3 position;\r\nattribute vec2 samplerCoord;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\nattribute float scale;\r\n\r\nuniform sampler2D _Position;\r\nuniform sampler2D _Normal;\r\nuniform sampler2D tShadow;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat4 modelMatrix;\r\n\r\nuniform mat4 shadowProjectionMatrix;\r\nuniform mat4 shadowViewMatrix;\r\n\r\nvarying vec2 vUv;\r\nvarying vec3 vWorldPos;\r\nvarying vec3 vLocalPos;\r\nvarying vec4 vShadowCoord;\r\nvarying float vShadow;\r\nvarying float vScale;\r\n\r\nuniform float _ShadowMapTexelSize;\r\n#define BIAS 0.0001\r\n\r\n\r\nfloat unpackRGBA (vec4 v) {\r\n    return dot(v, 1.0 / vec4(1.0, 255.0, 65025.0, 16581375.0));\r\n}\r\n\r\nvec2 hash23(vec3 p3)\r\n{\r\n\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yzx+33.33);\r\n    return fract((p3.xx+p3.yz)*p3.zy);\r\n}\r\n\r\nfloat inShadow(vec2 coord, vec2 offset, float depth) {\r\n\r\n    if(coord.x < -1.0 || coord.x > 1.0) return 1.0;\r\n    if(coord.y < -1.0 || coord.y > 1.0) return 1.0;\r\n    if(depth < -1.0 || depth > 1.0) return 1.0;\r\n\r\n    // vec2 jitter = (hash23(vec3((coord + offset)*2000.0, depth)-0.5)) * _ShadowMapTexelSize;\r\n    vec2 jitter = (hash23(vec3((coord + offset)*3000.0, depth)*2.0-1.0)) * _ShadowMapTexelSize;\r\n    float occluder = unpackRGBA(texture2D(tShadow, coord + jitter));\r\n    if(depth-BIAS > occluder) {\r\n        return 1.0;\r\n    } else {\r\n        return 0.0;\r\n    }\r\n\r\n}\r\n\r\nvoid main() {\r\n\r\n    vec4 worldPos = texture2D(_Position, samplerCoord);\r\n    vec4 wPos = modelMatrix * vec4(worldPos.xyz, 1.0);\r\n    vWorldPos = wPos.xyz;\r\n    vLocalPos = position;\r\n    vec4 viewPos = viewMatrix * wPos;\r\n    float lifePhase = worldPos.w * 4.0 * (1.0-worldPos.w);\r\n    viewPos.xy += position.xy * mix(1.0, 1.5, scale) * lifePhase;\r\n\r\n    vec4 clipPos = projectionMatrix * viewPos;\r\n\r\n    vec4 shadowViewPos = shadowViewMatrix * vec4(wPos.xyz, 1.0);\r\n    vec4 shadowCoord = shadowProjectionMatrix * shadowViewPos;\r\n    shadowCoord.xyz = shadowCoord.xyz/shadowCoord.w;\r\n    shadowCoord.xyz = shadowCoord.xyz * 0.5 + 0.5;\r\n\r\n    float shadow = 1.0;\r\n    \r\n    float texelSizeHalf = _ShadowMapTexelSize*0.5;\r\n    shadow -= inShadow(shadowCoord.xy, vec2(-texelSizeHalf, -texelSizeHalf), shadowCoord.z) * 0.2;\r\n    shadow -= inShadow(shadowCoord.xy, vec2(-texelSizeHalf, texelSizeHalf), shadowCoord.z) * 0.2;\r\n    shadow -= inShadow(shadowCoord.xy, vec2(0.0,0.0), shadowCoord.z) * 0.2;\r\n    shadow -= inShadow(shadowCoord.xy, vec2(texelSizeHalf, -texelSizeHalf), shadowCoord.z) * 0.2;\r\n    shadow -= inShadow(shadowCoord.xy, vec2(texelSizeHalf, texelSizeHalf), shadowCoord.z) * 0.2;\r\n\r\n    vShadow = shadow;\r\n    gl_Position = clipPos;\r\n    vUv = uv;\r\n    vScale = scale;\r\n\r\n}"},393:t=>{t.exports="    precision highp float;\r\n\r\n    uniform sampler2D _Normal;\r\n    varying vec2 vUv;\r\n\r\n    vec4 packRGBA (float v) {\r\n        vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\r\n        pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\r\n        return pack;\r\n    }\r\n\r\n    void main() {\r\n\r\n        vec3 n = texture2D(_Normal, vUv).xyz;\r\n        if(dot(n,n) < 0.2) discard;\r\n        n = n * 2.0 - 1.0;\r\n        vec4 depth = packRGBA(gl_FragCoord.z);\r\n\r\n        gl_FragColor = depth;\r\n    }"},551:t=>{t.exports="precision highp float;\r\n\r\nattribute vec3 position;\r\nattribute vec2 samplerCoord;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\n\r\nuniform sampler2D _Position;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat4 modelMatrix;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n    vec4 worldPos = texture2D(_Position, samplerCoord);\r\n    vec4 wPos = modelMatrix * vec4(worldPos.xyz, 1.0);\r\n    vec4 viewPos = viewMatrix * wPos;\r\n    float lifePhase = worldPos.w * 4.0 * (1.0-worldPos.w);\r\n    viewPos.xy += position.xy * lifePhase;\r\n\r\n    vec4 clipPos = projectionMatrix * viewPos;\r\n\r\n    gl_Position = clipPos;\r\n    vUv = uv;\r\n\r\n}"},758:t=>{t.exports="precision highp float;\r\n\r\nuniform sampler2D tMap;\r\nuniform sampler2D _Velocity;\r\n\r\nuniform vec3 _Points[4];\r\n\r\nuniform float _Time;\r\nuniform float _TimeScale;\r\n\r\nvarying vec2 vUv;\r\n\r\n#define EPS 0.001\r\n#define PI 3.1415926538\r\n#define PI2 3.1415926538 * 2.0\r\n\r\nfloat hash13(vec3 p3)\r\n{\r\n\tp3  = fract(p3 * .1031);\r\n    p3 += dot(p3, p3.zyx + 31.32);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nvec3 hash33(vec3 p3)\r\n{\r\n\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yxz+33.33);\r\n    return fract((p3.xxy + p3.yxx)*p3.zyx);\r\n\r\n}\r\n\r\nfloat hash12(vec2 p)\r\n{\r\n\tvec3 p3  = fract(vec3(p.xyx) * .1031);\r\n    p3 += dot(p3, p3.yzx + 33.33);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nvec2 hash21(float p)\r\n{\r\n\tvec3 p3 = fract(vec3(p) * vec3(.1031, .1030, .0973));\r\n\tp3 += dot(p3, p3.yzx + 33.33);\r\n    return fract((p3.xx+p3.yz)*p3.zy);\r\n\r\n}\r\n\r\nvec3 computeBezier(float t) {\r\n\r\n    vec3 p0p1 = mix(_Points[0], _Points[1], t);\r\n    vec3 p1p2 = mix(_Points[1], _Points[2], t);\r\n    vec3 p2p3 = mix(_Points[2], _Points[3], t);\r\n\r\n    vec3 a = mix(p0p1, p1p2, t);\r\n    vec3 b = mix(p1p2, p2p3, t);\r\n\r\n    return mix(a, b, t);\r\n    \r\n}\r\n\r\nvoid main() {\r\n\r\n    vec4 pos = texture2D(tMap, vUv);\r\n    vec4 vel =texture2D(_Velocity, vUv);\r\n\r\n    pos.w += vel.w * _TimeScale;\r\n    if(pos.w >= 1.0) {\r\n        pos.w = 0.0;\r\n        \r\n        pos.xyz = _Points[0];\r\n\r\n    };\r\n\r\n    pos.xyz += vel.xyz;\r\n\r\n    gl_FragColor = pos;\r\n\r\n}"},490:t=>{t.exports="precision highp float;\r\n\r\nuniform sampler2D tMap;\r\nuniform sampler2D _Position;\r\nuniform sampler2D _Hash;\r\n\r\nuniform vec3 _Points[4];\r\n\r\nuniform float _SpatialF;\r\nuniform float _NoiseSpatialFScale;\r\n\r\nuniform float _TemporalF;\r\nuniform float _Amp;\r\nuniform float _NoiseSampleSpread;\r\nuniform float _NoiseJitterScale;\r\n\r\nuniform float _MinLifeRate;\r\nuniform float _MaxLifeRate;\r\n\r\nuniform float _MinPathDist;\r\nuniform float _MaxPathDist;\r\n\r\nuniform float _ReturnForceK;\r\nuniform float _RepelForceK;\r\n\r\nuniform float _PathForce;\r\n\r\nuniform float _Time;\r\n\r\nvarying vec2 vUv;\r\n\r\n#define EPS 0.0001\r\n#define INERTIA 0.9\r\n#define PI 3.14159265359\r\n#define TAU 6.28318530718\r\n\r\n///  3 out, 3 in...\r\nvec3 hash33(vec3 p3)\r\n{\r\n\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yxz+33.33);\r\n    return fract((p3.xxy + p3.yxx)*p3.zyx);\r\n\r\n}\r\n\r\nfloat hash13(vec3 p3)\r\n{\r\n\tp3  = fract(p3 * .1031);\r\n    p3 += dot(p3, p3.zyx + 31.32);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nvec3 hash31(float p)\r\n{\r\n   vec3 p3 = fract(vec3(p) * vec3(.1031, .1030, .0973));\r\n   p3 += dot(p3, p3.yzx+33.33);\r\n   return fract((p3.xxy+p3.yzz)*p3.zyx); \r\n}\r\n\r\nfloat hash12(vec2 p)\r\n{\r\n\tvec3 p3  = fract(vec3(p.xyx) * .1031);\r\n    p3 += dot(p3, p3.yzx + 33.33);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\n// Description : Array and textureless GLSL 2D/3D/4D simplex \r\n//               noise functions.\r\n//      Author : Ian McEwan, Ashima Arts.\r\n//  Maintainer : stegu\r\n//     Lastmod : 20110822 (ijm)\r\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\r\n//               Distributed under the MIT License. See LICENSE file.\r\n//               https://github.com/ashima/webgl-noise\r\n//               https://github.com/stegu/webgl-noise\r\n// \r\n\r\nvec3 mod289(vec3 x) {\r\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\r\n}\r\n\r\nvec4 mod289(vec4 x) {\r\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\r\n}\r\n\r\nvec4 permute(vec4 x) {\r\n     return mod289(((x*34.0)+1.0)*x);\r\n}\r\n\r\nvec4 taylorInvSqrt(vec4 r)\r\n{\r\n  return 1.79284291400159 - 0.85373472095314 * r;\r\n}\r\n\r\nfloat snoise(vec3 v)\r\n  { \r\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\r\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\r\n\r\n// First corner\r\n  vec3 i  = floor(v + dot(v, C.yyy) );\r\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\r\n\r\n// Other corners\r\n  vec3 g = step(x0.yzx, x0.xyz);\r\n  vec3 l = 1.0 - g;\r\n  vec3 i1 = min( g.xyz, l.zxy );\r\n  vec3 i2 = max( g.xyz, l.zxy );\r\n\r\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\r\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\r\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\r\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\r\n  vec3 x1 = x0 - i1 + C.xxx;\r\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\r\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\r\n\r\n// Permutations\r\n  i = mod289(i); \r\n  vec4 p = permute( permute( permute( \r\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\r\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \r\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\r\n\r\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\r\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\r\n  float n_ = 0.142857142857; // 1.0/7.0\r\n  vec3  ns = n_ * D.wyz - D.xzx;\r\n\r\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\r\n\r\n  vec4 x_ = floor(j * ns.z);\r\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\r\n\r\n  vec4 x = x_ *ns.x + ns.yyyy;\r\n  vec4 y = y_ *ns.x + ns.yyyy;\r\n  vec4 h = 1.0 - abs(x) - abs(y);\r\n\r\n  vec4 b0 = vec4( x.xy, y.xy );\r\n  vec4 b1 = vec4( x.zw, y.zw );\r\n\r\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\r\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\r\n  vec4 s0 = floor(b0)*2.0 + 1.0;\r\n  vec4 s1 = floor(b1)*2.0 + 1.0;\r\n  vec4 sh = -step(h, vec4(0.0));\r\n\r\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\r\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\r\n\r\n  vec3 p0 = vec3(a0.xy,h.x);\r\n  vec3 p1 = vec3(a0.zw,h.y);\r\n  vec3 p2 = vec3(a1.xy,h.z);\r\n  vec3 p3 = vec3(a1.zw,h.w);\r\n\r\n//Normalise gradients\r\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\r\n  p0 *= norm.x;\r\n  p1 *= norm.y;\r\n  p2 *= norm.z;\r\n  p3 *= norm.w;\r\n\r\n// Mix final noise value\r\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\r\n  m = m * m;\r\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \r\n                                dot(p2,x2), dot(p3,x3) ) );\r\n  }\r\n\r\nvec3 snoiseVec3( vec3 x ){\r\n\r\n  float s  = snoise(vec3( x ));\r\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\r\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\r\n  vec3 c = vec3( s , s1 , s2 );\r\n  return c;\r\n\r\n}\r\n\r\n\r\nvec3 curlNoise( vec3 p ){\r\n  \r\n  const float e = .1;\r\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\r\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\r\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\r\n\r\n  vec3 p_x0 = snoiseVec3( p - dx );\r\n  vec3 p_x1 = snoiseVec3( p + dx );\r\n  vec3 p_y0 = snoiseVec3( p - dy );\r\n  vec3 p_y1 = snoiseVec3( p + dy );\r\n  vec3 p_z0 = snoiseVec3( p - dz );\r\n  vec3 p_z1 = snoiseVec3( p + dz );\r\n\r\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\r\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\r\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\r\n\r\n  const float divisor = 1.0 / ( 2.0 * e );\r\n  return normalize( vec3( x , y , z ) * divisor );\r\n\r\n}\r\n\r\nfloat hash11(float p)\r\n{\r\n    p = fract(p * .1031);\r\n    p *= p + 33.33;\r\n    p *= p + p;\r\n    return fract(p);\r\n}\r\n\r\nvec3 computeBezier(float t) {\r\n\r\n    vec3 p0p1 = mix(_Points[0], _Points[1], t);\r\n    vec3 p1p2 = mix(_Points[1], _Points[2], t);\r\n    vec3 p2p3 = mix(_Points[2], _Points[3], t);\r\n\r\n    vec3 a = mix(p0p1, p1p2, t);\r\n    vec3 b = mix(p1p2, p2p3, t);\r\n\r\n    return mix(a, b, t);\r\n\r\n}\r\n\r\nvoid main() {\r\n\r\n    vec4 vel = texture2D(tMap, vUv);\r\n    vec4 pos = texture2D(_Position, vUv);\r\n    vec4 hash = texture2D(_Hash, vUv);\r\n\r\n    if(pos.w <= 0.0) {\r\n        vel.w = mix(_MinLifeRate, _MaxLifeRate, hash13(vec3(gl_FragCoord.xy, _Time*500.0 + 500.0)));\r\n    }\r\n\r\n    vec3 acc = vec3(0.0);\r\n    \r\n    vec3 jitter = hash.xyz*2.0-1.0;\r\n    float temporalOffset = _NoiseSampleSpread * (hash.w * 2.0 - 1.0);\r\n    \r\n    float noise = snoise((pos.xyz + (jitter * _NoiseJitterScale) * _SpatialF*_NoiseSpatialFScale) + ((_Time * _TemporalF)+temporalOffset));\r\n\r\n    float noiseSpatialF = mix(_SpatialF * 0.5, _SpatialF * 1.5, noise*0.5+0.5);\r\n    vec3 curlNoiseForce = curlNoise( (pos.xyz * noiseSpatialF) + ((_Time * _TemporalF)+temporalOffset)) * _Amp;\r\n\r\n    vec3 p0 = computeBezier(pos.w);\r\n    vec3 p1 = computeBezier(pos.w+EPS);\r\n    \r\n    vec3 tangent = normalize(p1 - p0);\r\n\r\n\r\n    float lifePhase = pos.w * 4.0 * (1.0 - pos.w);\r\n\r\n    vec3 pathForce = ((p0 + tangent * 3.0) - pos.xyz) * _PathForce;    \r\n    float forceBlend0 = mix(0.43, 0.76, noise*0.5+0.5);\r\n    float forceBlend1 = 0.23;\r\n    acc += mix(curlNoiseForce, pathForce, mix(forceBlend0, forceBlend1, lifePhase));\r\n\r\n    vel.xyz += acc;\r\n    vel.xyz *= INERTIA;\r\n\r\n    gl_FragColor = vel;\r\n\r\n}"},205:t=>{t.exports="precision highp float;\r\n\r\nuniform sampler2D tMap;\r\nuniform vec2 _Resolution;\r\n\r\nuniform float _StepSize;\r\nuniform float _Time;\r\n\r\nuniform float _Seed;\r\n\r\nvarying vec2 vUv;\r\n\r\n\r\nfloat hash12(vec2 p)\r\n{\r\n\tvec3 p3  = fract(vec3(p.xyx) * .1031);\r\n    p3 += dot(p3, p3.yzx + 33.33);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nvec3 hash32(vec2 p)\r\n{\r\n\tvec3 p3 = fract(vec3(p.xyx) * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yxz+33.33);\r\n    return fract((p3.xxy+p3.yzz)*p3.zyx);\r\n}\r\n\r\nvoid main() {\r\n    \r\n    vec2 texelSize = 1.0 / _Resolution;\r\n\r\n    vec3 col = texture2D(tMap, vUv + texelSize * _StepSize).xyz;\r\n    col += texture2D(tMap, vUv - texelSize * _StepSize).xyz;\r\n    col += texture2D(tMap, vUv + vec2(texelSize.x, -texelSize.y) * _StepSize).xyz;\r\n    col += texture2D(tMap, vUv + vec2(-texelSize.x, +texelSize.y) * _StepSize).xyz;\r\n    col /= 4.0;\r\n\r\n    vec3 hash1 = hash32(gl_FragCoord.xy+fract(_Time)*1300.0 + _Seed * 150.0);\r\n    vec3 hash2 = hash32(gl_FragCoord.yx+fract(_Time+0.3123)*1300.0 + _Seed * 137.0);\r\n    vec3 dither = ((hash1) + (hash2-1.0)) / 255.0;\r\n\r\n    // Output to screen\r\n    gl_FragColor = vec4(col+dither,1.0);\r\n\r\n}"},208:t=>{t.exports="precision highp float;\r\n\r\nuniform sampler2D tMap;\r\nuniform float _Time;\r\n\r\nvarying vec2 vUv;\r\n\r\nfloat hash12(vec2 p)\r\n{\r\n\tvec3 p3  = fract(vec3(p.xyx) * .1031);\r\n    p3 += dot(p3, p3.yzx + 33.33);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nvec3 hash32(vec2 p)\r\n{\r\n\tvec3 p3 = fract(vec3(p.xyx) * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yxz+33.33);\r\n    return fract((p3.xxy+p3.yzz)*p3.zyx);\r\n}\r\n\r\nvoid main() {\r\n\r\n    vec3 col = texture2D(tMap, vUv).xyz;\r\n\r\n    vec3 hash1 = hash32(gl_FragCoord.xy+fract(_Time)*1300.0);\r\n    vec3 hash2 = hash32(gl_FragCoord.yx+fract(_Time+0.3123)*1300.0);\r\n    vec3 dither = ((hash1) + (hash2-1.0)) / 255.0;\r\n\r\n    gl_FragColor = vec4(col+dither, 1.0);\r\n\r\n}"},87:t=>{t.exports="                precision highp float;\r\n                // Default uniform for previous pass is 'tMap'.\r\n                // Can change this using the 'textureUniform' property\r\n                // when adding a pass.\r\n                uniform sampler2D tMap;\r\n                uniform vec2 _Resolution;\r\n                varying vec2 vUv;\r\n                vec4 fxaa(sampler2D tex, vec2 uv, vec2 resolution) {\r\n                    vec2 pixel = vec2(1) / resolution;\r\n                    vec3 l = vec3(0.299, 0.587, 0.114);\r\n                    float lNW = dot(texture2D(tex, uv + vec2(-1, -1) * pixel).rgb, l);\r\n                    float lNE = dot(texture2D(tex, uv + vec2( 1, -1) * pixel).rgb, l);\r\n                    float lSW = dot(texture2D(tex, uv + vec2(-1,  1) * pixel).rgb, l);\r\n                    float lSE = dot(texture2D(tex, uv + vec2( 1,  1) * pixel).rgb, l);\r\n                    float lM  = dot(texture2D(tex, uv).rgb, l);\r\n                    float lMin = min(lM, min(min(lNW, lNE), min(lSW, lSE)));\r\n                    float lMax = max(lM, max(max(lNW, lNE), max(lSW, lSE)));\r\n                    \r\n                    vec2 dir = vec2(\r\n                        -((lNW + lNE) - (lSW + lSE)),\r\n                        ((lNW + lSW) - (lNE + lSE))\r\n                    );\r\n                    \r\n                    float dirReduce = max((lNW + lNE + lSW + lSE) * 0.03125, 0.0078125);\r\n                    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\r\n                    dir = min(vec2(8, 8), max(vec2(-8, -8), dir * rcpDirMin)) * pixel;\r\n                    \r\n                    vec3 rgbA = 0.5 * (\r\n                        texture2D(tex, uv + dir * (1.0 / 3.0 - 0.5)).rgb +\r\n                        texture2D(tex, uv + dir * (2.0 / 3.0 - 0.5)).rgb);\r\n                    vec3 rgbB = rgbA * 0.5 + 0.25 * (\r\n                        texture2D(tex, uv + dir * -0.5).rgb +\r\n                        texture2D(tex, uv + dir * 0.5).rgb);\r\n                    float lB = dot(rgbB, l);\r\n                    return mix(\r\n                        vec4(rgbB, 1),\r\n                        vec4(rgbA, 1),\r\n                        max(sign(lB - lMin), 0.0) * max(sign(lB - lMax), 0.0)\r\n                    );\r\n                }\r\n\r\n                \r\n                void main() {\r\n                    vec4 raw = texture2D(tMap, vUv);\r\n                    vec4 aa = fxaa(tMap, vUv, _Resolution);\r\n                    // Split screen in half to show side-by-side comparison\r\n                    gl_FragColor = aa;\r\n                    // Darken left side a tad for clarity\r\n                    // gl_FragColor -= step(vUv.x, 0.5) * 0.1;\r\n                }"},631:t=>{t.exports="precision highp float;\r\n\r\nuniform sampler2D tMap;\r\nuniform sampler2D _Base;\r\nuniform sampler2D _Blur;\r\nuniform sampler2D _Depth;\r\n\r\nuniform float _Time;\r\n\r\nvarying vec2 vUv;\r\n\r\n//https://www.geeks3d.com/20091216/geexlab-how-to-visualize-the-depth-buffer-in-glsl/\r\nfloat LinearizeDepth(float depth) \r\n{\r\n    float z = depth;\r\n    return (2.0 * 0.1) / (100.0 + 0.1 - z * (100.0 - 0.1));\r\n}\r\n\r\nvec3 screenBlend(vec3 a, vec3 b) {\r\n\r\n    return 1.0 - ((1.0 - a) * (1.0 - b));\r\n\r\n}\r\n\r\nfloat hash12(vec2 p)\r\n{\r\n\tvec3 p3  = fract(vec3(p.xyx) * .1031);\r\n    p3 += dot(p3, p3.yzx + 33.33);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nvec3 hash32(vec2 p)\r\n{\r\n\tvec3 p3 = fract(vec3(p.xyx) * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yxz+33.33);\r\n    return fract((p3.xxy+p3.yzz)*p3.zyx);\r\n}\r\n\r\nvoid main() {\r\n\r\n    vec3 layerA = texture2D(tMap, vUv).xyz;\r\n    vec3 layerB = texture2D(_Blur, vUv).xyz;\r\n    vec3 screen = screenBlend(layerA, layerB);\r\n\r\n    vec3 hash1 = hash32(gl_FragCoord.xy+fract(_Time)*1300.0);\r\n    vec3 hash2 = hash32(gl_FragCoord.yx+fract(_Time+0.3123)*1300.0);\r\n    vec3 dither = ((hash1) + (hash2-1.0)) / 255.0;\r\n\r\n    gl_FragColor = vec4(screen + dither, 1.0);\r\n\r\n}"},821:t=>{t.exports="precision highp float;\r\n\r\nuniform sampler2D _BasePass;\r\nuniform sampler2D _Depth;\r\nuniform vec3 _CameraWorldPos;\r\n\r\nuniform float _Near;\r\nuniform float _Far;\r\n\r\nuniform float _Time;\r\n\r\nvarying vec3 vViewRay;\r\nvarying vec2 vUv;\r\n\r\n//https://www.geeks3d.com/20091216/geexlab-how-to-visualize-the-depth-buffer-in-glsl/\r\nfloat LinearizeDepth(float depth) \r\n{\r\n    float z = depth;\r\n    return (2.0 * _Near) / (_Far + _Near - z * (_Far - _Near));\r\n}\r\n\r\nvec3 hash32(vec2 p)\r\n{\r\n\tvec3 p3 = fract(vec3(p.xyx) * vec3(.1031, .1030, .0973));\r\n    p3 += dot(p3, p3.yxz+33.33);\r\n    return fract((p3.xxy+p3.yzz)*p3.zyx);\r\n}\r\n\r\nvoid main() {\r\n\r\n    float depth = LinearizeDepth(texture2D(_Depth, vUv).x);\r\n\r\n    vec3 viewRay = vViewRay * depth;\r\n    vec3 worldPos = viewRay + _CameraWorldPos;\r\n\r\n    vec3 col = texture2D(_BasePass, vUv).xyz;\r\n\r\n    float dist = length(worldPos);\r\n    float fog = smoothstep(_Near, _Far, dist);\r\n    col = mix(col, vec3(0.8, 0.84, 0.93)*0.85, fog);\r\n\r\n    vec3 hash1 = hash32(gl_FragCoord.xy+fract(_Time)*1300.0);\r\n    vec3 hash2 = hash32(gl_FragCoord.yx+fract(_Time+0.3123)*1300.0);\r\n    vec3 dither = ((hash1) + (hash2-1.0)) / 255.0;\r\n\r\n    gl_FragColor = vec4(col + dither, 1.0);\r\n\r\n}"},990:t=>{t.exports="precision highp float;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv;\r\nattribute float frustumCornerIndex;\r\n\r\nuniform mat4 _MainCameraViewMatrix;\r\nuniform mat4 _MainCameraInvViewMatrix;\r\nuniform vec3 _CameraWorldPos;\r\n\r\nuniform vec3 _FrustumCorners[4];\r\n\r\nvarying vec3 vViewRay;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = vec4(position, 1.0);\r\n    vViewRay = (_MainCameraInvViewMatrix * vec4(_FrustumCorners[int(frustumCornerIndex)], 0.0)).xyz;\r\n    vUv = uv;\r\n}\r\n\r\n"},923:t=>{t.exports="precision highp float;\r\n\r\nuniform sampler2D _Normal;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n    vec3 n = texture2D(_Normal, vUv).xyz;\r\n    if(n.x <= 0.0) discard;\r\n\r\n    gl_FragColor = vec4(n, 1.0);\r\n\r\n}"},447:t=>{t.exports="precision highp float;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n    vUv = uv;\r\n\r\n}"}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t){let e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function e(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function i(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function r(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function o(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function s(t){let e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function a(t,e){let n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function h(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function l(t,e,n){let i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2];return t[0]=r*h-o*a,t[1]=o*s-i*h,t[2]=i*a-r*s,t}const u=function(){const t=[0,0,0],n=[0,0,0];return function(i,r){e(t,i),e(n,r),a(t,t),a(n,n);let o=h(t,n);return o>1?0:o<-1?Math.PI:Math.acos(o)}}();class p extends Array{constructor(t=0,e=t,n=t){return super(t,e,n),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,n=t){return t.length?this.copy(t):(function(t,e,n,i){t[0]=e,t[1]=n,t[2]=i}(this,t,e,n),this)}copy(t){return e(this,t),this}add(t,e){return e?i(this,t,e):i(this,this,t),this}sub(t,e){return e?r(this,t,e):r(this,this,t),this}multiply(t){var e,n,i;return t.length?(n=this,i=t,(e=this)[0]=n[0]*i[0],e[1]=n[1]*i[1],e[2]=n[2]*i[2]):o(this,this,t),this}divide(t){var e,n,i;return t.length?(n=this,i=t,(e=this)[0]=n[0]/i[0],e[1]=n[1]/i[1],e[2]=n[2]/i[2]):o(this,this,1/t),this}inverse(t=this){var e,n;return n=t,(e=this)[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],this}len(){return t(this)}distance(e){return e?function(t,e){let n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)}(this,e):t(this)}squaredLen(){return s(this)}squaredDistance(t){return t?function(t,e){let n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}(this,t):s(this)}negate(t=this){var e,n;return n=t,(e=this)[0]=-n[0],e[1]=-n[1],e[2]=-n[2],this}cross(t,e){return e?l(this,t,e):l(this,this,t),this}scale(t){return o(this,this,t),this}normalize(){return a(this,this),this}dot(t){return h(this,t)}equals(t){return e=t,this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2];var e}applyMatrix4(t){return function(t,e,n){let i=e[0],r=e[1],o=e[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];s=s||1,t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/s,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s}(this,this,t),this}scaleRotateMatrix4(t){return function(t,e,n){let i=e[0],r=e[1],o=e[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];s=s||1,t[0]=(n[0]*i+n[4]*r+n[8]*o)/s,t[1]=(n[1]*i+n[5]*r+n[9]*o)/s,t[2]=(n[2]*i+n[6]*r+n[10]*o)/s}(this,this,t),this}applyQuaternion(t){return function(t,e,n){let i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2],l=a*o-h*r,u=h*i-s*o,p=s*r-a*i,c=a*p-h*u,d=h*l-s*p,v=s*u-a*l,f=2*n[3];l*=f,u*=f,p*=f,c*=2,d*=2,v*=2,t[0]=i+l+c,t[1]=r+u+d,t[2]=o+p+v}(this,this,t),this}angle(t){return u(this,t)}lerp(t,e){return function(t,e,n,i){let r=e[0],o=e[1],s=e[2];t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=s+i*(n[2]-s)}(this,this,t,e),this}clone(){return new p(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){const e=this[0],n=this[1],i=this[2];return this[0]=t[0]*e+t[4]*n+t[8]*i,this[1]=t[1]*e+t[5]*n+t[9]*i,this[2]=t[2]*e+t[6]*n+t[10]*i,this.normalize()}}const c=new p;let d=1;class v{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:n=150,dpr:i=1,alpha:r=!1,depth:o=!0,stencil:s=!1,antialias:a=!1,premultipliedAlpha:h=!1,preserveDrawingBuffer:l=!1,powerPreference:u="default",autoClear:p=!0,webgl:c=2}={}){const v={alpha:r,depth:o,stencil:s,antialias:a,premultipliedAlpha:h,preserveDrawingBuffer:l,powerPreference:u};this.dpr=i,this.alpha=r,this.color=!0,this.depth=o,this.stencil=s,this.premultipliedAlpha=h,this.autoClear=p,this.id=d++,2===c&&(this.gl=t.getContext("webgl2",v)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",v)||t.getContext("experimental-webgl",v)),this.gl.renderer=this,this.setSize(e,n),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr}setViewport(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,n,i){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===n&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=n,this.state.blendFunc.dstAlpha=i,void 0!==n?this.gl.blendFuncSeparate(t,e,n,i):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,n){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][n].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:n,sort:i}){let r=[];if(e&&n&&e.updateFrustum(),t.traverse((t=>{if(!t.visible)return!0;t.draw&&(n&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t)||r.push(t))})),i){const t=[],n=[],i=[];r.forEach((r=>{r.program.transparent?r.program.depthTest?n.push(r):i.push(r):t.push(r),r.zDepth=0,0===r.renderOrder&&r.program.depthTest&&e&&(r.worldMatrix.getTranslation(c),c.applyMatrix4(e.projectionViewMatrix),r.zDepth=c.z)})),t.sort(this.sortOpaque),n.sort(this.sortTransparent),i.sort(this.sortUI),r=t.concat(n,i)}return r}render({scene:t,camera:e,target:n=null,update:i=!0,sort:r=!0,frustumCull:o=!0,clear:s}){null===n?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(n),this.setViewport(n.width,n.height)),(s||this.autoClear&&!1!==s)&&(!this.depth||n&&!n.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),i&&t.updateMatrixWorld(),e&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:o,sort:r}).forEach((t=>{t.draw({camera:e})}))}}function f(t,e,n){let i=e[0],r=e[1],o=e[2],s=e[3],a=n[0],h=n[1],l=n[2],u=n[3];return t[0]=i*u+s*a+r*l-o*h,t[1]=r*u+s*h+o*a-i*l,t[2]=o*u+s*l+i*h-r*a,t[3]=s*u-i*a-r*h-o*l,t}class m extends Array{constructor(t=0,e=0,n=0,i=1){return super(t,e,n,i),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set w(t){this[3]=t,this.onChange()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}set(t,e,n,i){return t.length?this.copy(t):(function(t,e,n,i,r){t[0]=e,t[1]=n,t[2]=i,t[3]=r}(this,t,e,n,i),this.onChange(),this)}rotateX(t){return function(t,e,n){n*=.5;let i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),h=Math.cos(n);t[0]=i*h+s*a,t[1]=r*h+o*a,t[2]=o*h-r*a,t[3]=s*h-i*a}(this,this,t),this.onChange(),this}rotateY(t){return function(t,e,n){n*=.5;let i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),h=Math.cos(n);t[0]=i*h-o*a,t[1]=r*h+s*a,t[2]=o*h+i*a,t[3]=s*h-r*a}(this,this,t),this.onChange(),this}rotateZ(t){return function(t,e,n){n*=.5;let i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),h=Math.cos(n);t[0]=i*h+r*a,t[1]=r*h-i*a,t[2]=o*h+s*a,t[3]=s*h-o*a}(this,this,t),this.onChange(),this}inverse(t=this){return function(t,e){let n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=o*a}(this,t),this.onChange(),this}conjugate(t=this){var e,n;return n=t,(e=this)[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=n[3],this.onChange(),this}copy(t){return n=t,(e=this)[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],this.onChange(),this;var e,n}normalize(t=this){return function(t,e){let n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o;s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=i*s,t[2]=r*s,t[3]=o*s}(this,t),this.onChange(),this}multiply(t,e){return e?f(this,t,e):f(this,this,t),this.onChange(),this}dot(t){return n=t,(e=this)[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3];var e,n}fromMatrix3(t){return function(t,e){let n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);let r=(i+1)%3,o=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*r+r]-e[3*o+o]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*r+o]-e[3*o+r])*n,t[r]=(e[3*r+i]+e[3*i+r])*n,t[o]=(e[3*o+i]+e[3*i+o])*n}}(this,t),this.onChange(),this}fromEuler(t){return function(t,e,n="YXZ"){let i=Math.sin(.5*e[0]),r=Math.cos(.5*e[0]),o=Math.sin(.5*e[1]),s=Math.cos(.5*e[1]),a=Math.sin(.5*e[2]),h=Math.cos(.5*e[2]);"XYZ"===n?(t[0]=i*s*h+r*o*a,t[1]=r*o*h-i*s*a,t[2]=r*s*a+i*o*h,t[3]=r*s*h-i*o*a):"YXZ"===n?(t[0]=i*s*h+r*o*a,t[1]=r*o*h-i*s*a,t[2]=r*s*a-i*o*h,t[3]=r*s*h+i*o*a):"ZXY"===n?(t[0]=i*s*h-r*o*a,t[1]=r*o*h+i*s*a,t[2]=r*s*a+i*o*h,t[3]=r*s*h-i*o*a):"ZYX"===n?(t[0]=i*s*h-r*o*a,t[1]=r*o*h+i*s*a,t[2]=r*s*a-i*o*h,t[3]=r*s*h+i*o*a):"YZX"===n?(t[0]=i*s*h+r*o*a,t[1]=r*o*h+i*s*a,t[2]=r*s*a-i*o*h,t[3]=r*s*h-i*o*a):"XZY"===n&&(t[0]=i*s*h-r*o*a,t[1]=r*o*h-i*s*a,t[2]=r*s*a+i*o*h,t[3]=r*s*h+i*o*a)}(this,t,t.order),this}fromAxisAngle(t,e){return function(t,e,n){n*=.5;let i=Math.sin(n);t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n)}(this,t,e),this}slerp(t,e){return function(t,e,n,i){let r,o,s,a,h,l=e[0],u=e[1],p=e[2],c=e[3],d=n[0],v=n[1],f=n[2],m=n[3];o=l*d+u*v+p*f+c*m,o<0&&(o=-o,d=-d,v=-v,f=-f,m=-m),1-o>1e-6?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-i)*r)/s,h=Math.sin(i*r)/s):(a=1-i,h=i),t[0]=a*l+h*d,t[1]=a*u+h*v,t[2]=a*p+h*f,t[3]=a*c+h*m}(this,this,t,e),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}function g(t,e,n){let i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],p=e[8],c=e[9],d=e[10],v=e[11],f=e[12],m=e[13],g=e[14],b=e[15],x=n[0],_=n[1],w=n[2],y=n[3];return t[0]=x*i+_*a+w*p+y*f,t[1]=x*r+_*h+w*c+y*m,t[2]=x*o+_*l+w*d+y*g,t[3]=x*s+_*u+w*v+y*b,x=n[4],_=n[5],w=n[6],y=n[7],t[4]=x*i+_*a+w*p+y*f,t[5]=x*r+_*h+w*c+y*m,t[6]=x*o+_*l+w*d+y*g,t[7]=x*s+_*u+w*v+y*b,x=n[8],_=n[9],w=n[10],y=n[11],t[8]=x*i+_*a+w*p+y*f,t[9]=x*r+_*h+w*c+y*m,t[10]=x*o+_*l+w*d+y*g,t[11]=x*s+_*u+w*v+y*b,x=n[12],_=n[13],w=n[14],y=n[15],t[12]=x*i+_*a+w*p+y*f,t[13]=x*r+_*h+w*c+y*m,t[14]=x*o+_*l+w*d+y*g,t[15]=x*s+_*u+w*v+y*b,t}function b(t,e){let n=e[0],i=e[1],r=e[2],o=e[4],s=e[5],a=e[6],h=e[8],l=e[9],u=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(o,s,a),t[2]=Math.hypot(h,l,u),t}const x=function(){const t=[0,0,0];return function(e,n){let i=t;b(i,n);let r=1/i[0],o=1/i[1],s=1/i[2],a=n[0]*r,h=n[1]*o,l=n[2]*s,u=n[4]*r,p=n[5]*o,c=n[6]*s,d=n[8]*r,v=n[9]*o,f=n[10]*s,m=a+p+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(c-v)/g,e[1]=(d-l)/g,e[2]=(h-u)/g):a>p&&a>f?(g=2*Math.sqrt(1+a-p-f),e[3]=(c-v)/g,e[0]=.25*g,e[1]=(h+u)/g,e[2]=(d+l)/g):p>f?(g=2*Math.sqrt(1+p-a-f),e[3]=(d-l)/g,e[0]=(h+u)/g,e[1]=.25*g,e[2]=(c+v)/g):(g=2*Math.sqrt(1+f-a-p),e[3]=(h-u)/g,e[0]=(d+l)/g,e[1]=(c+v)/g,e[2]=.25*g),e}}();class _ extends Array{constructor(t=1,e=0,n=0,i=0,r=0,o=1,s=0,a=0,h=0,l=0,u=1,p=0,c=0,d=0,v=0,f=1){return super(t,e,n,i,r,o,s,a,h,l,u,p,c,d,v,f),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,n,i,r,o,s,a,h,l,u,p,c,d,v,f){return t.length?this.copy(t):(function(t,e,n,i,r,o,s,a,h,l,u,p,c,d,v,f,m){t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=l,t[9]=u,t[10]=p,t[11]=c,t[12]=d,t[13]=v,t[14]=f,t[15]=m}(this,t,e,n,i,r,o,s,a,h,l,u,p,c,d,v,f),this)}translate(t,e=this){return function(t,e,n){let i,r,o,s,a,h,l,u,p,c,d,v,f=n[0],m=n[1],g=n[2];e===t?(t[12]=e[0]*f+e[4]*m+e[8]*g+e[12],t[13]=e[1]*f+e[5]*m+e[9]*g+e[13],t[14]=e[2]*f+e[6]*m+e[10]*g+e[14],t[15]=e[3]*f+e[7]*m+e[11]*g+e[15]):(i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],p=e[8],c=e[9],d=e[10],v=e[11],t[0]=i,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=l,t[7]=u,t[8]=p,t[9]=c,t[10]=d,t[11]=v,t[12]=i*f+a*m+p*g+e[12],t[13]=r*f+h*m+c*g+e[13],t[14]=o*f+l*m+d*g+e[14],t[15]=s*f+u*m+v*g+e[15])}(this,e,t),this}rotate(t,e,n=this){return function(t,e,n,i){let r,o,s,a,h,l,u,p,c,d,v,f,m,g,b,x,_,w,y,E,C,P,M,k,S=i[0],A=i[1],z=i[2],V=Math.hypot(S,A,z);Math.abs(V)<1e-6||(V=1/V,S*=V,A*=V,z*=V,r=Math.sin(n),o=Math.cos(n),s=1-o,a=e[0],h=e[1],l=e[2],u=e[3],p=e[4],c=e[5],d=e[6],v=e[7],f=e[8],m=e[9],g=e[10],b=e[11],x=S*S*s+o,_=A*S*s+z*r,w=z*S*s-A*r,y=S*A*s-z*r,E=A*A*s+o,C=z*A*s+S*r,P=S*z*s+A*r,M=A*z*s-S*r,k=z*z*s+o,t[0]=a*x+p*_+f*w,t[1]=h*x+c*_+m*w,t[2]=l*x+d*_+g*w,t[3]=u*x+v*_+b*w,t[4]=a*y+p*E+f*C,t[5]=h*y+c*E+m*C,t[6]=l*y+d*E+g*C,t[7]=u*y+v*E+b*C,t[8]=a*P+p*M+f*k,t[9]=h*P+c*M+m*k,t[10]=l*P+d*M+g*k,t[11]=u*P+v*M+b*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,n,t,e),this}scale(t,e=this){return function(t,e,n){let i=n[0],r=n[1],o=n[2];t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this,e,"number"==typeof t?[t,t,t]:t),this}multiply(t,e){return e?g(this,t,e):g(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,n;return n=t,(e=this)[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}fromPerspective({fov:t,aspect:e,near:n,far:i}={}){return function(t,e,n,i,r){let o=1/Math.tan(e/2),s=1/(i-r);t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*s,t[15]=0}(this,t,e,n,i),this}fromOrthogonal({left:t,right:e,bottom:n,top:i,near:r,far:o}){return function(t,e,n,i,r,o,s){let a=1/(e-n),h=1/(i-r),l=1/(o-s);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*h,t[14]=(s+o)*l,t[15]=1}(this,t,e,n,i,r,o),this}fromQuaternion(t){return function(t,e){let n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,h=r+r,l=n*s,u=i*s,p=i*a,c=r*s,d=r*a,v=r*h,f=o*s,m=o*a,g=o*h;t[0]=1-p-v,t[1]=u+g,t[2]=c-m,t[3]=0,t[4]=u-g,t[5]=1-l-v,t[6]=d+f,t[7]=0,t[8]=c+m,t[9]=d-f,t[10]=1-l-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){return function(t,e){let n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],p=e[9],c=e[10],d=e[11],v=e[12],f=e[13],m=e[14],g=e[15],b=n*a-i*s,x=n*h-r*s,_=n*l-o*s,w=i*h-r*a,y=i*l-o*a,E=r*l-o*h,C=u*f-p*v,P=u*m-c*v,M=u*g-d*v,k=p*m-c*f,S=p*g-d*f,A=c*g-d*m,z=b*A-x*S+_*k+w*M-y*P+E*C;z&&(z=1/z,t[0]=(a*A-h*S+l*k)*z,t[1]=(r*S-i*A-o*k)*z,t[2]=(f*E-m*y+g*w)*z,t[3]=(c*y-p*E-d*w)*z,t[4]=(h*M-s*A-l*P)*z,t[5]=(n*A-r*M+o*P)*z,t[6]=(m*_-v*E-g*x)*z,t[7]=(u*E-c*_+d*x)*z,t[8]=(s*S-a*M+l*C)*z,t[9]=(i*M-n*S-o*C)*z,t[10]=(v*y-f*_+g*b)*z,t[11]=(p*_-u*y-d*b)*z,t[12]=(a*P-s*k-h*C)*z,t[13]=(n*k-i*P+r*C)*z,t[14]=(f*x-v*w-m*b)*z,t[15]=(u*w-p*x+c*b)*z)}(this,t),this}compose(t,e,n){return function(t,e,n,i){let r=e[0],o=e[1],s=e[2],a=e[3],h=r+r,l=o+o,u=s+s,p=r*h,c=r*l,d=r*u,v=o*l,f=o*u,m=s*u,g=a*h,b=a*l,x=a*u,_=i[0],w=i[1],y=i[2];t[0]=(1-(v+m))*_,t[1]=(c+x)*_,t[2]=(d-b)*_,t[3]=0,t[4]=(c-x)*w,t[5]=(1-(p+m))*w,t[6]=(f+g)*w,t[7]=0,t[8]=(d+b)*y,t[9]=(f-g)*y,t[10]=(1-(p+v))*y,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1}(this,t,e,n),this}getRotation(t){return x(t,this),this}getTranslation(t){var e,n;return n=this,(e=t)[0]=n[12],e[1]=n[13],e[2]=n[14],this}getScaling(t){return b(t,this),this}getMaxScaleOnAxis(){return function(t){let e=t[0],n=t[1],i=t[2],r=t[4],o=t[5],s=t[6],a=t[8],h=t[9],l=t[10];const u=e*e+n*n+i*i,p=r*r+o*o+s*s,c=a*a+h*h+l*l;return Math.sqrt(Math.max(u,p,c))}(this)}lookAt(t,e,n){return function(t,e,n,i){let r=e[0],o=e[1],s=e[2],a=i[0],h=i[1],l=i[2],u=r-n[0],p=o-n[1],c=s-n[2],d=u*u+p*p+c*c;0===d?c=1:(d=1/Math.sqrt(d),u*=d,p*=d,c*=d);let v=h*c-l*p,f=l*u-a*c,m=a*p-h*u;d=v*v+f*f+m*m,0===d&&(l?a+=1e-6:h?l+=1e-6:h+=1e-6,v=h*c-l*p,f=l*u-a*c,m=a*p-h*u,d=v*v+f*f+m*m),d=1/Math.sqrt(d),v*=d,f*=d,m*=d,t[0]=v,t[1]=f,t[2]=m,t[3]=0,t[4]=p*m-c*f,t[5]=c*v-u*m,t[6]=u*f-p*v,t[7]=0,t[8]=u,t[9]=p,t[10]=c,t[11]=0,t[12]=r,t[13]=o,t[14]=s,t[15]=1}(this,t,e,n),this}determinant(){return function(t){let e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],h=t[7],l=t[8],u=t[9],p=t[10],c=t[11],d=t[12],v=t[13],f=t[14],m=t[15];return(e*s-n*o)*(p*m-c*f)-(e*a-i*o)*(u*m-c*v)+(e*h-r*o)*(u*f-p*v)+(n*a-i*s)*(l*m-c*d)-(n*h-r*s)*(l*f-p*d)+(i*h-r*a)*(l*v-u*d)}(this)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}}const w=new _;class y extends Array{constructor(t=0,e=t,n=t,i="YXZ"){return super(t,e,n),this.order=i,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set(t,e=t,n=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=n,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return function(t,e,n="YXZ"){"XYZ"===n?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===n?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===n?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===n?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===n?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===n&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this}fromQuaternion(t,e=this.order){return w.fromQuaternion(t),this.fromRotationMatrix(w,e)}}class E{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new _,this.worldMatrix=new _,this.matrixAutoUpdate=!0,this.position=new p,this.quaternion=new m,this.scale=new p(1),this.rotation=new y,this.up=new p(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){e&&this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,n=this.children.length;e<n;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,n=this.children.length;e<n;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const C=new _,P=new p,M=new p;class k extends E{constructor(t,{near:e=.1,far:n=100,fov:i=45,aspect:r=1,left:o,right:s,bottom:a,top:h,zoom:l=1}={}){super(),Object.assign(this,{near:e,far:n,fov:i,aspect:r,left:o,right:s,bottom:a,top:h,zoom:l}),this.projectionMatrix=new _,this.viewMatrix=new _,this.projectionViewMatrix=new _,this.worldPosition=new p,this.type=o||s?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:n=this.fov,aspect:i=this.aspect}={}){return Object.assign(this,{near:t,far:e,fov:n,aspect:i}),this.projectionMatrix.fromPerspective({fov:n*(Math.PI/180),aspect:i,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:n=this.left,right:i=this.right,bottom:r=this.bottom,top:o=this.top,zoom:s=this.zoom}={}){return Object.assign(this,{near:t,far:e,left:n,right:i,bottom:r,top:o,zoom:s}),n/=s,i/=s,r/=s,o/=s,this.projectionMatrix.fromOrthogonal({left:n,right:i,bottom:r,top:o,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(C.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new p,new p,new p,new p,new p,new p]);const t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let t=0;t<6;t++){const e=1/this.frustum[t].distance();this.frustum[t].multiply(e),this.frustum[t].constant*=e}}frustumIntersectsMesh(t){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;const e=P;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);const n=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,n)}frustumIntersectsSphere(t,e){const n=M;for(let i=0;i<6;i++){const r=this.frustum[i];if(n.copy(r).dot(t)+r.constant<-e)return!1}return!0}}function S(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function A(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function z(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function V(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function F(t,e){return t[0]*e[1]-t[1]*e[0]}class T extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}set(t,e=t){return t.length?this.copy(t):(function(t,e,n){t[0]=e,t[1]=n}(this,t,e),this)}copy(t){var e,n;return n=t,(e=this)[0]=n[0],e[1]=n[1],this}add(t,e){return e?S(this,t,e):S(this,this,t),this}sub(t,e){return e?A(this,t,e):A(this,this,t),this}multiply(t){var e,n;return t.length?(this,n=t,(e=this)[0]=this[0]*n[0],e[1]=this[1]*n[1]):z(this,this,t),this}divide(t){var e,n;return t.length?(this,n=t,(e=this)[0]=this[0]/n[0],e[1]=this[1]/n[1]):z(this,this,1/t),this}inverse(t=this){var e,n;return n=t,(e=this)[0]=1/n[0],e[1]=1/n[1],this}len(){return V(this)}distance(t){return t?(this,n=(e=t)[0]-this[0],i=e[1]-this[1],Math.sqrt(n*n+i*i)):V(this);var e,n,i}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?(this,(n=(e=t)[0]-this[0])*n+(i=e[1]-this[1])*i):function(t){var e=t[0],n=t[1];return e*e+n*n}(this);var e,n,i}negate(t=this){var e,n;return n=t,(e=this)[0]=-n[0],e[1]=-n[1],this}cross(t,e){return e?F(t,e):F(this,t)}scale(t){return z(this,this,t),this}normalize(){var t,e,n,i;return this,(i=(e=(t=this)[0])*e+(n=t[1])*n)>0&&(i=1/Math.sqrt(i)),this[0]=t[0]*i,this[1]=t[1]*i,this}dot(t){return e=t,this[0]*e[0]+this[1]*e[1];var e}equals(t){return e=t,this[0]===e[0]&&this[1]===e[1];var e}applyMatrix3(t){var e,n,i;return this,e=t,n=this[0],i=this[1],this[0]=e[0]*n+e[3]*i+e[6],this[1]=e[1]*n+e[4]*i+e[7],this}applyMatrix4(t){return function(t,e,n){let i=e[0],r=e[1];t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13]}(this,this,t),this}lerp(t,e){!function(t,e,n,i){var r=e[0],o=e[1];t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o)}(this,this,t,e)}clone(){return new T(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}}const L=-1,D=new p,R=new T,I=new T;function N(t,{element:e=document,enabled:n=!0,target:i=new p,ease:r=.25,inertia:o=.85,enableRotate:s=!0,rotateSpeed:a=.1,autoRotate:h=!1,autoRotateSpeed:l=1,enableZoom:u=!0,zoomSpeed:c=1,enablePan:d=!0,panSpeed:v=.1,minPolarAngle:f=0,maxPolarAngle:m=Math.PI,minAzimuthAngle:g=-1/0,maxAzimuthAngle:b=1/0,minDistance:x=0,maxDistance:_=1/0}={}){this.enabled=n,this.target=i,r=r||1,o=o||0,this.minDistance=x,this.maxDistance=_;const w={radius:1,phi:0,theta:0},y={radius:1,phi:0,theta:0},E={radius:1,phi:0,theta:0},C=new p,P=new p;P.copy(t.position).sub(this.target),E.radius=y.radius=P.distance(),E.theta=y.theta=Math.atan2(P.x,P.z),E.phi=y.phi=Math.acos(Math.min(Math.max(P.y/y.radius,-1),1)),this.offset=P,this.update=()=>{h&&function(){const t=2*Math.PI/60/60*l;w.theta-=t}(),y.radius*=w.radius,y.theta+=w.theta,y.phi+=w.phi,y.theta=Math.max(g,Math.min(b,y.theta)),y.phi=Math.max(f,Math.min(m,y.phi)),y.radius=Math.max(this.minDistance,Math.min(this.maxDistance,y.radius)),E.phi+=(y.phi-E.phi)*r,E.theta+=(y.theta-E.theta)*r,E.radius+=(y.radius-E.radius)*r,this.target.add(C);let e=E.radius*Math.sin(Math.max(1e-6,E.phi));P.x=e*Math.sin(E.theta),P.y=E.radius*Math.cos(E.phi),P.z=e*Math.cos(E.theta),t.position.copy(this.target).add(P),t.lookAt(this.target),w.theta*=o,w.phi*=o,C.multiply(o),w.radius=1},this.forcePosition=()=>{P.copy(t.position).sub(this.target),E.radius=y.radius=P.distance(),E.theta=y.theta=Math.atan2(P.x,P.z),E.phi=y.phi=Math.acos(Math.min(Math.max(P.y/y.radius,-1),1)),t.lookAt(this.target)};const M=new T,k=new T,S=new T;let A=L;function z(){return Math.pow(.95,c)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};const V=(n,i)=>{let r=e===document?document.body:e;D.copy(t.position).sub(this.target);let o=D.distance();var s,a;o*=Math.tan((t.fov||45)/2*Math.PI/180),s=2*n*o/r.clientHeight,a=t.matrix,D.set(a[0],a[1],a[2]),D.multiply(-s),C.add(D),function(t,e){D.set(e[4],e[5],e[6]),D.multiply(t),C.add(D)}(2*i*o/r.clientHeight,t.matrix)};function F(t){w.radius/=t}function N(t,n){R.set(t,n),I.sub(R,M).multiply(a);let i=e===document?document.body:e;w.theta-=2*Math.PI*I.x/i.clientHeight,w.phi-=2*Math.PI*I.y/i.clientHeight,M.copy(R)}function B(t,e){R.set(t,e),I.sub(R,k).multiply(v),V(I.x,I.y),k.copy(R)}const O=t=>{if(this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===s)return;M.set(t.clientX,t.clientY),A=0;break;case this.mouseButtons.ZOOM:if(!1===u)return;S.set(t.clientX,t.clientY),A=1;break;case this.mouseButtons.PAN:if(!1===d)return;k.set(t.clientX,t.clientY),A=2}A!==L&&(window.addEventListener("mousemove",U,!1),window.addEventListener("mouseup",j,!1))}},U=t=>{if(this.enabled)switch(A){case 0:if(!1===s)return;N(t.clientX,t.clientY);break;case 1:if(!1===u)return;!function(t){R.set(t.clientX,t.clientY),I.sub(R,S),I.y>0?F(z()):I.y<0&&F(1/z()),S.copy(R)}(t);break;case 2:if(!1===d)return;B(t.clientX,t.clientY)}},j=()=>{window.removeEventListener("mousemove",U,!1),window.removeEventListener("mouseup",j,!1),A=L},H=t=>{this.enabled&&u&&(A===L||0===A)&&(t.stopPropagation(),t.preventDefault(),t.deltaY<0?F(1/z()):t.deltaY>0&&F(z()))},G=t=>{if(this.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===s)return;M.set(t.touches[0].pageX,t.touches[0].pageY),A=0;break;case 2:if(!1===u&&!1===d)return;!function(t){if(u){let e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);S.set(0,i)}if(d){let e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);k.set(e,n)}}(t),A=3;break;default:A=L}},W=t=>{if(this.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===s)return;N(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===u&&!1===d)return;!function(t){if(u){let e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);R.set(0,i),I.set(0,Math.pow(R.y/S.y,c)),F(I.y),S.copy(R)}d&&B(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}(t);break;default:A=L}},Y=()=>{this.enabled&&(A=L)},X=t=>{this.enabled&&t.preventDefault()};this.remove=function(){e.removeEventListener("contextmenu",X),e.removeEventListener("mousedown",O),e.removeEventListener("wheel",H),e.removeEventListener("touchstart",G),e.removeEventListener("touchend",Y),e.removeEventListener("touchmove",W),window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",j)},e.addEventListener("contextmenu",X,!1),e.addEventListener("mousedown",O,!1),e.addEventListener("wheel",H,{passive:!1}),e.addEventListener("touchstart",G,{passive:!1}),e.addEventListener("touchend",Y,!1),e.addEventListener("touchmove",W,{passive:!1})}const B=new T,O=new T,U=new T,j=new p,H=new p,G=new p,W=new p,Y=new p,X=new p,q=new p,K=new p,Z=new p,$=new p,Q=new p,J=new _;class tt{constructor(){this.origin=new p,this.direction=new p}castMouse(t,e=[0,0]){if("orthographic"===t.type){const{left:n,right:i,bottom:r,top:o,zoom:s}=t,a=n/s+(i-n)/s*(.5*e[0]+.5),h=r/s+(o-r)/s*(.5*e[1]+.5);this.origin.set(a,h,0),this.origin.applyMatrix4(t.worldMatrix),this.direction.x=-t.worldMatrix[8],this.direction.y=-t.worldMatrix[9],this.direction.z=-t.worldMatrix[10]}else t.worldMatrix.getTranslation(this.origin),this.direction.set(e[0],e[1],.5),t.unproject(this.direction),this.direction.sub(this.origin).normalize()}intersectBounds(t,{maxDistance:e,output:n=[]}={}){Array.isArray(t)||(t=[t]);const i=J,r=j,o=H,s=n;return s.length=0,t.forEach((t=>{t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere();const n=t.geometry.bounds;let a;if(i.inverse(t.worldMatrix),e&&(o.copy(this.direction).scaleRotateMatrix4(i),a=e*o.len()),r.copy(this.origin).applyMatrix4(i),o.copy(this.direction).transformDirection(i),e&&r.distance(n.center)-n.radius>a)return;let h=0;if("sphere"===t.geometry.raycast){if(r.distance(n.center)>n.radius&&(h=this.intersectSphere(n,r,o),!h))return}else if((r.x<n.min.x||r.x>n.max.x||r.y<n.min.y||r.y>n.max.y||r.z<n.min.z||r.z>n.max.z)&&(h=this.intersectBox(n,r,o),!h))return;e&&h>a||(t.hit||(t.hit={localPoint:new p,point:new p}),t.hit.localPoint.copy(o).multiply(h).add(r),t.hit.point.copy(t.hit.localPoint).applyMatrix4(t.worldMatrix),t.hit.distance=t.hit.point.distance(this.origin),s.push(t))})),s.sort(((t,e)=>t.hit.distance-e.hit.distance)),s}intersectMeshes(t,{cullFace:e=!0,maxDistance:n,includeUV:i=!0,includeNormal:r=!0,output:o=[]}={}){const s=this.intersectBounds(t,{maxDistance:n,output:o});if(!s.length)return s;const a=J,h=j,l=H,u=G,c=W,d=Y,v=X,f=q,m=K,g=B,b=O,x=U;for(let t=s.length-1;t>=0;t--){const o=s[t];let _;a.inverse(o.worldMatrix),n&&(l.copy(this.direction).scaleRotateMatrix4(a),_=n*l.len()),h.copy(this.origin).applyMatrix4(a),l.copy(this.direction).transformDirection(a);let w,y,E,C=0;const P=o.geometry,M=P.attributes,k=M.index,S=Math.max(0,P.drawRange.start),A=Math.min(k?k.count:M.position.count,P.drawRange.start+P.drawRange.count);for(let t=S;t<A;t+=3){const i=k?k.data[t]:t,r=k?k.data[t+1]:t+1,o=k?k.data[t+2]:t+2;u.fromArray(M.position.data,3*i),c.fromArray(M.position.data,3*r),d.fromArray(M.position.data,3*o);const s=this.intersectTriangle(u,c,d,e,h,l,f);s&&(n&&s>_||(!C||s<C)&&(C=s,w=i,y=r,E=o,v.copy(f)))}C||s.splice(t,1),o.hit.localPoint.copy(l).multiply(C).add(h),o.hit.point.copy(o.hit.localPoint).applyMatrix4(o.worldMatrix),o.hit.distance=o.hit.point.distance(this.origin),o.hit.faceNormal||(o.hit.localFaceNormal=new p,o.hit.faceNormal=new p,o.hit.uv=new T,o.hit.localNormal=new p,o.hit.normal=new p),o.hit.localFaceNormal.copy(v),o.hit.faceNormal.copy(o.hit.localFaceNormal).transformDirection(o.worldMatrix),(i||r)&&(u.fromArray(M.position.data,3*w),c.fromArray(M.position.data,3*y),d.fromArray(M.position.data,3*E),this.getBarycoord(o.hit.localPoint,u,c,d,m)),i&&M.uv&&(g.fromArray(M.uv.data,2*w),b.fromArray(M.uv.data,2*y),x.fromArray(M.uv.data,2*E),o.hit.uv.set(g.x*m.x+b.x*m.y+x.x*m.z,g.y*m.x+b.y*m.y+x.y*m.z)),r&&M.normal&&(u.fromArray(M.normal.data,3*w),c.fromArray(M.normal.data,3*y),d.fromArray(M.normal.data,3*E),o.hit.localNormal.set(u.x*m.x+c.x*m.y+d.x*m.z,u.y*m.x+c.y*m.y+d.y*m.z,u.z*m.x+c.z*m.y+d.z*m.z),o.hit.normal.copy(o.hit.localNormal).transformDirection(o.worldMatrix))}return s.sort(((t,e)=>t.hit.distance-e.hit.distance)),s}intersectSphere(t,e=this.origin,n=this.direction){const i=G;i.sub(t.center,e);const r=i.dot(n),o=i.dot(i)-r*r,s=t.radius*t.radius;if(o>s)return 0;const a=Math.sqrt(s-o),h=r-a,l=r+a;return h<0&&l<0?0:h<0?l:h}intersectBox(t,e=this.origin,n=this.direction){let i,r,o,s,a,h;const l=1/n.x,u=1/n.y,p=1/n.z,c=t.min,d=t.max;return i=((l>=0?c.x:d.x)-e.x)*l,r=((l>=0?d.x:c.x)-e.x)*l,o=((u>=0?c.y:d.y)-e.y)*u,s=((u>=0?d.y:c.y)-e.y)*u,i>s||o>r?0:(o>i&&(i=o),s<r&&(r=s),a=((p>=0?c.z:d.z)-e.z)*p,h=((p>=0?d.z:c.z)-e.z)*p,i>h||a>r?0:(a>i&&(i=a),h<r&&(r=h),r<0?0:i>=0?i:r))}intersectTriangle(t,e,n,i=!0,r=this.origin,o=this.direction,s=q){const a=K,h=Z,l=$;a.sub(e,t),h.sub(n,t),s.cross(a,h);let u,p=o.dot(s);if(!p)return 0;if(p>0){if(i)return 0;u=1}else u=-1,p=-p;l.sub(r,t);let c=u*o.dot(h.cross(l,h));if(c<0)return 0;let d=u*o.dot(a.cross(l));if(d<0)return 0;if(c+d>p)return 0;let v=-u*l.dot(s);return v<0?0:v/p}getBarycoord(t,e,n,i,r=K){const o=Z,s=$,a=Q;o.sub(i,e),s.sub(n,e),a.sub(t,e);const h=o.dot(o),l=o.dot(s),u=o.dot(a),p=s.dot(s),c=s.dot(a),d=h*p-l*l;if(0===d)return r.set(-2,-1,-1);const v=1/d,f=(p*u-l*c)*v,m=(h*c-l*u)*v;return r.set(1-f-m,m,f)}}const et=new p;let nt=1,it=1,rt=!1;class ot{constructor(t,e={}){t.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=t,this.attributes=e,this.id=nt++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let t in e)this.addAttribute(t,e[t])}addAttribute(t,e){if(this.attributes[t]=e,e.id=it++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:e,type:n})=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const i=this.attributes[e];this.gl.bindBuffer(i.target,i.buffer),this.glState.boundBuffer=i.buffer;let r=1;35674===n&&(r=2),35675===n&&(r=3),35676===n&&(r=4);const o=i.size/r,s=1===r?0:r*r*r,a=1===r?0:r*r;for(let e=0;e<r;e++)this.gl.vertexAttribPointer(t+e,o,i.type,i.normalized,i.stride+s,i.offset+e*a),this.gl.enableVertexAttribArray(t+e),this.gl.renderer.vertexAttribDivisor(t+e,i.divisor)})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach(((t,{name:e})=>{const n=this.attributes[e];n.needsUpdate&&this.updateAttribute(n)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}getPositionArray(){const t=this.attributes.position;return t.data?t.data:rt?void 0:(console.warn("No position buffer data found to compute bounds"),rt=!0)}computeBoundingBox(t){t||(t=this.getPositionArray()),this.bounds||(this.bounds={min:new p,max:new p,center:new p,scale:new p,radius:1/0});const e=this.bounds.min,n=this.bounds.max,i=this.bounds.center,r=this.bounds.scale;e.set(1/0),n.set(-1/0);for(let i=0,r=t.length;i<r;i+=3){const r=t[i],o=t[i+1],s=t[i+2];e.x=Math.min(r,e.x),e.y=Math.min(o,e.y),e.z=Math.min(s,e.z),n.x=Math.max(r,n.x),n.y=Math.max(o,n.y),n.z=Math.max(s,n.z)}r.sub(n,e),i.add(e,n).divide(2)}computeBoundingSphere(t){t||(t=this.getPositionArray()),this.bounds||this.computeBoundingBox(t);let e=0;for(let n=0,i=t.length;n<i;n+=3)et.fromArray(t,n),e=Math.max(e,this.bounds.center.squaredDistance(et));this.bounds.radius=Math.sqrt(e)}remove(){this.vao&&this.gl.renderer.deleteVertexArray(this.vao);for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}function st(t,e,n){let i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],p=e[8],c=n[0],d=n[1],v=n[2],f=n[3],m=n[4],g=n[5],b=n[6],x=n[7],_=n[8];return t[0]=c*i+d*s+v*l,t[1]=c*r+d*a+v*u,t[2]=c*o+d*h+v*p,t[3]=f*i+m*s+g*l,t[4]=f*r+m*a+g*u,t[5]=f*o+m*h+g*p,t[6]=b*i+x*s+_*l,t[7]=b*r+x*a+_*u,t[8]=b*o+x*h+_*p,t}class at extends Array{constructor(t=1,e=0,n=0,i=0,r=1,o=0,s=0,a=0,h=1){return super(t,e,n,i,r,o,s,a,h),this}set(t,e,n,i,r,o,s,a,h){return t.length?this.copy(t):(function(t,e,n,i,r,o,s,a,h,l){t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=l}(this,t,e,n,i,r,o,s,a,h),this)}translate(t,e=this){return function(t,e,n){let i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],p=e[8],c=n[0],d=n[1];t[0]=i,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=c*i+d*s+l,t[7]=c*r+d*a+u,t[8]=c*o+d*h+p}(this,e,t),this}rotate(t,e=this){return function(t,e,n){let i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],p=e[8],c=Math.sin(n),d=Math.cos(n);t[0]=d*i+c*s,t[1]=d*r+c*a,t[2]=d*o+c*h,t[3]=d*s-c*i,t[4]=d*a-c*r,t[5]=d*h-c*o,t[6]=l,t[7]=u,t[8]=p}(this,e,t),this}scale(t,e=this){return function(t,e,n){let i=n[0],r=n[1];t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,e,t),this}multiply(t,e){return e?st(this,t,e):st(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}copy(t){var e,n;return n=t,(e=this)[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}fromMatrix4(t){var e,n;return n=t,(e=this)[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[4],e[4]=n[5],e[5]=n[6],e[6]=n[8],e[7]=n[9],e[8]=n[10],this}fromQuaternion(t){return function(t,e){let n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,h=r+r,l=n*s,u=i*s,p=i*a,c=r*s,d=r*a,v=r*h,f=o*s,m=o*a,g=o*h;t[0]=1-p-v,t[3]=u-g,t[6]=c+m,t[1]=u+g,t[4]=1-l-v,t[7]=d-f,t[2]=c-m,t[5]=d+f,t[8]=1-l-p}(this,t),this}fromBasis(t,e,n){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],n[0],n[1],n[2]),this}inverse(t=this){return function(t,e){let n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],p=u*s-a*l,c=-u*o+a*h,d=l*o-s*h,v=n*p+i*c+r*d;v&&(v=1/v,t[0]=p*v,t[1]=(-u*i+r*l)*v,t[2]=(a*i-r*s)*v,t[3]=c*v,t[4]=(u*n-r*h)*v,t[5]=(-a*n+r*o)*v,t[6]=d*v,t[7]=(-l*n+i*h)*v,t[8]=(s*n-i*o)*v)}(this,t),this}getNormalMatrix(t){return function(t,e){let n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],p=e[9],c=e[10],d=e[11],v=e[12],f=e[13],m=e[14],g=e[15],b=n*a-i*s,x=n*h-r*s,_=n*l-o*s,w=i*h-r*a,y=i*l-o*a,E=r*l-o*h,C=u*f-p*v,P=u*m-c*v,M=u*g-d*v,k=p*m-c*f,S=p*g-d*f,A=c*g-d*m,z=b*A-x*S+_*k+w*M-y*P+E*C;z&&(z=1/z,t[0]=(a*A-h*S+l*k)*z,t[1]=(h*M-s*A-l*P)*z,t[2]=(s*S-a*M+l*C)*z,t[3]=(r*S-i*A-o*k)*z,t[4]=(n*A-r*M+o*P)*z,t[5]=(i*M-n*S-o*C)*z,t[6]=(f*E-m*y+g*w)*z,t[7]=(m*_-v*E-g*x)*z,t[8]=(v*y-f*_+g*b)*z)}(this,t),this}}let ht=0;class lt extends E{constructor(t,{geometry:e,program:n,mode:i=t.TRIANGLES,frustumCulled:r=!0,renderOrder:o=0}={}){super(),t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=ht++,this.geometry=e,this.program=n,this.mode=i,this.frustumCulled=r,this.renderOrder=o,this.modelViewMatrix=new _,this.normalMatrix=new at,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){this.beforeRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t}))),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t})))}}let ut=1;const pt={};class ct{constructor(t,{vertex:e,fragment:n,uniforms:i={},transparent:r=!1,cullFace:o=t.BACK,frontFace:s=t.CCW,depthTest:a=!0,depthWrite:h=!0,depthFunc:l=t.LESS}={}){t.canvas||console.error("gl not passed as fist argument to Program"),this.gl=t,this.uniforms=i,this.id=ut++,e||console.warn("vertex shader not supplied"),n||console.warn("fragment shader not supplied"),this.transparent=r,this.cullFace=o,this.frontFace=s,this.depthTest=a,this.depthWrite=h,this.depthFunc=l,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const u=t.createShader(t.VERTEX_SHADER);t.shaderSource(u,e),t.compileShader(u),""!==t.getShaderInfoLog(u)&&console.warn(`${t.getShaderInfoLog(u)}\nVertex Shader\n${vt(e)}`);const p=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(p,n),t.compileShader(p),""!==t.getShaderInfoLog(p)&&console.warn(`${t.getShaderInfoLog(p)}\nFragment Shader\n${vt(n)}`),this.program=t.createProgram(),t.attachShader(this.program,u),t.attachShader(this.program,p),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(u),t.deleteShader(p),this.uniformLocations=new Map;let c=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<c;e++){let n=t.getActiveUniform(this.program,e);this.uniformLocations.set(n,t.getUniformLocation(this.program,n.name));const i=n.name.match(/(\w+)/g);n.uniformName=i[0],3===i.length?(n.isStructArray=!0,n.structIndex=Number(i[1]),n.structProperty=i[2]):2===i.length&&isNaN(Number(i[1]))&&(n.isStruct=!0,n.structProperty=i[1])}this.attributeLocations=new Map;const d=[],v=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<v;e++){const n=t.getActiveAttrib(this.program,e),i=t.getAttribLocation(this.program,n.name);d[i]=n.name,this.attributeLocations.set(n,i)}this.attributeOrder=d.join("")}setBlendFunc(t,e,n,i){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=n,this.blendFunc.dstAlpha=i,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach(((t,n)=>{let i=n.uniformName,r=this.uniforms[i];if(n.isStruct&&(r=r[n.structProperty],i+=`.${n.structProperty}`),n.isStructArray&&(r=r[n.structIndex][n.structProperty],i+=`[${n.structIndex}].${n.structProperty}`),!r)return mt(`Active uniform ${i} has not been supplied`);if(r&&void 0===r.value)return mt(`${i} uniform is missing a value parameter`);if(r.value.texture)return e+=1,r.value.update(e),dt(this.gl,n.type,t,e);if(r.value.length&&r.value[0].texture){const i=[];return r.value.forEach((t=>{e+=1,t.update(e),i.push(e)})),dt(this.gl,n.type,t,i)}dt(this.gl,n.type,t,r.value)})),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function dt(t,e,n,i){i=i.length?function(t){const e=t.length,n=t[0].length;if(void 0===n)return t;const i=e*n;let r=pt[i];r||(pt[i]=r=new Float32Array(i));for(let i=0;i<e;i++)r.set(t[i],i*n);return r}(i):i;const r=t.renderer.state.uniformLocations.get(n);if(i.length)if(void 0===r||r.length!==i.length)t.renderer.state.uniformLocations.set(n,i.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}(r,i))return;r.set?r.set(i):function(t,e){for(let n=0,i=t.length;n<i;n++)t[n]=e[n]}(r,i),t.renderer.state.uniformLocations.set(n,r)}else{if(r===i)return;t.renderer.state.uniformLocations.set(n,i)}switch(e){case 5126:return i.length?t.uniform1fv(n,i):t.uniform1f(n,i);case 35664:return t.uniform2fv(n,i);case 35665:return t.uniform3fv(n,i);case 35666:return t.uniform4fv(n,i);case 35670:case 5124:case 35678:case 35680:return i.length?t.uniform1iv(n,i):t.uniform1i(n,i);case 35671:case 35667:return t.uniform2iv(n,i);case 35672:case 35668:return t.uniform3iv(n,i);case 35673:case 35669:return t.uniform4iv(n,i);case 35674:return t.uniformMatrix2fv(n,!1,i);case 35675:return t.uniformMatrix3fv(n,!1,i);case 35676:return t.uniformMatrix4fv(n,!1,i)}}function vt(t){let e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}let ft=0;function mt(t){ft>100||(console.warn(t),ft++,ft>100&&console.warn("More than 100 program warnings - stopping logs."))}class gt extends ot{constructor(t,{width:e=1,height:n=1,widthSegments:i=1,heightSegments:r=1,attributes:o={}}={}){const s=i,a=r,h=(s+1)*(a+1),l=s*a*6,u=new Float32Array(3*h),p=new Float32Array(3*h),c=new Float32Array(2*h),d=h>65536?new Uint32Array(l):new Uint16Array(l);gt.buildPlane(u,p,c,d,e,n,0,s,a),Object.assign(o,{position:{size:3,data:u},normal:{size:3,data:p},uv:{size:2,data:c},index:{data:d}}),super(t,o)}static buildPlane(t,e,n,i,r,o,s,a,h,l=0,u=1,p=2,c=1,d=-1,v=0,f=0){const m=v,g=r/a,b=o/h;for(let x=0;x<=h;x++){let _=x*b-o/2;for(let o=0;o<=a;o++,v++){let b=o*g-r/2;if(t[3*v+l]=b*c,t[3*v+u]=_*d,t[3*v+p]=s/2,e[3*v+l]=0,e[3*v+u]=0,e[3*v+p]=s>=0?1:-1,n[2*v]=o/a,n[2*v+1]=1-x/h,x===h||o===a)continue;let w=m+o+x*(a+1),y=m+o+(x+1)*(a+1),E=m+o+(x+1)*(a+1)+1,C=m+o+x*(a+1)+1;i[6*f]=w,i[6*f+1]=y,i[6*f+2]=C,i[6*f+3]=y,i[6*f+4]=E,i[6*f+5]=C,f++}}}}const bt=new Uint8Array(4);function xt(t){return 0==(t&t-1)}let _t=1;class wt{constructor(t,{image:e,target:n=t.TEXTURE_2D,type:i=t.UNSIGNED_BYTE,format:r=t.RGBA,internalFormat:o=r,wrapS:s=t.CLAMP_TO_EDGE,wrapT:a=t.CLAMP_TO_EDGE,generateMipmaps:h=!0,minFilter:l=(h?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:u=t.LINEAR,premultiplyAlpha:p=!1,unpackAlignment:c=4,flipY:d=n==t.TEXTURE_2D,anisotropy:v=0,level:f=0,width:m,height:g=m}={}){this.gl=t,this.id=_t++,this.image=e,this.target=n,this.type=i,this.format=r,this.internalFormat=o,this.minFilter=l,this.magFilter=u,this.wrapS=s,this.wrapT=a,this.generateMipmaps=h,this.premultiplyAlpha=p,this.unpackAlignment=c,this.flipY=d,this.anisotropy=Math.min(v,this.gl.renderer.parameters.maxAnisotropy),this.level=f,this.width=m,this.height=g,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){const e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let t=0;t<this.image.length;t++)this.gl.compressedTexImage2D(this.target,t,this.internalFormat,this.image[t].width,this.image[t].height,0,this.image[t].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||xt(this.image.width)&&xt(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,bt);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,bt);this.store.image=this.image}}}class yt{constructor(t,{width:e=t.canvas.width,height:n=t.canvas.height,target:i=t.FRAMEBUFFER,color:r=1,depth:o=!0,stencil:s=!1,depthTexture:a=!1,wrapS:h=t.CLAMP_TO_EDGE,wrapT:l=t.CLAMP_TO_EDGE,minFilter:u=t.LINEAR,magFilter:p=u,type:c=t.UNSIGNED_BYTE,format:d=t.RGBA,internalFormat:v=d,unpackAlignment:f,premultiplyAlpha:m}={}){this.gl=t,this.width=e,this.height=n,this.depth=o,this.buffer=this.gl.createFramebuffer(),this.target=i,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];const g=[];for(let i=0;i<r;i++)this.textures.push(new wt(t,{width:e,height:n,wrapS:h,wrapT:l,minFilter:u,magFilter:p,type:c,format:d,internalFormat:v,unpackAlignment:f,premultiplyAlpha:m,flipY:!1,generateMipmaps:!1})),this.textures[i].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+i,this.gl.TEXTURE_2D,this.textures[i].texture,0),g.push(this.gl.COLOR_ATTACHMENT0+i);g.length>1&&this.gl.renderer.drawBuffers(g),this.texture=this.textures[0],a&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new wt(t,{width:e,height:n,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(o&&!s&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e,n),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),s&&!o&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,e,n),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),o&&s&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,e,n),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)}}class Et{constructor(t,{light:e=new k(t),width:n=1024,height:i=n}){this.gl=t,this.light=e,this.target=new yt(t,{width:n,height:i}),this.depthProgram=new ct(t,{vertex:Ct,fragment:Pt,cullFace:null}),this.castMeshes=[]}add({mesh:t,receive:e=!0,cast:n=!0,vertex:i=Ct,fragment:r=Pt,uniformProjection:o="shadowProjectionMatrix",uniformView:s="shadowViewMatrix",uniformTexture:a="tShadow"}){e&&!t.program.uniforms[o]&&(t.program.uniforms[o]={value:this.light.projectionMatrix},t.program.uniforms[s]={value:this.light.viewMatrix},t.program.uniforms[a]={value:this.target.texture}),n&&(this.castMeshes.push(t),t.colorProgram=t.program,t.depthProgram||(t.depthProgram=i!==Ct||r!==Pt?new ct(this.gl,{vertex:i,fragment:r,cullFace:null}):this.depthProgram))}render({scene:t}){t.traverse((t=>{t.draw&&(~this.castMeshes.indexOf(t)?t.program=t.depthProgram:(t.isForceVisibility=t.visible,t.visible=!1))})),this.gl.renderer.render({scene:t,camera:this.light,target:this.target}),t.traverse((t=>{t.draw&&(~this.castMeshes.indexOf(t)?t.program=t.colorProgram:t.visible=t.isForceVisibility)}))}}const Ct="\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",Pt="\n    precision highp float;\n\n    vec4 packRGBA (float v) {\n        vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\n        pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\n        return pack;\n    }\n\n    void main() {\n        gl_FragColor = packRGBA(gl_FragCoord.z);\n    }\n";class Mt extends ot{constructor(t,{attributes:e={}}={}){Object.assign(e,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(t,e)}}class kt{constructor(t,{data:e=new Float32Array(16),geometry:n=new Mt(t),type:i,filtering:r=t.NEAREST}){this.gl=t;const o=e;this.passes=[],this.geometry=n,this.dataLength=o.length/4,this.size=Math.pow(2,Math.ceil(Math.log(Math.ceil(Math.sqrt(this.dataLength)))/Math.LN2)),this.coords=new Float32Array(2*this.dataLength);for(let t=0;t<this.dataLength;t++){const e=t%this.size/this.size,n=Math.floor(t/this.size)/this.size;this.coords.set([e,n],2*t)}const s=(()=>{if(o.length===this.size*this.size*4)return o;{const t=new Float32Array(this.size*this.size*4);return t.set(o),t}})();this.uniform={value:new wt(t,{image:s,target:t.TEXTURE_2D,type:t.FLOAT,format:t.RGBA,internalFormat:t.renderer.isWebgl2?t.RGBA32F:t.RGBA,wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:t.NEAREST,magFilter:t.NEAREST,width:this.size,flipY:!1})};const a={width:this.size,height:this.size,type:i||t.HALF_FLOAT||t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES,format:t.RGBA,internalFormat:t.renderer.isWebgl2?i===t.FLOAT?t.RGBA32F:t.RGBA16F:t.RGBA,minFilter:r,depth:!1,unpackAlignment:1};this.fbo={read:new yt(t,a),write:new yt(t,a),swap:()=>{let t=this.fbo.read;this.fbo.read=this.fbo.write,this.fbo.write=t,this.uniform.value=this.fbo.read.texture}}}addPass({vertex:t=St,fragment:e=At,uniforms:n={},textureUniform:i="tMap",enabled:r=!0}={}){n[i]=this.uniform;const o=new ct(this.gl,{vertex:t,fragment:e,uniforms:n}),s={mesh:new lt(this.gl,{geometry:this.geometry,program:o}),program:o,uniforms:n,enabled:r,textureUniform:i};return this.passes.push(s),s}render(){this.passes.filter((t=>t.enabled)).forEach(((t,e)=>{this.gl.renderer.render({scene:t.mesh,target:this.fbo.write,clear:!1}),this.fbo.swap()}))}}const St="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",At="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",zt=.033,Vt=.13,Ft=.023,Tt=.03,Lt=.08,Dt=1,Rt=17.74,It=.005,Nt=.076,Bt=.16,Ot=11.09,Ut=2.58,jt=.007,Ht=.023,Gt={SIZE:2048};class Wt{constructor(t,{count:e}){this.gl=t,this.countX=e,this.countY=this.countX,this.initVelocitySimulator(),this.initPositionSimulator(),this.initPrograms()}initVelocitySimulator(){const t=new Float32Array(this.countX*this.countY*4);let e=0;for(let n=0;n<this.countY;n++)for(let n=0;n<this.countX;n++)t[e++]=0,t[e++]=0,t[e++]=0,t[e++]=Tt+(Lt-Tt)*Math.random();const n=new Float32Array(this.countX*this.countY*4);let i=0;for(let t=0;t<this.countY;t++)for(let t=0;t<this.countX;t++)n[i++]=Math.random(),n[i++]=Math.random(),n[i++]=Math.random(),n[i++]=Math.random();this.hashData=this.createDataTexture({data:n,size:this.countX}),this.velocitySim=new kt(this.gl,{data:t})}initPositionSimulator(){const t=new Float32Array(this.countX*this.countY*4);let e=0;for(let n=0;n<this.countY;n++)for(let n=0;n<this.countX;n++)t[e++]=0,t[e++]=0,t[e++]=0,t[e++]=Math.random();this.positionSim=new kt(this.gl,{data:t})}initPrograms(){const t=[new p(-10,0,25),new p(-5,0,-18),new p(5,0,30),new p(10,0,-15)],e={_Position:this.positionSim.uniform,_Hash:{value:this.hashData},_Points:{value:t},_SpatialF:{value:zt},_NoiseSpatialFScale:{value:Ut},_TemporalF:{value:Vt},_Amp:{value:Ft},_Time:{value:0},_TimeScale:{value:Ht},_MinLifeRate:{value:Tt},_MaxLifeRate:{value:Lt},_MinPathDist:{value:Dt},_MaxPathDist:{value:Rt},_ReturnForceK:{value:It},_RepelForceK:{value:Nt},_NoiseSampleSpread:{value:Bt},_NoiseJitterScale:{value:Ot},_PathForce:{value:jt}};this.velocitySim.addPass({uniforms:e,fragment:n(490)});const i={_Velocity:this.velocitySim.uniform,_Points:{value:t},_Time:{value:0},_TimeScale:{value:Ht}};this.positionSim.addPass({uniforms:i,fragment:n(758)})}updatePath({points:t}){this.velocitySim.passes[0].program.uniforms._Points.value=t,this.positionSim.passes[0].program.uniforms._Points.value=t}update({deltaTime:t,bezier:e}){this.updatePath({points:e.PathPoints}),this.velocitySim.passes[0].program.uniforms._Time.value+=t,this.velocitySim.render(),this.positionSim.passes[0].program.uniforms._Time.value+=t,this.positionSim.render()}createDataTexture({data:t,size:e}){return new wt(this.gl,{image:t,target:this.gl.TEXTURE_2D,type:this.gl.FLOAT,format:this.gl.RGBA,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA32F:this.gl.RGBA,wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,width:e,flipY:!1})}get Velocities(){return this.velocitySim.uniform}get Positions(){return this.positionSim.uniform}}class Yt extends lt{constructor(t,{count:e,normal:n}){super(t),this.gl=t,this.countX=e,this.countY=e,this.initSimulator(),this.initGeometry(),this.initMaterial(n),this.initShadowPass(n)}initSimulator(){this.simulator=new Wt(this.gl,{count:this.countX})}initGeometry(){const t=new gt(this.gl,{width:.1,height:.1}),{position:e,normal:n,uv:i,index:r}=t.attributes,o=e.data,s=n.data,a=i.data,h=r.data,l=new Float32Array(this.countX*this.countY);let u=0;for(let t=0;t<l.length;t++)l[u++]=Math.random();this.geometry=new ot(this.gl,{position:{size:3,data:o},samplerCoord:{instanced:1,size:2,data:this.simulator.positionSim.coords},uv:{size:2,data:a},normal:{size:3,data:s},scale:{size:1,instanced:1,data:l},index:{data:h}})}initMaterial(t){const e={_Position:this.simulator.Positions,_Normal:{value:t},_ShadowMapTexelSize:{value:1/Gt.SIZE}};this.program=new ct(this.gl,{uniforms:e,vertex:n(865),fragment:n(415),cullFace:this.gl.BACK,transparent:!1})}initShadowPass(t){this.shadowCamera=new k(this.gl,{near:1,far:300,left:-28,right:28,top:28,bottom:-28}),this.shadowCamera.position.set(0,50,0),this.shadowCamera.lookAt([0,0,0]),this.shadowPass=new Et(this.gl,{light:this.shadowCamera,width:Gt.SIZE,height:Gt.SIZE}),this.shadowPass.add({mesh:this,vertex:n(551),fragment:n(393)}),this.depthProgram.uniforms._Position=this.simulator.Positions,this.depthProgram.uniforms._Normal={value:t}}update({deltaTime:t,bezier:e}){this.simulator.update({deltaTime:t,bezier:e}),this.shadowPass.render({scene:this})}}class Xt extends ot{constructor(t,{radius:e=.5,widthSegments:n=16,heightSegments:i=Math.ceil(.5*n),phiStart:r=0,phiLength:o=2*Math.PI,thetaStart:s=0,thetaLength:a=Math.PI,attributes:h={}}={}){const l=n,u=i,c=r,d=o,v=s,f=a,m=(l+1)*(u+1),g=l*u*6,b=new Float32Array(3*m),x=new Float32Array(3*m),_=new Float32Array(2*m),w=m>65536?new Uint32Array(g):new Uint16Array(g);let y=0,E=0,C=0,P=v+f;const M=[];let k=new p;for(let t=0;t<=u;t++){let n=[],i=t/u;for(let t=0;t<=l;t++,y++){let r=t/l,o=-e*Math.cos(c+r*d)*Math.sin(v+i*f),s=e*Math.cos(v+i*f),a=e*Math.sin(c+r*d)*Math.sin(v+i*f);b[3*y]=o,b[3*y+1]=s,b[3*y+2]=a,k.set(o,s,a).normalize(),x[3*y]=k.x,x[3*y+1]=k.y,x[3*y+2]=k.z,_[2*y]=r,_[2*y+1]=1-i,n.push(E++)}M.push(n)}for(let t=0;t<u;t++)for(let e=0;e<l;e++){let n=M[t][e+1],i=M[t][e],r=M[t+1][e],o=M[t+1][e+1];(0!==t||v>0)&&(w[3*C]=n,w[3*C+1]=i,w[3*C+2]=o,C++),(t!==u-1||P<Math.PI)&&(w[3*C]=i,w[3*C+1]=r,w[3*C+2]=o,C++)}Object.assign(h,{position:{size:3,data:b},normal:{size:3,data:x},uv:{size:2,data:_},index:{data:w}}),super(t,h)}}class qt{constructor(t,e){this.gl=t,this.scene=new E,this.texture=new yt(this.gl,{width:64,height:64,depth:!1,depthTexture:!1,format:this.gl.RGB});const i=new Xt(this.gl,{radius:.98,widthSegments:64,heightSegments:64}),r=new ct(this.gl,{vertex:n(612),fragment:n(5),depthTest:!1,depthWrite:!1});new lt(this.gl,{geometry:i,program:r,frustumCulled:!1}).setParent(this.scene),this.gl.clearColor(0,0,0,1),this.gl.renderer.render({scene:this.scene,target:this.texture})}get Texture(){return this.texture.texture}}class Kt extends lt{constructor(t,e){super(t),this.gl=t,this.camera=e,this.corners=[new p(0,0,0),new p(0,0,0),new p(0,0,0),new p(0,0,0)],this.invViewMatrix=new _,this.viewMatrix=new _,this.initQuad(),this.initProgram(),this.calcFrustumCorners()}initQuad(){const t=new gt(this.gl,{width:2,height:2}),{position:e,uv:n,index:i}=t.attributes,r=new Float32Array(4);r[0]=0,r[1]=1,r[2]=2,r[3]=3,this.geometry=new ot(this.gl,{position:{data:e.data,size:3},uv:{data:n.data,size:2},frustumCornerIndex:{data:r,size:1},index:{data:i.data}})}initProgram(){const t={_BasePass:{value:new wt(this.gl)},_Depth:{value:new wt(this.gl)},_MainCameraInvViewMatrix:{value:this.invViewMatrix},_MainCameraViewMatrix:{value:this.viewMatrix},_CameraWorldPos:{value:this.camera.worldPosition},_FrustumCorners:{value:this.corners},_Near:{value:this.camera.near},_Far:{value:this.camera.far},_Time:{value:0}};this.program=new ct(this.gl,{uniforms:t,vertex:n(990),fragment:n(821)})}calcFrustumCorners(){const t=Math.tan(this.camera.fov*(Math.PI/180)*.5)*this.camera.far,e=t*this.camera.aspect;this.corners[0].set(-e,t,this.camera.far),this.corners[1].set(e,t,this.camera.far),this.corners[2].set(-e,-t,this.camera.far),this.corners[3].set(e,-t,this.camera.far)}update({camera:t,depth:e,color:n,dt:i}){this.program.uniforms._MainCameraInvViewMatrix.value.copy(this.invViewMatrix.inverse(t.viewMatrix)),this.program.uniforms._CameraWorldPos.value.copy(t.worldPosition),this.program.uniforms._Depth.value=e,this.program.uniforms._BasePass.value=n,this.program.uniforms._Time.value+=i}}class Zt{constructor(t,{width:e,height:n,dpr:i,wrapS:r=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,minFilter:s=t.LINEAR,magFilter:a=t.LINEAR,geometry:h=new Mt(t),targetOnly:l=null,type:u=t.UNSIGNED_BYTE,internalFormat:p=t.RGBA}={}){this.gl=t,this.options={wrapS:r,wrapT:o,minFilter:s,magFilter:a,type:u,internalFormat:p},this.passes=[],this.geometry=h,this.uniform={value:null},this.targetOnly=l;const c=this.fbo={read:null,write:null,swap:()=>{let t=c.read;c.read=c.write,c.write=t}};this.resize({width:e,height:n,dpr:i})}addPass({vertex:t=$t,fragment:e=Qt,uniforms:n={},textureUniform:i="tMap",enabled:r=!0}={}){n[i]={value:this.fbo.read.texture};const o=new ct(this.gl,{vertex:t,fragment:e,uniforms:n}),s={mesh:new lt(this.gl,{geometry:this.geometry,program:o}),program:o,uniforms:n,enabled:r,textureUniform:i};return this.passes.push(s),s}resize({width:t,height:e,dpr:n}={}){n&&(this.dpr=n),t&&(this.width=t,this.height=e||t),n=this.dpr||this.gl.renderer.dpr,t=(this.width||this.gl.renderer.width)*n,e=(this.height||this.gl.renderer.height)*n,this.options.width=t,this.options.height=e,this.fbo.read=new yt(this.gl,this.options),this.fbo.write=new yt(this.gl,this.options)}render({scene:t,camera:e,target:n=null,update:i=!0,sort:r=!0,frustumCull:o=!0}){const s=this.passes.filter((t=>t.enabled));this.gl.renderer.render({scene:t,camera:e,target:s.length||!n&&this.targetOnly?this.fbo.write:n,update:i,sort:r,frustumCull:o}),this.fbo.swap(),s.forEach(((t,e)=>{t.mesh.program.uniforms[t.textureUniform].value=this.fbo.read.texture,this.gl.renderer.render({scene:t.mesh,target:e!==s.length-1||!n&&this.targetOnly?this.fbo.write:n,clear:!0}),this.fbo.swap()})),this.uniform.value=this.fbo.read.texture}}const $t="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",Qt="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n";class Jt{constructor(t){this.gl=t,this.initFxaaPass(),this.initBlurPass(),this.initFakeAtmospherePass(),this.initDitherPass()}initFxaaPass(){this.fxaaPass=new Zt(this.gl,{width:this.gl.canvas.clientWidth,height:this.gl.canvas.clientHeight});const t={_Color:{value:new wt(this.gl)},_Resolution:{value:new T(this.gl.canvas.clientWidth,this.gl.canvas.clientHeight)}};this.fxaaPass.addPass({uniforms:t,fragment:n(87)})}initBlurPass(){const t=.25;this.blurPass=new Zt(this.gl,{width:this.gl.canvas.clientWidth*t,height:this.gl.canvas.clientHeight*t});for(let e=0;e<9;e++){const i={_StepSize:{value:.5+e},_Time:{value:0},_Resolution:{value:new T(this.gl.canvas.clientWidth*t,this.gl.canvas.clientHeight*t)},_Seed:{value:e}};this.blurPass.addPass({uniforms:i,fragment:n(205)})}}initFakeAtmospherePass(){this.fakeAtmospherePass=new Zt(this.gl,{width:this.gl.canvas.clientWidth,height:this.gl.canvas.clientHeight});const t={_Base:{value:new wt(this.gl)},_Blur:{value:null},_Depth:{value:null},_Time:{value:0}};this.fakeAtmospherePass.addPass({uniforms:t,fragment:n(631)})}initDitherPass(){this.ditherPass=new Zt(this.gl,{width:this.gl.canvas.clientWidth,height:this.gl.canvas.clientHeight}),this.ditherPass.addPass({uniforms:{_Time:{value:0}},fragment:n(208)})}render({scene:t,depth:e,dt:n}){this.fxaaPass.render({scene:t}),this.blurPass.passes.forEach((t=>{t.program.uniforms._Time.value+=n})),this.blurPass.render({scene:this.fxaaPass.passes[0].mesh}),this.fakeAtmospherePass.passes[0].program.uniforms._Blur=this.blurPass.uniform,this.fakeAtmospherePass.passes[0].program.uniforms._Depth.value=e,this.fakeAtmospherePass.passes[0].program.uniforms._Time.value+=n,this.fakeAtmospherePass.render({scene:this.fxaaPass.passes[0].mesh}),this.ditherPass.passes[0].program.uniforms._Time.value+=n,this.ditherPass.render({scene:this.fakeAtmospherePass.passes[0].mesh})}onResize({width:t,height:e}){this.fxaaPass.resize({width:t,height:e}),this.blurPass.resize({width:.25*t,height:.25*e}),this.fakeAtmospherePass.resize({width:t,height:e}),this.ditherPass.resize({width:t,height:e})}}class te extends E{constructor(t,{visible:e}){super(),this.gl=t,this.enabled=!1,this.initPositions=[new p(-11,0,17),new p(-7,0,-13),new p(3,0,11),new p(21,0,-15)],this.planeDimensions=new T,this.ray=new tt(this.gl),this.prevViewSpacePoint=new p,this.firstMove=!0,this.prevTarget=null,this.editingPoint=!1,this.activeZ=0,this.activePoint=null,this.initPoints(e)}initPoints(t){const e=new Xt(this.gl,{radius:2,widthSegments:32,heightSegments:16});e.raycast="sphere";const i=new ct(this.gl,{vertex:n(359),fragment:n(725)});this.pointA=new lt(this.gl,{geometry:e,program:i}),this.pointB=new lt(this.gl,{geometry:e,program:i}),this.pointC=new lt(this.gl,{geometry:e,program:i}),this.pointD=new lt(this.gl,{geometry:e,program:i}),this.pointA.position.copy(this.initPositions[0]),this.pointB.position.copy(this.initPositions[1]),this.pointC.position.copy(this.initPositions[2]),this.pointD.position.copy(this.initPositions[3]),this.pointA.setParent(this),this.pointB.setParent(this),this.pointC.setParent(this),this.pointD.setParent(this),this.pointA.visible=t,this.pointB.visible=t,this.pointC.visible=t,this.pointD.visible=t}pickPoint({camera:t,inputPos:e,orbitControls:n}){this.enabled&&!1===this.editingPoint&&(this.ray.castMouse(t,e),this.children.forEach((t=>{t.isHit=!1})),this.ray.intersectBounds(this.children).forEach((t=>t.isHit=!0)),this.children.forEach((e=>{if(e.isHit){n.enabled=!1,this.activePoint=e;const i=(new p).copy(e.position);i.applyMatrix4(t.viewMatrix),this.activeZ=-i.z,this.calcPlaneSize({camera:t}),this.editingPoint=!0}})))}updatePoints({camera:t,inputPos:e}){this.editingPoint&&this.translatePoint({camera:t,inputPos:e})}updateState(){this.enabled=!this.enabled,this.children.forEach((t=>{t.visible=this.enabled}))}resetInteractionStates({orbitControls:t}){this.editingPoint=!1,this.firstMove=!0,t.enabled=!0}screenToViewspace({inputPos:t,camera:e}){const n=new p(t.x,t.y,1),i=new _;i.inverse((new _).copy(e.projectionMatrix)),n.applyMatrix4(i)}calcPlaneSize({camera:t}){this.planeDimensions.y=Math.tan(t.fov*(Math.PI/180)*.5)*Math.abs(this.activeZ),this.planeDimensions.x=this.planeDimensions.y*t.aspect}translatePoint({point:t,camera:e,inputPos:n}){const i=(new p).copy(this.activePoint.position);i.applyMatrix4(e.viewMatrix);const r=new T;r.x=this.planeDimensions.x*n.x,r.y=this.planeDimensions.y*n.y,this.firstMove&&(this.prevViewSpacePoint.copy(r),this.firstMove=!1),i.x+=r.x-this.prevViewSpacePoint.x,i.y+=r.y-this.prevViewSpacePoint.y;const o=(new p).copy(i);this.prevViewSpacePoint.copy(r),o.applyMatrix4((new _).inverse(e.viewMatrix)),this.activePoint.position.copy(o)}get PointA(){return this.pointA.position}get PointB(){return this.PointB.position}get PointC(){return this.pointC.position}get PointD(){return this.pointD.position}get PathPoints(){return[this.pointA.position,this.pointB.position,this.pointC.position,this.pointD.position]}}function ee(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class ne{constructor({el:t}){ee(this,"onTouchStart",(t=>{t.preventDefault(),console.log("TOUCH START"),this.touchCount++,this.isInteracting=!0;const e=t.touches[0];this.inputPos.x=e.clientX/this.gl.canvas.clientWidth*2-1,this.inputPos.y=2*(1-e.clientY/this.gl.canvas.clientHeight)-1,this.prevInputPos.copy(this.inputPos),this.inputDelta.copy(this.inputPos).sub(this.prevInputPos),this.bezierEditor.pickPoint({camera:this.camera,inputPos:this.inputPos,orbitControls:this.orbitCamera})})),ee(this,"onTouchMove",(t=>{if(t.preventDefault(),this.touchCount<2){const e=t.touches[0];this.inputPos.x=e.clientX/this.gl.canvas.clientWidth*2-1,this.inputPos.y=2*(1-e.clientY/this.gl.canvas.clientHeight)-1,!1===this.firstMove&&(this.firstMove=!0,this.prevInputPos.copy(this.inputPos),this.inputDelta.copy(this.inputPos).sub(this.prevInputPos)),!0===this.editingPath&&this.bezierEditor.updatePoints({camera:this.camera,inputPos:this.inputPos})}})),ee(this,"onTouchEnd",(()=>{this.isInteracting=!1,this.firstMove=!1,this.touchCount=0,this.bezierEditor.resetInteractionStates({orbitControls:this.orbitCamera})})),this.init({el:t}),this.initInputParams()}init({el:t}){this.renderer=new v({width:t.clientWidth,height:t.clientHeight,antialias:!1}),this.gl=this.renderer.gl,this.gl.clearColor(0,0,0,1),t.appendChild(this.gl.canvas),this.camera=new k(this.gl,{aspect:this.gl.canvas.clientWidth/this.gl.canvas.clientHeight,fov:50,far:300}),this.camera.position.x=0,this.camera.position.y=10,this.camera.position.z=28,this.orbitCamera=new N(this.camera,{element:this.gl.canvas}),this.scene=new E,this.initBezierEditor(),this.initMesh(),this.initWorldPosCaptureQuad(),this.initPostPass()}initInputParams(){this.inputPos=new p(0,0,.5),this.prevInputPos=(new p).copy(this.inputPos),this.inputDelta=new p(0,0,0),this.projectedInputPos=new p(0,0,.5),this.worldInputPos=new p(0,0,.5),this.raycast=new tt(this.gl),this.isInteracting=!1,this.touchCount=0}onMouseDown(t){this.isInteracting=!0,this.inputPos.x=t.clientX/this.gl.canvas.clientWidth*2-1,this.inputPos.y=2*(1-t.clientY/this.gl.canvas.clientHeight)-1,this.prevInputPos.copy(this.inputPos),this.bezierEditor.pickPoint({camera:this.camera,inputPos:this.inputPos,orbitControls:this.orbitCamera})}onMouseMove(t){!1!==this.isInteracting&&(this.inputPos.x=t.clientX/this.gl.canvas.clientWidth*2-1,this.inputPos.y=2*(1-t.clientY/this.gl.canvas.clientHeight)-1,this.inputDelta.x=this.inputPos.x-this.prevInputPos.x,this.inputDelta.y=this.inputPos.y-this.prevInputPos.y,!0===this.editingPath&&this.bezierEditor.updatePoints({camera:this.camera,inputPos:this.inputPos}),this.prevInputPos.copy(this.inputPos))}onMouseUp(t){this.isInteracting=!1,this.bezierEditor.resetInteractionStates({orbitControls:this.orbitCamera})}onKeyUp(t){switch(t.keyCode){case 32:this.updateBezierEditorMode()}}initBezierEditor(){const t=window.pane.addFolder({title:"path editor",expanded:!1});t.addButton({title:"EDIT PATH"}).on("click",(()=>{this.updateBezierEditorMode()})),t.addFolder({title:"click and drag spheres"}),t.addFolder({title:"you can also move camera"}),this.editingPath=!1,this.bezierEditor=new te(this.gl,{visible:!1}),this.bezierEditor.setParent(this.scene)}initMesh(){this.sphereNormals=new qt(this.gl,this.renderer),this.particles=new Yt(this.gl,{count:256,normal:this.sphereNormals.Texture}),this.particles.program.uniforms._Normal.value=this.sphereNormals.Texture,this.particles.setParent(this.scene)}initWorldPosCaptureQuad(){this.fogPass=new Kt(this.gl,this.camera)}initPostPass(){this.basePass=new yt(this.gl,{width:this.gl.canvas.clientWidth,height:this.gl.canvas.clientHeight,depthTexture:!0}),this.post=new Jt(this.gl)}updateBezierEditorMode(){this.editingPath=!this.editingPath,!1===this.orbitCamera.enabled&&(this.orbitCamera.enabled=!0),this.bezierEditor.updateState()}render({scene:t,camera:e=null,target:n=null}){this.renderer.render({scene:t,camera:e,target:n})}calcScreenToWorldPos(){this.camera.unproject(this.projectedInputPos.copy(this.inputPos)),this.projectedInputPos.sub(this.camera.position).normalize();const t=-this.camera.position.z/this.projectedInputPos.z;this.worldInputPos.copy(this.camera.position).add(this.projectedInputPos.multiply(t)),this.worldInputPos.z=5*-this.inputPos.y}updateOrbitCamera(){this.orbitCamera.update(),this.camera.updateMatrixWorld()}update(t){this.updateOrbitCamera(),this.particles.update({deltaTime:t,bezier:this.bezierEditor}),this.render({scene:this.scene,camera:this.camera,target:this.basePass}),this.fogPass.update({camera:this.camera,depth:this.basePass.depthTexture,color:this.basePass.texture,dt:t}),this.render({scene:this.fogPass}),this.post.render({scene:this.fogPass,depth:this.basePass.depthTexture,dt:t})}onResize({el:t}){this.renderer.setSize(t.clientWidth,t.clientHeight),this.camera.perspective({aspect:this.gl.canvas.clientWidth/this.gl.canvas.clientHeight}),this.post.onResize({width:this.gl.canvas.clientWidth,height:this.gl.canvas.clientHeight})}}var ie=n(498),re=n.n(ie);function oe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class se{constructor(){oe(this,"onMouseDown",(t=>{this.World3d.onMouseDown(t)})),oe(this,"onMouseMove",(t=>{this.World3d.onMouseMove(t)})),oe(this,"onMouseUp",(t=>{this.World3d.onMouseUp(t)})),oe(this,"onTouchStart",(t=>{this.World3d.onTouchStart(t)})),oe(this,"onTouchMove",(t=>{console.log("MOVED"),this.World3d.onTouchMove(t)})),oe(this,"onTouchEnd",(t=>{this.World3d.onTouchEnd(t)})),oe(this,"onTouchCancel",(t=>{this.World3d.onTouchEnd(t)})),oe(this,"onKeyUp",(t=>{this.World3d.onKeyUp(t)})),oe(this,"onResize",(()=>{this.World3d.onResize({el:this.el})})),oe(this,"update",(()=>{window.requestAnimationFrame((()=>this.update())),this.time=Date.now();let t=this.time;this.deltaTime=(this.time-this.prevTime)/1e3,this.prevTime=t,this.World3d.update(this.deltaTime)})),window.pane=new(re()),this.el=document.getElementById("WebGL"),this.World3d=new ne({el:this.el}),this.initCTA(),this.initEvents(),this.start()}initCTA(){}initEvents(){this.time=Date.now(),this.prevTime=this.time,this.deltaTime=0,this.ctaHidden=!1,window.addEventListener("resize",this.onResize.bind(this)),this.World3d.gl.canvas.addEventListener("mousedown",this.onMouseDown),this.World3d.gl.canvas.addEventListener("mousemove",this.onMouseMove),this.World3d.gl.canvas.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keyup",this.onKeyUp),this.World3d.gl.canvas.addEventListener("touchstart",this.onTouchStart),this.World3d.gl.canvas.addEventListener("touchmove",this.onTouchMove),this.World3d.gl.canvas.addEventListener("touchend",this.onTouchEnd),this.World3d.gl.canvas.addEventListener("touchcancel",this.onTouchEnd)}start(){this.update()}}window.onload=()=>new se})()})();